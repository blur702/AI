<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-api/createListenerMiddleware" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.3"><title data-rh=true>createListenerMiddleware | Redux Toolkit</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true property=og:image content=https://redux-toolkit.js.org/img/redux-logo-landscape.png><meta data-rh=true name=twitter:image content=https://redux-toolkit.js.org/img/redux-logo-landscape.png><meta data-rh=true property=og:url content=https://redux-toolkit.js.org/api/createListenerMiddleware><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=twitter:card content=summary><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="createListenerMiddleware | Redux Toolkit"><meta data-rh=true name=description content=&amp;nbsp;><meta data-rh=true property=og:description content=&amp;nbsp;><link data-rh=true rel=icon href=/img/favicon/favicon.ico><link data-rh=true rel=canonical href=https://redux-toolkit.js.org/api/createListenerMiddleware><link data-rh=true rel=alternate href=https://redux-toolkit.js.org/api/createListenerMiddleware hreflang=en><link data-rh=true rel=alternate href=https://redux-toolkit.js.org/api/createListenerMiddleware hreflang=x-default><link rel=preconnect href=https://redux-docs-umami.up.railway.app><script async defer src=https://redux-docs-umami.up.railway.app/script.js data-website-id=616c102e-05dd-4a74-b63e-01bb52f1bc6c data-auto-track=true data-do-not-track=true data-cache=true data-exclude-search=false data-exclude-hash=false></script><link rel=stylesheet href=/assets/css/styles.d1974aab.css><script src=/assets/js/runtime~main.1ae001f1.js defer></script><script src=/assets/js/main.848e456e.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/redux.svg><link rel=preload as=image href=/img/redux_white.svg><div role=region aria-label="Skip to main content"><a class=skipToContent_oPtH href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/redux.svg alt="Redux Logo" class="themedComponent_siVc themedComponent--light_hHel"><img src=/img/redux.svg alt="Redux Logo" class="themedComponent_siVc themedComponent--dark_yETr"></div><b class="navbar__title text--truncate">Redux Toolkit</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/introduction/getting-started>Getting Started</a><a class="navbar__item navbar__link" href=/tutorials/overview>Tutorials</a><a class="navbar__item navbar__link" href=/usage/usage-guide>Usage Guide</a><a class="navbar__item navbar__link" href=/api/configureStore>API</a><a class="navbar__item navbar__link" href=/rtk-query/overview>RTK Query</a><a href=https://github.com/reduxjs/redux-toolkit target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPrP><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_lgto><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_U96C><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_bzqh></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_MB5r"><div class=docsWrapper__sE8><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_iEvu" type=button></button><div class=docRoot_DfVB><aside class="theme-doc-sidebar-container docSidebarContainer_c7NB"><div class=sidebarViewport_KYo0><div class=sidebar_CUen><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_jmj1"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true href=/introduction/getting-started>Introduction</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/introduction/getting-started>Getting Started</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/introduction/why-rtk-is-redux-today>Why Redux Toolkit is How To Use Redux Today</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true href=/tutorials/overview>Tutorials</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/tutorials/overview>Tutorials Overview</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/tutorials/quick-start>Quick Start</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/tutorials/typescript>TypeScript Quick Start</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/tutorials/rtk-query>RTK Query Quick Start</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true href=/usage/migrating-to-modern-redux>Using Redux Toolkit</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/usage/migrating-to-modern-redux>Migrations</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/usage/usage-guide>Usage Guide</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/usage/usage-with-typescript>Usage With TypeScript</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/usage/immer-reducers>Writing Reducers with Immer</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/usage/nextjs>Setup with Next.js</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/api/configureStore>API Reference</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true tabindex=0 href=/api/configureStore>Store Setup</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/configureStore>configureStore</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/getDefaultMiddleware>getDefaultMiddleware</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/immutabilityMiddleware>Immutability Middleware</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/serializabilityMiddleware>Serializability Middleware</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/actionCreatorMiddleware>Action Creator Middleware</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/api/createListenerMiddleware>createListenerMiddleware</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createDynamicMiddleware>createDynamicMiddleware</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/getDefaultEnhancers>getDefaultEnhancers</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/autoBatchEnhancer>autoBatchEnhancer</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true tabindex=0 href=/api/createReducer>Reducers and Actions</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createReducer>createReducer</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createAction>createAction</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createSlice>createSlice</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createAsyncThunk>createAsyncThunk</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createEntityAdapter>createEntityAdapter</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/combineSlices>combineSlices</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true tabindex=0 href=/api/createSelector>Other</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/createSelector>createSelector</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/matching-utilities>Matching Utilities</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/other-exports>Other Exports</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/api/codemods>Codemods</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class=menu__link tabindex=0 href=/errors>Error Messages</a></ul></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=true href=/rtk-query/overview>RTK Query</a></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/rtk-query/overview>RTK Query Overview</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/rtk-query/comparison>Comparison with Other Tools</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/rtk-query/usage/examples>Examples</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/rtk-query/usage-with-typescript>Usage With TypeScript</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/rtk-query/usage/queries>Using RTK Query</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/rtk-query/api/createApi>API Reference</a></div></ul></ul></nav></div></div></aside><main class=docMainContainer_a9sJ><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_Qr34"><div class=docItemContainer_tjFy><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_T5ub" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_sfvy><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>API Reference</span><meta itemprop=position content=1><li class=breadcrumbs__item><span class=breadcrumbs__link>Store Setup</span><meta itemprop=position content=2><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>createListenerMiddleware</span><meta itemprop=position content=3></ul></nav><div class="tocCollapsible_wXna theme-doc-toc-mobile tocMobile_Ojys"><button type=button class="clean-btn tocCollapsibleButton_iI2p">On this page</button></div><div class="theme-doc-markdown markdown"><p> </p>
<header><h1><code>createListenerMiddleware</code></h1></header>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=overview>Overview<a href=#overview class=hash-link aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>A Redux middleware that lets you define "listener" entries that contain an "effect" callback with additional logic, and a way to specify when that callback should run based on dispatched actions or state changes.</p>
<p>It's intended to be a lightweight alternative to more widely used Redux async middleware like sagas and observables. While similar to thunks in level of complexity and concept, it can be used to replicate some common saga usage patterns.</p>
<p>Conceptually, you can think of this as being similar to React's <code>useEffect</code> hook, except that it runs logic in response to Redux store updates instead of component props/state updates.</p>
<p>Listener effect callbacks have access to <code>dispatch</code> and <code>getState</code>, similar to thunks. The listener also receives a set of async workflow functions like <code>take</code>, <code>condition</code>, <code>pause</code>, <code>fork</code>, and <code>unsubscribe</code>, which allow writing more complex async logic.</p>
<p>Listeners can be defined statically by calling <code>listenerMiddleware.startListening()</code> during setup, or added and removed dynamically at runtime with special <code>dispatch(addListener())</code> and <code>dispatch(removeListener())</code> actions.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=basic-usage>Basic Usage<a href=#basic-usage class=hash-link aria-label="Direct link to Basic Usage" title="Direct link to Basic Usage">​</a></h3>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword module" style=color:#F92672>import</span><span class="token plain"> </span><span class="token imports punctuation" style=color:#F8F8F2>{</span><span class="token imports"> configureStore</span><span class="token imports punctuation" style=color:#F8F8F2>,</span><span class="token imports"> createListenerMiddleware </span><span class="token imports punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword module" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'@reduxjs/toolkit'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword module" style=color:#F92672>import</span><span class="token plain"> </span><span class="token imports">todosReducer</span><span class="token imports punctuation" style=color:#F8F8F2>,</span><span class="token imports"> </span><span class="token imports punctuation" style=color:#F8F8F2>{</span><span class="token imports"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token imports">  todoAdded</span><span class="token imports punctuation" style=color:#F8F8F2>,</span><span class="token imports"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token imports">  todoToggled</span><span class="token imports punctuation" style=color:#F8F8F2>,</span><span class="token imports"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token imports">  todoDeleted</span><span class="token imports punctuation" style=color:#F8F8F2>,</span><span class="token imports"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token imports"></span><span class="token imports punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword module" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'../features/todos/todosSlice'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// Create the middleware instance and methods</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> listenerMiddleware </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>createListenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// Add one or more listener entries that look for specific actions.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// They may contain any sync or async logic, similar to thunks.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> todoAdded</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Run whatever additional side-effect-y logic you want here</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>log</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'Todo added: '</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> action</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">payload</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">text</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Can cancel other running instances</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>cancelActiveListeners</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Run async logic</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> data </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>fetchData</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Pause until action dispatched or state changed</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>condition</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">matchSomeAction</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Use the listener API methods to dispatch, get state,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// unsubscribe the listener, start child tasks, and more</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>todoAdded</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'Buy pet food'</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Spawn "child tasks" that can do more work and return results</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> task </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>fork</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">forkApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#778090>// Can pause execution</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> forkApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>5</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#778090>// Complete the child by returning a value</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword control-flow" style=color:#F92672>return</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>42</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> result </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> task</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">result</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Unwrap the child result in the listener</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">result</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">status</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>===</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'ok'</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#778090>// Logs the `42` result value that was returned</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>log</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'Child succeeded: '</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> result</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">value</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> store </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>configureStore</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>reducer</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token literal-property property" style=color:#F92672>todos</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> todosReducer</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Add the listener middleware to the store.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// NOTE: Since this can receive actions with functions inside,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// it should go before the serializability check middleware</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>middleware</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">getDefaultMiddleware</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#E6D874>getDefaultMiddleware</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>prepend</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">middleware</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=createlistenermiddleware-1><code>createListenerMiddleware</code><a href=#createlistenermiddleware-1 class=hash-link aria-label="Direct link to createlistenermiddleware-1" title="Direct link to createlistenermiddleware-1">​</a></h2>
<p>Creates an instance of the middleware, which should then be added to the store via <code>configureStore</code>'s <code>middleware</code> parameter.</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#E6D874>createListenerMiddleware</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">options</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> CreateMiddlewareOptions</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  ListenerMiddlewareInstance</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">CreateListenerMiddlewareOptions</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">ExtraArgument </span><span class="token class-name operator" style=color:#F8F8F2>=</span><span class="token class-name"> </span><span class="token class-name builtin" style=color:#a6e22e>unknown</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  extra</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ExtraArgument</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  onError</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerErrorHandler</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">ListenerErrorHandler</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  error</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>unknown</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  errorInfo</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerErrorInfo</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">ListenerErrorInfo</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  raisedBy</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'effect'</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'predicate'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=middleware-options>Middleware Options<a href=#middleware-options class=hash-link aria-label="Direct link to Middleware Options" title="Direct link to Middleware Options">​</a></h3>
<ul>
<li><code>extra</code>: an optional "extra argument" that will be injected into the <code>listenerApi</code> parameter of each listener. Equivalent to <a href=https://redux.js.org/usage/writing-logic-thunks#injecting-config-values-into-thunks target=_blank rel="noopener noreferrer">the "extra argument" in the Redux Thunk middleware</a></li>
<li><code>onError</code>: an optional error handler that gets called with synchronous and async errors raised by <code>listener</code> and synchronous errors thrown by <code>predicate</code>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=listener-middleware-instance>Listener Middleware Instance<a href=#listener-middleware-instance class=hash-link aria-label="Direct link to Listener Middleware Instance" title="Direct link to Listener Middleware Instance">​</a></h2>
<p>The "listener middleware instance" returned from <code>createListenerMiddleware</code> is an object similar to the "slice" objects generated by <code>createSlice</code>. The instance object is <em>not</em> the actual Redux middleware itself. Rather, it contains the middleware and some instance methods used to add and remove listener entries within the middleware.</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">ListenerMiddlewareInstance</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  State </span><span class="token class-name operator" style=color:#F8F8F2>=</span><span class="token class-name"> </span><span class="token class-name builtin" style=color:#a6e22e>unknown</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  Dispatch </span><span class="token class-name keyword" style=color:#F92672>extends</span><span class="token class-name"> ThunkDispatch</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">State</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"> </span><span class="token class-name builtin" style=color:#a6e22e>unknown</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"> UnknownAction</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token class-name"> </span><span class="token class-name operator" style=color:#F8F8F2>=</span><span class="token class-name"> ThunkDispatch</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">    State</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">    </span><span class="token class-name builtin" style=color:#a6e22e>unknown</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">    UnknownAction</span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  </span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  ExtraArgument </span><span class="token class-name operator" style=color:#F8F8F2>=</span><span class="token class-name"> </span><span class="token class-name builtin" style=color:#a6e22e>unknown</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name"></span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  middleware</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerMiddleware</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">State</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> Dispatch</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> ExtraArgument</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>startListening</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">options</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AddListenerOptions</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> Unsubscribe</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>stopListening</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    options</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AddListenerOptions </span><span class="token operator" style=color:#F8F8F2>&</span><span class="token plain"> UnsubscribeListenerOptions</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>boolean</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>clearListeners</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=middleware><code>middleware</code><a href=#middleware class=hash-link aria-label="Direct link to middleware" title="Direct link to middleware">​</a></h3>
<p>The actual Redux middleware. Add this to the Redux store via <a href=/api/configureStore#middleware>the <code>configureStore.middleware</code> option</a>.</p>
<p>Since the listener middleware can receive "add" and "remove" actions containing functions, this should normally be added as the first middleware in the chain so that it is before the serializability check middleware.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> store </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>configureStore</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>reducer</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token literal-property property" style=color:#F92672>todos</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> todosReducer</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Add the listener middleware to the store.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// NOTE: Since this can receive actions with functions inside,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// it should go before the serializability check middleware</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>middleware</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">getDefaultMiddleware</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#E6D874>getDefaultMiddleware</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>prepend</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">middleware</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=startlistening><code>startListening</code><a href=#startlistening class=hash-link aria-label="Direct link to startlistening" title="Direct link to startlistening">​</a></h3>
<p>Adds a new listener entry to the middleware. Typically used to "statically" add new listeners during application setup.</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#E6D874>startListening</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">options</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AddListenerOptions</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> UnsubscribeListener</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">AddListenerOptions</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Four options for deciding when the listener will run:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// 1) Exact action type string match</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  type</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>string</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// 2) Exact action type match based on the RTK action creator</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  actionCreator</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ActionCreator</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// 3) Match one of many actions using an RTK matcher</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  matcher</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> Matcher</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// 4) Return true based on a combination of action + state</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  predicate</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerPredicate</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// The actual callback to run when the action is matched</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> Action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> listenerApi</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token keyword" style=color:#F92672>void</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">ListenerPredicate</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">Action </span><span class="token class-name keyword" style=color:#F92672>extends</span><span class="token class-name"> ReduxAction</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"> State</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  action</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> Action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  currentState</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> State</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  originalState</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> State</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>boolean</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">UnsubscribeListener</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  unsubscribeOptions</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> UnsubscribeListenerOptions</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">UnsubscribeListenerOptions</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  cancelActive</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p><strong>You must provide exactly <em>one</em> of the four options for deciding when the listener will run: <code>type</code>, <code>actionCreator</code>, <code>matcher</code>, or <code>predicate</code></strong>. Every time an action is dispatched, each listener will be checked to see if it should run based on the current action vs the comparison option provided.</p>
<p>These are all acceptable:</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#778090>// 1) Action type string</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#F92672>type</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'todos/todoAdded'</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 2) RTK action creator</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> todoAdded</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 3) RTK matcher function</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>matcher</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>isAnyOf</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">todoAdded</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> todoToggled</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  effect</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 4) Listener predicate</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>predicate</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> currentState</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> previousState</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// return true when the listener should run</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  effect</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Note that the <code>predicate</code> option actually allows matching solely against state-related checks, such as "did <code>state.x</code> change" or "the current value of <code>state.x</code> matches some criteria", regardless of the actual action.</p>
<p>The <a href=/api/matching-utilities>"matcher" utility functions included in RTK</a> are acceptable as either the <code>matcher</code> or <code>predicate</code> option.</p>
<p>The return value is an <code>unsubscribe()</code> callback that will remove this listener. By default, unsubscribing will <em>not</em> cancel any active instances of the listener. However, you may also pass in <code>{cancelActive: true}</code> to cancel running instances.</p>
<p>If you try to add a listener entry but another entry with this exact function reference already exists, no new entry will be added, and the existing <code>unsubscribe</code> method will be returned.</p>
<p>The <code>effect</code> callback will receive the current action as its first argument, as well as a "listener API" object similar to the "thunk API" object in <code>createAsyncThunk</code>.</p>
<p>All listener predicates and callbacks are checked <em>after</em> the root reducer has already processed the action and updated the state. The <code>listenerApi.getOriginalState()</code> method can be used to get the state value that existed before the action that triggered this listener was processed.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=stoplistening><code>stopListening</code><a href=#stoplistening class=hash-link aria-label="Direct link to stoplistening" title="Direct link to stoplistening">​</a></h3>
<p>Removes a given listener entry.</p>
<p>It accepts the same arguments as <code>startListening()</code>. It checks for an existing listener entry by comparing the function references of <code>listener</code> and the provided <code>actionCreator/matcher/predicate</code> function or <code>type</code> string.</p>
<p>By default, this does <em>not</em> cancel any active running instances. However, you may also pass in <code>{cancelActive: true}</code> to cancel running instances.</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#E6D874>stopListening</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  options</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AddListenerOptions </span><span class="token operator" style=color:#F8F8F2>&</span><span class="token plain"> UnsubscribeListenerOptions</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>boolean</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">UnsubscribeListenerOptions</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  cancelActive</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Returns <code>true</code> if the listener entry has been removed, or <code>false</code> if no subscription matching the input provided has been found.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#778090>// Examples:</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 1) Action type string</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>stopListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>type</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'todos/todoAdded'</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  listener</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>cancelActive</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 2) RTK action creator</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>stopListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> todoAdded</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 3) RTK matcher function</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>stopListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> matcher</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token literal-property property" style=color:#F92672>cancelActive</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token comment" style=color:#778090>// 4) Listener predicate</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>stopListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> predicate</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=clearlisteners><code>clearListeners</code><a href=#clearlisteners class=hash-link aria-label="Direct link to clearlisteners" title="Direct link to clearlisteners">​</a></h3>
<p>Removes all current listener entries. It also cancels all active running instances of those listeners as well.</p>
<p>This is most likely useful for test scenarios where a single middleware or store instance might be used in multiple tests, as well as some app cleanup situations.</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#E6D874>clearListeners</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token punctuation" style=color:#F8F8F2>;</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=action-creators>Action Creators<a href=#action-creators class=hash-link aria-label="Direct link to Action Creators" title="Direct link to Action Creators">​</a></h2>
<p>In addition to adding and removing listeners by directly calling methods on the listener instance, you can dynamically add and remove listeners at runtime by dispatching special "add" and "remove" actions. These are exported from the main RTK package as standard RTK-generated action creators.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=addlistener><code>addListener</code><a href=#addlistener class=hash-link aria-label="Direct link to addlistener" title="Direct link to addlistener">​</a></h3>
<p>A standard RTK action creator, imported from the package. Dispatching this action tells the middleware to dynamically add a new listener at runtime. It accepts exactly the same options as <code>startListening()</code></p>
<p>Dispatching this action returns an <code>unsubscribe()</code> callback from <code>dispatch</code>.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#778090>// Per above, provide `predicate` or any of the other comparison options</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> unsubscribe </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> store</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>addListener</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> predicate</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=removelistener><code>removeListener</code><a href=#removelistener class=hash-link aria-label="Direct link to removelistener" title="Direct link to removelistener">​</a></h3>
<p>A standard RTK action creator, imported from the package. Dispatching this action tells the middleware to dynamically remove a listener at runtime. Accepts the same arguments as <code>stopListening()</code>.</p>
<p>By default, this does <em>not</em> cancel any active running instances. However, you may also pass in <code>{cancelActive: true}</code> to cancel running instances.</p>
<p>Returns <code>true</code> if the listener entry has been removed, <code>false</code> if no subscription matching the input provided has been found.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> wasRemoved </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> store</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>removeListener</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> predicate</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token literal-property property" style=color:#F92672>cancelActive</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=clearalllisteners><code>clearAllListeners</code><a href=#clearalllisteners class=hash-link aria-label="Direct link to clearalllisteners" title="Direct link to clearalllisteners">​</a></h3>
<p>A standard RTK action creator, imported from the package. Dispatching this action tells the middleware to remove all current listener entries. It also cancels all active running instances of those listeners as well.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token plain">store</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>clearAllListeners</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=listener-api>Listener API<a href=#listener-api class=hash-link aria-label="Direct link to Listener API" title="Direct link to Listener API">​</a></h2>
<p>The <code>listenerApi</code> object is the second argument to each listener callback. It contains several utility functions that may be called anywhere inside the listener's logic.</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">ListenerEffectAPI</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  State</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  Dispatch </span><span class="token class-name keyword" style=color:#F92672>extends</span><span class="token class-name"> ReduxDispatch</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">UnknownAction</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name">  ExtraArgument </span><span class="token class-name operator" style=color:#F8F8F2>=</span><span class="token class-name"> </span><span class="token class-name builtin" style=color:#a6e22e>unknown</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token class-name"></span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>extends</span><span class="token plain"> </span><span class="token class-name">MiddlewareAPI</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">Dispatch</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"> State</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// NOTE: MiddlewareAPI contains `dispatch` and `getState` already</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Returns the store state as it existed when the action was originally dispatched, _before_ the reducers ran.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * This function can **only** be invoked **synchronously**, it throws error otherwise.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>getOriginalState</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> State</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Removes the listener entry from the middleware and prevent future instances of the listener from running.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * It does **not** cancel any active instances.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>unsubscribe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * It will subscribe a listener if it was previously removed, noop otherwise.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>subscribe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Returns a promise that resolves when the input predicate returns `true` or</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * rejects if the listener has been cancelled or is completed.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   *</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * The return value is `true` if the predicate succeeds or `false` if a timeout is provided and expires first.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  condition</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ConditionFunction</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">State</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Returns a promise that resolves when the input predicate returns `true` or</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * rejects if the listener has been cancelled or is completed.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   *</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * The return value is the `[action, currentState, previousState]` combination that the predicate saw as arguments.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   *</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * The promise resolves to null if a timeout is provided and expires first.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  take</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> TakePattern</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">State</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Cancels all other running instances of this same listener except for the one that made this call.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>cancelActiveListeners</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Cancels the listener instance that made this call.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>cancel</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Throws a `TaskAbortError` if this listener has been cancelled</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>throwIfCancelled</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * An abort signal whose `aborted` property is set to `true`</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * if the listener execution is either aborted or completed.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * </span><span class="token doc-comment comment keyword" style=color:#F92672>@see</span><span class="token doc-comment comment" style=color:#778090> https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  signal</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AbortSignal</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Returns a promise that resolves after `timeoutMs` or</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * rejects if the listener has been cancelled or is completed.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">timeoutMs</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>number</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token keyword" style=color:#F92672>void</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Queues in the next microtask the execution of a task.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token generic-function function" style=color:#E6D874>fork</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>&lt;</span><span class="token generic-function generic class-name constant" style=color:#F92672>T</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">executor</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ForkedTaskExecutor</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>T</span><span class="token operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ForkedTask</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>T</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token doc-comment comment" style=color:#778090>/**</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * Returns a promise that resolves when `waitFor` resolves or</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * rejects if the listener has been cancelled or is completed.</span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   * </span><span class="token doc-comment comment keyword" style=color:#F92672>@param</span><span class="token doc-comment comment" style=color:#778090> </span><span class="token doc-comment comment parameter" style=color:#778090>promise</span><span class="token doc-comment comment" style=color:#778090></span><br></span><span class=token-line style=color:#f8f8f2><span class="token doc-comment comment" style=color:#778090>   */</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token generic-function function" style=color:#E6D874>pause</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>&lt;</span><span class="token generic-function generic class-name constant" style=color:#F92672>M</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">promise</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>M</span><span class="token operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>M</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  extra</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ExtraArgument</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>These can be divided into several categories.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=store-interaction-methods>Store Interaction Methods<a href=#store-interaction-methods class=hash-link aria-label="Direct link to Store Interaction Methods" title="Direct link to Store Interaction Methods">​</a></h3>
<ul>
<li><code>dispatch: Dispatch</code>: the standard <code>store.dispatch</code> method</li>
<li><code>getState: () => State</code>: the standard <code>store.getState</code> method</li>
<li><code>getOriginalState: () => State</code>: returns the store state as it existed when the action was originally dispatched, <em>before</em> the reducers ran. (<strong>Note</strong>: this method can only be called synchronously, during the initial dispatch call stack, to avoid memory leaks. Calling it asynchronously will throw an error.)</li>
<li><code>extra: unknown</code>: the "extra argument" that was provided as part of the middleware setup, if any</li>
</ul>
<p><code>dispatch</code> and <code>getState</code> are exactly the same as in a thunk. <code>getOriginalState</code> can be used to compare the original state before the listener was started.</p>
<p><code>extra</code> can be used to inject a value such as an API service layer into the middleware at creation time, and is accessible here.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=listener-subscription-management>Listener Subscription Management<a href=#listener-subscription-management class=hash-link aria-label="Direct link to Listener Subscription Management" title="Direct link to Listener Subscription Management">​</a></h3>
<ul>
<li><code>unsubscribe: () => void</code>: removes the listener entry from the middleware, and prevent future instances of the listener from running. (This does <em>not</em> cancel any active instances.)</li>
<li><code>subscribe: () => void</code>: will re-subscribe the listener entry if it was previously removed, or no-op if currently subscribed</li>
<li><code>cancelActiveListeners: () => void</code>: cancels all other running instances of this same listener <em>except</em> for the one that made this call. (The cancellation will only have a meaningful effect if the other instances are paused using one of the cancellation-aware APIs like <code>take/cancel/pause/delay</code> - see "Cancelation and Task Management" in the "Usage" section for more details)</li>
<li><code>cancel: () => void</code>: cancels the instance of this listener that made this call.</li>
<li><code>throwIfCancelled: () => void</code>: throws a <code>TaskAbortError</code> if the current listener instance was cancelled.</li>
<li><code>signal: AbortSignal</code>: An <a href=https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal target=_blank rel="noopener noreferrer"><code>AbortSignal</code></a> whose <code>aborted</code> property will be set to <code>true</code> if the listener execution is aborted or completed.</li>
</ul>
<p>Dynamically unsubscribing and re-subscribing this listener allows for more complex async workflows, such as avoiding duplicate running instances by calling <code>listenerApi.unsubscribe()</code> at the start of a listener, or calling <code>listenerApi.cancelActiveListeners()</code> to ensure that only the most recent instance is allowed to complete.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=conditional-workflow-execution>Conditional Workflow Execution<a href=#conditional-workflow-execution class=hash-link aria-label="Direct link to Conditional Workflow Execution" title="Direct link to Conditional Workflow Execution">​</a></h3>
<ul>
<li><code>take: (predicate: ListenerPredicate, timeout?: number) => Promise&lt;[Action, State, State] | null></code>: returns a promise that will resolve when the <code>predicate</code> returns <code>true</code>. The return value is the <code>[action, currentState, previousState]</code> combination that the predicate saw as arguments. If a <code>timeout</code> is provided and expires first, the promise resolves to <code>null</code>.</li>
<li><code>condition: (predicate: ListenerPredicate, timeout?: number) => Promise&lt;boolean></code>: Similar to <code>take</code>, but resolves to <code>true</code> if the predicate succeeds, and <code>false</code> if a <code>timeout</code> is provided and expires first. This allows async logic to pause and wait for some condition to occur before continuing. See "Writing Async Workflows" below for details on usage.</li>
<li><code>delay: (timeoutMs: number) => Promise&lt;void></code>: returns a cancellation-aware promise that resolves after the timeout, or rejects if cancelled before the expiration</li>
<li><code>pause: (promise: Promise&lt;T>) => Promise&lt;T></code>: accepts any promise, and returns a cancellation-aware promise that either resolves with the argument promise or rejects if cancelled before the resolution</li>
</ul>
<p>These methods provide the ability to write conditional logic based on future dispatched actions and state changes. Both also accept an optional <code>timeout</code> in milliseconds.</p>
<p><code>take</code> resolves to a <code>[action, currentState, previousState]</code> tuple or <code>null</code> if it timed out, whereas <code>condition</code> resolves to <code>true</code> if it succeeded or <code>false</code> if timed out.</p>
<p><code>take</code> is meant for "wait for an action and get its contents", while <code>condition</code> is meant for checks like <code>if (await condition(predicate))</code>.</p>
<p>Both these methods are cancellation-aware, and will throw a <code>TaskAbortError</code> if the listener instance is cancelled while paused.</p>
<p>Note that both <code>take</code> and <code>condition</code> will only resolve <strong>after the next action</strong> has been dispatched. They do not resolve immediately even if their predicate would return true for the current state.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=child-tasks>Child Tasks<a href=#child-tasks class=hash-link aria-label="Direct link to Child Tasks" title="Direct link to Child Tasks">​</a></h3>
<ul>
<li><code>fork: (executor: (forkApi: ForkApi) => T | Promise&lt;T>) => ForkedTask&lt;T></code>: Launches a "child task" that may be used to accomplish additional work. Accepts any sync or async function as its argument, and returns a <code>{result, cancel}</code> object that can be used to check the final status and return value of the child task, or cancel it while in-progress.</li>
</ul>
<p>Child tasks can be launched, and waited on to collect their return values. The provided <code>executor</code> function will be called asynchronously with a <code>forkApi</code> object containing <code>{pause, delay, signal}</code>, allowing it to pause or check cancellation status. It can also make use of the <code>listenerApi</code> from the listener's scope.</p>
<p>An example of this might be a listener that forks a child task containing an infinite loop that listens for events from a server. The parent then uses <code>listenerApi.condition()</code> to wait for a "stop" action, and cancels the child task.</p>
<p>The task and result types are:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">ForkedTaskAPI</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token generic-function function" style=color:#E6D874>pause</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>&lt;</span><span class="token generic-function generic class-name constant" style=color:#F92672>W</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">waitFor</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>W</span><span class="token operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>W</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">timeoutMs</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>number</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token keyword" style=color:#F92672>void</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  signal</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AbortSignal</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">TaskResolved</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name constant" style=color:#F92672>T</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>readonly</span><span class="token plain"> status</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'ok'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>readonly</span><span class="token plain"> value</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token constant" style=color:#F92672>T</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">TaskRejected</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>readonly</span><span class="token plain"> status</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'rejected'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>readonly</span><span class="token plain"> error</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>unknown</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">TaskCancelled</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>readonly</span><span class="token plain"> status</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'cancelled'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>readonly</span><span class="token plain"> error</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> TaskAbortError</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">TaskResult</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">Value</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> TaskResolved</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">Value</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> TaskRejected</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> TaskCancelled</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>interface</span><span class="token plain"> </span><span class="token class-name">ForkedTask</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name constant" style=color:#F92672>T</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  result</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">TaskResult</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token constant" style=color:#F92672>T</span><span class="token operator" style=color:#F8F8F2>>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>cancel</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>void</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=typescript-usage>TypeScript Usage<a href=#typescript-usage class=hash-link aria-label="Direct link to TypeScript Usage" title="Direct link to TypeScript Usage">​</a></h2>
<p>The middleware code is fully TS-typed. However, the <code>startListening</code> and <code>addListener</code> functions do not know what the store's <code>RootState</code> type looks like by default, so <code>getState()</code> will return <code>unknown</code>.</p>
<p>To fix this, the middleware provides types for defining "pre-typed" versions of those methods, similar to the pattern used for defing pre-typed React-Redux hooks. We specifically recommend creating the middleware instance in a separate file from the actual <code>configureStore()</code> call:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#778090>// listenerMiddleware.ts</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> createListenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> addListener </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'@reduxjs/toolkit'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> RootState</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> AppDispatch </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'./store'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>declare</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">ExtraArgument</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain">foo</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>string</span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> listenerMiddleware </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>createListenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> startAppListening </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">startListening</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token generic-function function" style=color:#E6D874>withTypes</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>&lt;</span><span class="token generic-function generic class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token generic-function generic class-name">  RootState</span><span class="token generic-function generic class-name punctuation" style=color:#F8F8F2>,</span><span class="token generic-function generic class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token generic-function generic class-name">  AppDispatch</span><span class="token generic-function generic class-name punctuation" style=color:#F8F8F2>,</span><span class="token generic-function generic class-name"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token generic-function generic class-name">  ExtraArgument</span><br></span><span class=token-line style=color:#f8f8f2><span class="token generic-function generic class-name"></span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> addAppListener </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> addListener</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token generic-function function" style=color:#E6D874>withTypes</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>&lt;</span><span class="token generic-function generic class-name">RootState</span><span class="token generic-function generic class-name punctuation" style=color:#F8F8F2>,</span><span class="token generic-function generic class-name"> AppDispatch</span><span class="token generic-function generic class-name operator" style=color:#F8F8F2>></span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Then import and use those pre-typed methods in your components.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=usage-guide>Usage Guide<a href=#usage-guide class=hash-link aria-label="Direct link to Usage Guide" title="Direct link to Usage Guide">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=overall-purpose>Overall Purpose<a href=#overall-purpose class=hash-link aria-label="Direct link to Overall Purpose" title="Direct link to Overall Purpose">​</a></h3>
<p>This middleware lets you run additional logic when some action is dispatched, as a lighter-weight alternative to middleware like sagas and observables that have both a heavy runtime bundle cost and a large conceptual overhead.</p>
<p>This middleware is not intended to handle all possible use cases. Like thunks, it provides you with a basic set of primitives (including access to <code>dispatch</code> and <code>getState</code>), and gives you freedom to write any sync or async logic you want. This is both a strength (you can do anything!) and a weakness (you can do anything, with no guard rails!).</p>
<p>The middleware includes several async workflow primitives that are sufficient to write equivalents to many Redux-Saga effects operators like <code>takeLatest</code>, <code>takeLeading</code>, and <code>debounce</code>, although none of those methods are directly included. (See <a href=https://github.com/reduxjs/redux-toolkit/blob/03eafd5236f16574935cdf1c5958e32ee8cf3fbe/packages/toolkit/src/listenerMiddleware/tests/effectScenarios.test.ts#L74-L363 target=_blank rel="noopener noreferrer">the listener middleware tests file for examples of how to write code equivalent to those effects</a>.)</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=standard-usage-patterns>Standard Usage Patterns<a href=#standard-usage-patterns class=hash-link aria-label="Direct link to Standard Usage Patterns" title="Direct link to Standard Usage Patterns">​</a></h3>
<p>The most common expected usage is "run some logic after a given action was dispatched". For example, you could set up a simple analytics tracker by looking for certain actions and sending extracted data to the server, including pulling user details from the store:</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>matcher</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>isAnyOf</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action1</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> action2</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> action3</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> user </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>selectUserDetails</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>getState</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> specialData </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> action</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">meta</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    analyticsApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>trackUsage</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">type</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> user</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> specialData</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>However, the <code>predicate</code> option also allows triggering logic when some state value has changed, or when the state matches a particular condition:</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>predicate</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> currentState</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> previousState</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Trigger logic whenever this field changes</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword control-flow" style=color:#F92672>return</span><span class="token plain"> currentState</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">counter</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>!==</span><span class="token plain"> previousState</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">counter</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  effect</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>predicate</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> currentState</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> previousState</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Trigger logic after every action if this condition is true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword control-flow" style=color:#F92672>return</span><span class="token plain"> currentState</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">counter</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  effect</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You could also implement a generic API fetching capability, where the UI dispatches a plain action describing the type of resource to be requested, and the middleware automatically fetches it and dispatches a result action:</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> resourceRequested</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> name</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> args </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> action</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">payload</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>resourceLoading</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> res </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> serverApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>fetch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token template-string template-punctuation string" style=color:#a6e22e>`</span><span class="token template-string string" style=color:#a6e22e>/api/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#F8F8F2>${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#F8F8F2>}</span><span class="token template-string template-punctuation string" style=color:#a6e22e>`</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token spread operator" style=color:#F8F8F2>...</span><span class="token plain">args</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>resourceLoaded</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">res</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">data</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>(That said, we would recommend use of RTK Query for any meaningful data fetching behavior - this is primarily an example of what you <em>could</em> do in a listener.)</p>
<p>The <code>listenerApi.unsubscribe</code> method may be used at any time, and will remove the listener from handling any future actions. As an example, you could create a one-shot listener by unconditionally calling <code>unsubscribe()</code> in the body - the effect callback would run the first time the relevant action is seen, then immediately unsubscribe and never run again. (The middleware actually uses this technique internally for the <code>take/condition</code> methods)</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=writing-async-workflows-with-conditions>Writing Async Workflows with Conditions<a href=#writing-async-workflows-with-conditions class=hash-link aria-label="Direct link to Writing Async Workflows with Conditions" title="Direct link to Writing Async Workflows with Conditions">​</a></h3>
<p>One of the great strengths of both sagas and observables is their support for complex async workflows, including stopping and starting behavior based on specific dispatched actions. However, the weakness is that both require mastering a complex API with many unique operators (effects methods like <code>call()</code> and <code>fork()</code> for sagas, RxJS operators for observables), and both add a significant amount to application bundle size.</p>
<p>While the listener middleware is <em>not</em> meant to fully replace sagas or observables, it does provide a carefully chosen set of APIs to implement long-running async workflows as well.</p>
<p>Listeners can use the <code>condition</code> and <code>take</code> methods in <code>listenerApi</code> to wait until some action is dispatched or state check is met. The <code>condition</code> method is directly inspired by <a href=https://docs.temporal.io/docs/typescript/workflows/#condition target=_blank rel="noopener noreferrer">the <code>condition</code> function in Temporal.io's workflow API</a> (credit to <a href=https://twitter.com/swyx target=_blank rel="noopener noreferrer">@swyx</a> for the suggestion!), and <code>take</code> is inspired by <a href=https://redux-saga.js.org/docs/api#takepattern target=_blank rel="noopener noreferrer">the <code>take</code> effect from Redux-Saga</a>.</p>
<p>The signatures are:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">ConditionFunction</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">Action </span><span class="token class-name keyword" style=color:#F92672>extends</span><span class="token class-name"> ReduxAction</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"> State</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  predicate</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerPredicate</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">Action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> State</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>boolean</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  timeout</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>number</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token builtin" style=color:#a6e22e>boolean</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name">TakeFunction</span><span class="token class-name operator" style=color:#F8F8F2>&lt;</span><span class="token class-name">Action </span><span class="token class-name keyword" style=color:#F92672>extends</span><span class="token class-name"> ReduxAction</span><span class="token class-name punctuation" style=color:#F8F8F2>,</span><span class="token class-name"> State</span><span class="token class-name operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  predicate</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> ListenerPredicate</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token plain">Action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> State</span><span class="token operator" style=color:#F8F8F2>></span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>boolean</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  timeout</span><span class="token operator" style=color:#F8F8F2>?</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>number</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token builtin" style=color:#a6e22e>Promise</span><span class="token operator" style=color:#F8F8F2>&lt;</span><span class="token punctuation" style=color:#F8F8F2>[</span><span class="token plain">Action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> State</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> State</span><span class="token punctuation" style=color:#F8F8F2>]</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>|</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>null</span><span class="token operator" style=color:#F8F8F2>></span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>You can use <code>await condition(somePredicate)</code> as a way to pause execution of your listener callback until some criteria is met.</p>
<p>The <code>predicate</code> will be called after every action is processed by the reducers, and should return <code>true</code> when the condition should resolve. (It is effectively a one-shot listener itself.) If a <code>timeout</code> number (in ms) is provided, the promise will resolve <code>true</code> if the <code>predicate</code> returns first, or <code>false</code> if the timeout expires. This allows you to write comparisons like <code>if (await condition(predicate, timeout))</code>.</p>
<p>This should enable writing longer-running workflows with more complex async logic, such as <a href=https://github.com/redux-saga/redux-saga/blob/1ecb1bed867eeafc69757df8acf1024b438a79e0/examples/cancellable-counter/src/sagas/index.js target=_blank rel="noopener noreferrer">the "cancellable counter" example from Redux-Saga</a>.</p>
<p>An example of <code>condition</code> usage, from the test suite:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#E6D874>test</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'condition method resolves promise when there is a timeout'</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>let</span><span class="token plain"> finalCount </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>let</span><span class="token plain"> listenerStarted </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function-variable function" style=color:#E6D874>predicate</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> currentState</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> CounterState</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>return</span><span class="token plain"> increment</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>match</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>&&</span><span class="token plain"> currentState</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">value </span><span class="token operator" style=color:#F8F8F2>===</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>0</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      listenerStarted </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Wait for either the counter to hit 3, or 50ms to elapse</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> result </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>await</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>condition</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> currentState</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> CounterState</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token keyword" style=color:#F92672>return</span><span class="token plain"> currentState</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">value </span><span class="token operator" style=color:#F8F8F2>===</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>3</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token number" style=color:#AE81FF>50</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// In this test, we expect the timeout to happen first</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token function" style=color:#E6D874>expect</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">result</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>toBe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token boolean" style=color:#AE81FF>false</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Save the state for comparison outside the listener</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> latestState </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>getState</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      finalCount </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> latestState</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">value</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  store</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>increment</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// The listener should have started right away</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>expect</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">listenerStarted</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>toBe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token boolean" style=color:#AE81FF>true</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  store</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>increment</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// If we wait 150ms, the condition timeout will expire first</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>await</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>150</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Update the state one more time to confirm the listener isn't checking it</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  store</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>increment</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Handled the state update before the delay, but not after</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>expect</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">finalCount</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>toBe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>2</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=cancellation-and-task-management>Cancellation and Task Management<a href=#cancellation-and-task-management class=hash-link aria-label="Direct link to Cancellation and Task Management" title="Direct link to Cancellation and Task Management">​</a></h3>
<p>The listener middleware supports cancellation of running listener instances, <code>take/condition/pause/delay</code> functions, and "child tasks", with an implementation based on <a href=https://developer.mozilla.org/en-US/docs/Web/API/AbortController target=_blank rel="noopener noreferrer"><code>AbortController</code></a>.</p>
<p>The <code>listenerApi.pause/delay()</code> functions provide a cancellation-aware way to have the current listener sleep. <code>pause()</code> accepts a promise, while <code>delay</code> accepts a timeout value. If the listener is cancelled while waiting, a <code>TaskAbortError</code> will be thrown. In addition, both <code>take</code> and <code>condition</code> support cancellation interruption as well.</p>
<p><code>listenerApi.cancelActiveListeners()</code> will cancel <em>other</em> existing instances that are running, while <code>listenerApi.cancel()</code> can be used to cancel the <em>current</em> instance (which may be useful from a fork, which could be deeply nested and not able to directly throw a promise to break out of the effect execution). <code>listenerAPi.throwIfCancelled()</code> can also be useful to bail out of workflows in case cancellation happened while the effect was doing other work.</p>
<p><code>listenerApi.fork()</code> can used to launch "child tasks" that can do additional work. These can be waited on to collect their results. An example of this might look like:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> increment</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Spawn a child task and start it immediately</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> task </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>fork</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">forkApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Artificially wait a bit inside the child</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>await</span><span class="token plain"> forkApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>5</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Complete the child by returning a value</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>return</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>42</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> result </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>await</span><span class="token plain"> task</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">result</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Unwrap the child result in the listener</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">result</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">status </span><span class="token operator" style=color:#F8F8F2>===</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'ok'</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Logs the `42` result value that was returned</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token builtin" style=color:#a6e22e>console</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>log</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'Child succeeded: '</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> result</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">value</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=complex-async-workflows>Complex Async Workflows<a href=#complex-async-workflows class=hash-link aria-label="Direct link to Complex Async Workflows" title="Direct link to Complex Async Workflows">​</a></h3>
<p>The provided async workflow primitives (<code>cancelActiveListeners</code>, <code>cancel</code>, <code>unsubscribe</code>, <code>subscribe</code>, <code>take</code>, <code>condition</code>, <code>pause</code>, <code>delay</code>) can be used to implement behavior that is equivalent to many of the more complex async workflow capabilities found in the Redux-Saga library. This includes effects such as <code>throttle</code>, <code>debounce</code>, <code>takeLatest</code>, <code>takeLeading</code>, and <code>fork/join</code>. Some examples from the test suite:</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#E6D874>test</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'debounce / takeLatest'</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Repeated calls cancel previous ones, no work performed</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// until the specified delay elapses without another call</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// NOTE: This is also basically identical to `takeLatest`.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Ref: https://redux-saga.js.org/docs/api#debouncems-pattern-saga-args</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Ref: https://redux-saga.js.org/docs/api#takelatestpattern-saga-args</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> increment</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Cancel any in-progress instances of this listener</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>cancelActiveListeners</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Delay before starting actual work</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>15</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// do work here</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#E6D874>test</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'takeLeading'</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Starts listener on first action, ignores others until task completes</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Ref: https://redux-saga.js.org/docs/api#takeleadingpattern-saga-args</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> increment</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      listenerCalls</span><span class="token operator" style=color:#F8F8F2>++</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Stop listening for this action</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>unsubscribe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Pretend we're doing expensive work</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token comment" style=color:#778090>// Re-enable the listener</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>subscribe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#E6D874>test</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'cancelled'</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// cancelled allows checking if the current task was cancelled</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Ref: https://redux-saga.js.org/docs/api#cancelled</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>let</span><span class="token plain"> canceledAndCaught </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>let</span><span class="token plain"> canceledCheck </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Example of canceling prior instances conditionally and checking cancellation</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token literal-property property" style=color:#F92672>matcher</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>isAnyOf</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">increment</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> decrement</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> incrementByAmount</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">increment</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>match</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#778090>// Have this branch wait around to be cancelled by the other</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword control-flow" style=color:#F92672>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>10</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token comment" style=color:#778090>// Can check cancellation based on the exception and its reason</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">err </span><span class="token keyword" style=color:#F92672>instanceof</span><span class="token plain"> </span><span class="token class-name">TaskAbortError</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            canceledAndCaught </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>else</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">incrementByAmount</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>match</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#778090>// do a non-cancellation-aware wait</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword control-flow" style=color:#F92672>await</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>delay</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token number" style=color:#AE81FF>15</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">signal</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token property-access">aborted</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          canceledCheck </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token boolean" style=color:#AE81FF>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>else</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">decrement</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>match</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token method function property-access" style=color:#E6D874>cancelActiveListeners</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>As a more practical example: <a href=https://gist.github.com/markerikson/5203e71a69fa9dff203c9e27c3d84154 target=_blank rel="noopener noreferrer">this saga-based "long polling" loop</a> repeatedly asks the server for a message and then processes each response. The child loop is started on demand when a "start polling" action is dispatched, and the loop is cancelled when a "stop polling" action is dispatched.</p>
<p>That approach can be implemented via the listener middleware:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token comment" style=color:#778090>// Track how many times each message was processed by the loop</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> receivedMessages </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  a</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>0</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  b</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>0</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  c</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token number" style=color:#AE81FF>0</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> eventPollingStarted </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>createAction</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'serverPolling/started'</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> eventPollingStopped </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>createAction</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token string" style=color:#a6e22e>'serverPolling/stopped'</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> eventPollingStarted</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">action</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Only allow one instance of this listener to run at a time</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>unsubscribe</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Start a child job that will infinitely loop receiving messages</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> pollingTask </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>fork</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token keyword" style=color:#F92672>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">forkApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token keyword" style=color:#F92672>try</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#F92672>while</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token boolean" style=color:#AE81FF>true</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token comment" style=color:#778090>// Cancellation-aware pause for a new server message</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> serverEvent </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>await</span><span class="token plain"> forkApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>pause</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token function" style=color:#E6D874>pollForEvent</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token comment" style=color:#778090>// Process the message. In this case, just count the times we've seen this message.</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token keyword" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">serverEvent</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name keyword" style=color:#F92672>in</span><span class="token plain"> receivedMessages</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            receivedMessages</span><span class="token punctuation" style=color:#F8F8F2>[</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">              serverEvent</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token class-name keyword" style=color:#F92672>as</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>keyof</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>typeof</span><span class="token plain"> receivedMessages</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">            </span><span class="token punctuation" style=color:#F8F8F2>]</span><span class="token operator" style=color:#F8F8F2>++</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>catch</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token keyword" style=color:#F92672>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">err </span><span class="token keyword" style=color:#F92672>instanceof</span><span class="token plain"> </span><span class="token class-name">TaskAbortError</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">          </span><span class="token comment" style=color:#778090>// could do something here to track that the task was cancelled</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token comment" style=color:#778090>// Wait for the "stop polling" action</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token keyword" style=color:#F92672>await</span><span class="token plain"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>condition</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">eventPollingStopped</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">match</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    pollingTask</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>cancel</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=adding-listeners-inside-components>Adding Listeners Inside Components<a href=#adding-listeners-inside-components class=hash-link aria-label="Direct link to Adding Listeners Inside Components" title="Direct link to Adding Listeners Inside Components">​</a></h3>
<p>Listeners can be added at runtime via <code>dispatch(addListener())</code>. This means that you can add listeners anywhere you have access to <code>dispatch</code>, and that includes React components.</p>
<p>Since dispatching <code>addListener</code> returns an <code>unsubscribe</code> callback, this naturally maps to the behavior of React <code>useEffect</code> hooks, which let you return a cleanup function. You can add a listener in an effect, and remove the listener when the hook is cleaned up.</p>
<p>The basic pattern might look like:</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token function" style=color:#E6D874>useEffect</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// Could also just `return dispatch(addListener())` directly, but showing this</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token comment" style=color:#778090>// as a separate variable to be clear on what's happening</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> unsubscribe </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>dispatch</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function" style=color:#E6D874>addListener</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token literal-property property" style=color:#F92672>actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> todoAdded</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token parameter">action</span><span class="token parameter punctuation" style=color:#F8F8F2>,</span><span class="token parameter"> listenerApi</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">        </span><span class="token comment" style=color:#778090>// do some useful logic here</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">      </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token keyword control-flow" style=color:#F92672>return</span><span class="token plain"> unsubscribe</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>[</span><span class="token punctuation" style=color:#F8F8F2>]</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>While this pattern is <em>possible</em>, <strong>we do not necessarily <em>recommend</em> doing this!</strong> The React and Redux communities have always tried to emphasize basing behavior on <em>state</em> as much as possible. Having React components directly tie into the Redux action dispatch pipeline could potentialy lead to codebases that are more difficult to maintain.</p>
<p>At the same time, this <em>is</em> a valid technique, both in terms of API behavior and potential use cases. It's been common to lazy-load sagas as part of a code-split app, and that has often required some complex additional setup work to "inject" sagas. In contrast, <code>dispatch(addListener())</code> fits naturally into a React component's lifecycle.</p>
<p>So, while we're not specifically encouraging use of this pattern, it's worth documenting here so that users are aware of it as a possibility.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=organizing-listeners-in-files>Organizing Listeners in Files<a href=#organizing-listeners-in-files class=hash-link aria-label="Direct link to Organizing Listeners in Files" title="Direct link to Organizing Listeners in Files">​</a></h3>
<p>As a starting point, <strong>it's best to create the listener middleware in a separate file, such as <code>app/listenerMiddleware.ts</code>, rather than in the same file as the store</strong>. This avoids any potential circular import problems from other files trying to import <code>middleware.addListener</code>.</p>
<p>From there, so far we've come up with three different ways to organize listener functions and setup.</p>
<p>First, you can import effect callbacks from slice files into the middleware file, and add the listeners:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_x_ju>app/listenerMiddleware.ts</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> action1</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> listener1 </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'../features/feature1/feature1Slice'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> action2</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> listener2 </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'../features/feature2/feature2Slice'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> action1</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> listener1 </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> action2</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"> effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> listener2 </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This is probably the simplest option, and mirrors how the store setup pulls together all the slice reducers to create the app.</p>
<p>The second option is the opposite: have the slice files import the middleware and directly add their listeners:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_x_ju>features/feature1/feature1Slice.ts</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> listenerMiddleware </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'../../app/listenerMiddleware'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> feature1Slice </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>createSlice</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token comment" style=color:#778090>/* */</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> action1 </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> feature1Slice</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">actions</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>default</span><span class="token plain"> feature1Slice</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">reducer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> action1</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This keeps all the logic in the slice, although it does lock the setup into a single middleware instance.</p>
<p>The third option is to create a setup function in the slice, but let the listener file call that on startup:</p>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_x_ju>features/feature1/feature1Slice.ts</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>type</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> AppStartListening </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'../../app/listenerMiddleware'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> feature1Slice </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token function" style=color:#E6D874>createSlice</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token comment" style=color:#778090>/* */</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> action1 </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> feature1Slice</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">actions</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>default</span><span class="token plain"> feature1Slice</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">reducer</span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token keyword" style=color:#F92672>export</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#E6D874>addFeature1Listeners</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">startListening</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> AppStartListening</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token function" style=color:#E6D874>startListening</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    actionCreator</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> action1</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">    </span><span class="token function-variable function" style=color:#E6D874>effect</span><span class="token operator" style=color:#F8F8F2>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"> </span><span class="token operator" style=color:#F8F8F2>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain">  </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token punctuation" style=color:#F8F8F2>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token punctuation" style=color:#F8F8F2>}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-ts codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#f8f8f2;--prism-background-color:#272822><div class=codeBlockTitle_x_ju>app/listenerMiddleware.ts</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-ts codeBlock_RMoD thin-scrollbar" style=color:#f8f8f2;background-color:#272822><code class=codeBlockLines_AclH><span class=token-line style=color:#f8f8f2><span class="token keyword" style=color:#F92672>import</span><span class="token plain"> </span><span class="token punctuation" style=color:#F8F8F2>{</span><span class="token plain"> addFeature1Listeners </span><span class="token punctuation" style=color:#F8F8F2>}</span><span class="token plain"> </span><span class="token keyword" style=color:#F92672>from</span><span class="token plain"> </span><span class="token string" style=color:#a6e22e>'../features/feature1/feature1Slice'</span><span class="token plain"></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#f8f8f2><span class="token plain"></span><span class="token function" style=color:#E6D874>addFeature1Listeners</span><span class="token punctuation" style=color:#F8F8F2>(</span><span class="token plain">listenerMiddleware</span><span class="token punctuation" style=color:#F8F8F2>.</span><span class="token plain">startListening</span><span class="token punctuation" style=color:#F8F8F2>)</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Feel free to use whichever of these approaches works best in your app.</div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/reduxjs/redux-toolkit/blob/master/docs/../docs/api/createListenerMiddleware.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_bHB7 aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_ydrU"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2024-07-17T10:52:37.000Z itemprop=dateModified>Jul 17, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/api/actionCreatorMiddleware><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Action Creator Middleware</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/api/createDynamicMiddleware><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>createDynamicMiddleware</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_XG6w thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#overview class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href=#basic-usage class="table-of-contents__link toc-highlight">Basic Usage</a></ul><li><a href=#createlistenermiddleware-1 class="table-of-contents__link toc-highlight"><code>createListenerMiddleware</code></a><ul><li><a href=#middleware-options class="table-of-contents__link toc-highlight">Middleware Options</a></ul><li><a href=#listener-middleware-instance class="table-of-contents__link toc-highlight">Listener Middleware Instance</a><ul><li><a href=#middleware class="table-of-contents__link toc-highlight"><code>middleware</code></a><li><a href=#startlistening class="table-of-contents__link toc-highlight"><code>startListening</code></a><li><a href=#stoplistening class="table-of-contents__link toc-highlight"><code>stopListening</code></a><li><a href=#clearlisteners class="table-of-contents__link toc-highlight"><code>clearListeners</code></a></ul><li><a href=#action-creators class="table-of-contents__link toc-highlight">Action Creators</a><ul><li><a href=#addlistener class="table-of-contents__link toc-highlight"><code>addListener</code></a><li><a href=#removelistener class="table-of-contents__link toc-highlight"><code>removeListener</code></a><li><a href=#clearalllisteners class="table-of-contents__link toc-highlight"><code>clearAllListeners</code></a></ul><li><a href=#listener-api class="table-of-contents__link toc-highlight">Listener API</a><ul><li><a href=#store-interaction-methods class="table-of-contents__link toc-highlight">Store Interaction Methods</a><li><a href=#listener-subscription-management class="table-of-contents__link toc-highlight">Listener Subscription Management</a><li><a href=#conditional-workflow-execution class="table-of-contents__link toc-highlight">Conditional Workflow Execution</a><li><a href=#child-tasks class="table-of-contents__link toc-highlight">Child Tasks</a></ul><li><a href=#typescript-usage class="table-of-contents__link toc-highlight">TypeScript Usage</a><li><a href=#usage-guide class="table-of-contents__link toc-highlight">Usage Guide</a><ul><li><a href=#overall-purpose class="table-of-contents__link toc-highlight">Overall Purpose</a><li><a href=#standard-usage-patterns class="table-of-contents__link toc-highlight">Standard Usage Patterns</a><li><a href=#writing-async-workflows-with-conditions class="table-of-contents__link toc-highlight">Writing Async Workflows with Conditions</a><li><a href=#cancellation-and-task-management class="table-of-contents__link toc-highlight">Cancellation and Task Management</a><li><a href=#complex-async-workflows class="table-of-contents__link toc-highlight">Complex Async Workflows</a><li><a href=#adding-listeners-inside-components class="table-of-contents__link toc-highlight">Adding Listeners Inside Components</a><li><a href=#organizing-listeners-in-files class="table-of-contents__link toc-highlight">Organizing Listeners in Files</a></ul></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/introduction/getting-started>Getting Started</a><li class=footer__item><a class=footer__link-item href=/tutorials/overview>Tutorials</a><li class=footer__item><a class=footer__link-item href=/usage/usage-guide>Usage Guide</a><li class=footer__item><a class=footer__link-item href=/api/configureStore>API Reference</a><li class=footer__item><a class=footer__link-item href=/rtk-query/overview>RTK Query</a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=http://stackoverflow.com/questions/tagged/redux target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPrP><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://discord.gg/0ZcbPKXt5bZ6au5t target=_blank rel="noopener noreferrer" class=footer__link-item>Discord<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPrP><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.github.com/reduxjs/redux-toolkit target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPrP><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item>
                <a href=https://www.netlify.com>
                  <img src=https://www.netlify.com/img/global/badges/netlify-light.svg alt="Deploys by Netlify">
                </a>
              </ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/redux_white.svg alt="Redux Logo" class="footer__logo themedComponent_siVc themedComponent--light_hHel"><img src=/img/redux_white.svg alt="Redux Logo" class="footer__logo themedComponent_siVc themedComponent--dark_yETr"></div><div class=footer__copyright>Copyright © 2015–2025 Dan Abramov and the Redux documentation authors.</div></div></div></footer></div>