import{a as e,u as t,j as s,T as r,C as a,b as n,d as i,e as o,f as l,I as c,g as d,h as u,B as x,A as h,i as m,k as p,l as j,S as g,m as v,n as f,o as b,p as y,q as w,L as S,s as C,t as _,v as k,w as z,D as M,F as I,x as P,y as $,z as O,E as T,M as F,G as R,H as D,J as W,K as L,N as A,O as N,P as E,Q as H,R as B,U as V,V as U,W as q,X as G,Y as J,Z as K,_ as Q,$ as X,a0 as Y,a1 as Z,a2 as ee,a3 as te,a4 as se,a5 as re,a6 as ae,a7 as ne,a8 as ie,a9 as oe,aa as le,ab as ce,ac as de,ad as ue,ae as xe,af as he,ag as me,ah as pe,ai as je,aj as ge,ak as ve,al as fe}from"./mui-core-BU0_FeBM.js";import{r as be,u as ye,d as we,e as Se,f as Ce,N as _e,b as ke,B as ze}from"./router--Mlq8zNs.js";import{a as Me,g as Ie,b as Pe}from"./react-vendor-DHbHB7JU.js";import{l as $e}from"./socket-CUkmNz_4.js";import{R as Oe,B as Te,X as Fe,Y as Re,T as De,a as We,C as Le,P as Ae,b as Ne,L as Ee,c as He,d as Be}from"./charts-D28yhzhW.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ve,Ue={};const qe=Ie(function(){if(Ve)return Ue;Ve=1;var e=Me();return Ue.createRoot=e.createRoot,Ue.hydrateRoot=e.hydrateRoot,Ue}()),Ge={mode:"dark",primary:{main:"#00d4ff",light:"#5ce1ff",dark:"#00a4cc",contrastText:"#000000"},secondary:{main:"#7b2cbf",light:"#a855f7",dark:"#5b1d8f",contrastText:"#ffffff"},background:{default:"#1a1a2e",paper:"#16213e",gradientStop:"#0f3460"},text:{primary:"#ffffff",secondary:"#aaaaaa"},error:{main:"#ff4444"},warning:{main:"#ffaa00"},success:{main:"#00ff88"},divider:"rgba(255, 255, 255, 0.1)"},Je={mode:"light",primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0",contrastText:"#ffffff"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2",contrastText:"#ffffff"},background:{default:"#f5f5f5",paper:"#ffffff",gradientStop:"#e0e0e0"},text:{primary:"#000000",secondary:"#666666"},error:{main:"#d32f2f"},warning:{main:"#ed6c02"},success:{main:"#2e7d32"},divider:"rgba(0, 0, 0, 0.12)"};function Ke(e){const t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,s,r)=>t+t+s+s+r+r),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return s?`${parseInt(s[1],16)}, ${parseInt(s[2],16)}, ${parseInt(s[3],16)}`:"0, 0, 0"}const Qe=be.createContext(void 0),Xe="theme-mode";function Ye(e){if("undefined"!=typeof window&&window.localStorage)try{return localStorage.getItem(e)}catch{return null}return null}function Ze({children:n}){const i=t("(prefers-color-scheme: dark)"),[o,l]=be.useState(()=>{const e=Ye(Xe);return"light"===e||"dark"===e?e:i?"dark":"light"});be.useEffect(()=>{Ye(Xe)||l(i?"dark":"light")},[i]);const c=be.useCallback(()=>{l(e=>{const t="light"===e?"dark":"light";return function(e,t){if("undefined"!=typeof window&&window.localStorage)try{localStorage.setItem(e,t)}catch{}}(Xe,t),t})},[]),d=be.useMemo(()=>function(t){const s="dark"===t?Ge:Je;return e({palette:s,typography:{fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif",h1:{fontSize:"2.5rem",fontWeight:600},h2:{fontSize:"1.5rem",fontWeight:500},body1:{fontSize:"1rem"},body2:{fontSize:"0.9rem"}},shape:{borderRadius:12},transitions:{duration:{shortest:150,shorter:200,short:250,standard:300}},components:{MuiCssBaseline:{styleOverrides:{":root":{"--mui-palette-mode":t,"--mui-palette-primary-main":s.primary.main,"--mui-palette-primary-light":s.primary.light,"--mui-palette-primary-dark":s.primary.dark,"--mui-palette-primary-main-rgb":Ke(s.primary.main),"--mui-palette-secondary-main":s.secondary.main,"--mui-palette-secondary-light":s.secondary.light,"--mui-palette-secondary-dark":s.secondary.dark,"--mui-palette-secondary-main-rgb":Ke(s.secondary.main),"--mui-palette-background-default":s.background.default,"--mui-palette-background-paper":s.background.paper,"--mui-palette-background-gradient-stop":s.background.gradientStop,"--mui-palette-text-primary":s.text.primary,"--mui-palette-text-secondary":s.text.secondary,"--mui-palette-error-main":s.error.main,"--mui-palette-warning-main":s.warning.main,"--mui-palette-success-main":s.success.main,"--mui-palette-divider":s.divider},body:{transition:"background-color 0.3s ease, color 0.3s ease"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:8}}},MuiIconButton:{styleOverrides:{root:{transition:"background-color 0.2s ease, transform 0.2s ease","&:hover":{transform:"scale(1.1)"}}}},MuiPaper:{styleOverrides:{root:{backgroundImage:"none"}}},MuiTooltip:{styleOverrides:{tooltip:{fontSize:"0.85rem"}}}}})}(o),[o]),u=be.useMemo(()=>({mode:o,toggleTheme:c}),[o,c]);return s.jsx(Qe.Provider,{value:u,children:s.jsxs(r,{theme:d,children:[s.jsx(a,{}),n]})})}var et={},tt={};const st=Pe(n);var rt,at;function nt(){return rt||(rt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=st}(tt)),tt}function it(){if(at)return et;at=1;var e=i();Object.defineProperty(et,"__esModule",{value:!0}),et.default=void 0;var t=e(nt()),s=o();return et.default=(0,t.default)((0,s.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),et}const ot=Ie(it());var lt,ct={};function dt(){if(lt)return ct;lt=1;var e=i();Object.defineProperty(ct,"__esModule",{value:!0}),ct.default=void 0;var t=e(nt()),s=o();return ct.default=(0,t.default)((0,s.jsx)("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),ct}const ut=Ie(dt());var xt,ht={};function mt(){if(xt)return ht;xt=1;var e=i();Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var t=e(nt()),s=o();return ht.default=(0,t.default)((0,s.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),ht}const pt=Ie(mt());var jt,gt={};function vt(){if(jt)return gt;jt=1;var e=i();Object.defineProperty(gt,"__esModule",{value:!0}),gt.default=void 0;var t=e(nt()),s=o();return gt.default=(0,t.default)((0,s.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote"),gt}const ft=Ie(vt());var bt,yt={};function wt(){if(bt)return yt;bt=1;var e=i();Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var t=e(nt()),s=o();return yt.default=(0,t.default)((0,s.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),yt}const St=Ie(wt());var Ct,_t={};function kt(){if(Ct)return _t;Ct=1;var e=i();Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;var t=e(nt()),s=o();return _t.default=(0,t.default)((0,s.jsx)("path",{d:"M15 9H9v6h6zm-2 4h-2v-2h2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2zm-4 6H7V7h10z"}),"Memory"),_t}const zt=Ie(kt());var Mt,It={};function Pt(){if(Mt)return It;Mt=1;var e=i();Object.defineProperty(It,"__esModule",{value:!0}),It.default=void 0;var t=e(nt()),s=o();return It.default=(0,t.default)((0,s.jsx)("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2zM4 6h16v10H4z"}),"Computer"),It}const $t=Ie(Pt()),Ot=be.memo(function({connected:e}){return s.jsxs("div",{className:"connection-status "+(e?"connected":"disconnected"),children:[s.jsx("span",{className:"status "+(e?"status-online":"status-offline")}),s.jsx("span",{children:e?"Connected":"Disconnected"})]})}),Tt=[{id:"openwebui",name:"Open WebUI",port:3e3,icon:"ðŸ’¬",description:"Chat interface for LLMs. Connect to Ollama models for conversations, code assistance, and more.",tags:["Chat","LLM","Ollama"],cardClass:"card-openwebui",section:"main",external:!0,proxyId:"openwebui",models:["*"]},{id:"comfyui",name:"ComfyUI",port:8188,icon:"ðŸŽ¨",description:"Node-based image generation with Stable Diffusion. Create images with advanced workflows.",tags:["Image Gen","Stable Diffusion","Workflows"],cardClass:"card-comfyui",section:"main",proxyId:"comfyui"},{id:"alltalk",name:"AllTalk TTS",port:7851,icon:"ðŸŽ™ï¸",description:"Text-to-speech with voice cloning. Create custom voices from audio samples using XTTS v2.",tags:["TTS","Voice Clone","XTTS"],cardClass:"card-alltalk",section:"main",proxyId:"alltalk"},{id:"ollama",name:"Ollama API",port:11434,icon:"ðŸ¦™",description:"REST API for running local LLMs. Backend for Open WebUI and other applications.",tags:["API","Qwen 32B","Backend"],cardClass:"card-ollama",section:"main",external:!0,proxyId:"ollama",models:["*"]},{id:"wan2gp",name:"Wan2GP Video",port:7860,icon:"ðŸŽ¬",description:"AI video generation with Wan 2.1/2.2, LTX Video, Hunyuan Video, and Flux 2. Text-to-video and image-to-video.",tags:["Video Gen","Wan 2.1","LTX Video"],cardClass:"card-wan2gp",section:"main",proxyId:"wan2gp"},{id:"n8n",name:"N8N Workflows",port:5678,icon:"ðŸ”„",description:"Visual workflow automation to orchestrate local AI tools, APIs, and webhooks.",tags:["Automation","Workflows","Webhooks"],cardClass:"card-n8n",section:"main",proxyId:"n8n"},{id:"weaviate",name:"Weaviate Console",port:8081,icon:"ðŸ§ ",description:"Vector database explorer for semantic search, RAG, and long-term memory. Query and visualize data.",tags:["Vector DB","RAG","Memory"],cardClass:"card-weaviate",section:"main",external:!0,proxyId:"weaviate-console",instructions:"Connect to http://localhost:8080 (Weaviate API) to explore collections and query data."},{id:"yue",name:"YuE Music",port:7870,icon:"ðŸŽµ",description:"Full song generation with vocals from lyrics. Supports multiple languages and genres like EDM, pop, rock.",tags:["Text-to-Music","Vocals","5 min songs"],cardClass:"card-yue",section:"music",proxyId:"yue"},{id:"diffrhythm",name:"DiffRhythm",port:7871,icon:"ðŸŽ¼",description:"Fast full-song generation. Creates 4+ minute songs with vocals and instrumentals in ~10 seconds.",tags:["Fast Gen","Full Songs","Diffusion"],cardClass:"card-diffrhythm",section:"music",proxyId:"diffrhythm"},{id:"musicgen",name:"MusicGen",port:7872,icon:"ðŸŽ¹",description:"Meta's AudioCraft for high-quality instrumental music generation from text or melody prompts.",tags:["Instrumental","Meta AI","Melody Input"],cardClass:"card-musicgen",section:"music",proxyId:"musicgen"},{id:"stable_audio",name:"Stable Audio",port:7873,icon:"ðŸ”Š",description:"Sound effects, drum beats, ambient sounds, and production elements. Up to 47 second audio clips.",tags:["Sound FX","Beats","Ambient"],cardClass:"card-stableaudio",section:"music",proxyId:"stable-audio"},{id:"a1111",name:"A1111 WebUI",port:7861,icon:"ðŸ–¼ï¸",description:"AUTOMATIC1111 Stable Diffusion Web UI. The classic interface for image generation with extensive features.",tags:["Image Gen","SD","Classic"],cardClass:"card-a1111",section:"image",proxyId:"a1111"},{id:"forge",name:"SD Forge",port:7862,icon:"âš’ï¸",description:"Stable Diffusion WebUI Forge. Optimized fork with better memory management and faster generation.",tags:["Image Gen","SD","Optimized"],cardClass:"card-forge",section:"image",proxyId:"forge"},{id:"fooocus",name:"Fooocus",port:7865,icon:"ðŸŽ¯",description:"Simplified Stable Diffusion interface inspired by Midjourney. Focus on prompts, minimal settings.",tags:["Image Gen","Simple","Midjourney-like"],cardClass:"card-fooocus",section:"image",proxyId:"fooocus"}],Ft=()=>window.location.origin;function Rt(e){const t=Math.floor(e/3600),s=Math.floor(e%3600/60);if(t>0)return`${t}h ${s}m`;return`${s}m ${Math.floor(e%60)}s`}const Dt=be.memo(function(){const[e,t]=be.useState(null),[r,a]=be.useState(!0),[n,i]=be.useState(!1),o=be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/health`,{credentials:"include"});if(!e.ok)throw new Error("Health check failed");const s=await e.json();t(s),i(!1)}catch(e){i(!0)}finally{a(!1)}},[]);if(be.useEffect(()=>{o();const e=setInterval(o,3e4);return()=>clearInterval(e)},[o]),r)return null;if(n&&!e)return s.jsxs("div",{className:"health-status error",children:[s.jsx("span",{className:"health-indicator"}),s.jsx("span",{className:"health-text",children:"Health Check Failed"})]});if(!e)return null;const l={healthy:"healthy",warning:"warning",error:"error"}[e.status]||"error";const c=e.status.charAt(0).toUpperCase()+e.status.slice(1),d=n&&e;return s.jsxs("div",{className:`health-status ${l}${d?" stale":""}`,title:`CPU: ${e.cpu.percent.toFixed(1)}% | Memory: ${e.memory.percent.toFixed(1)}% | Services: ${e.services.running}/${e.services.total}${d?" | Data may be stale":""}`,children:[s.jsx("span",{className:"health-indicator"}),s.jsxs("span",{className:"health-text",children:[c," â€¢ ",Rt(e.uptime_seconds),d?" (stale)":""]})]})});var Wt,Lt={};function At(){if(Wt)return Lt;Wt=1;var e=i();Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.default=void 0;var t=e(nt()),s=o();return Lt.default=(0,t.default)((0,s.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6"}),"Brightness4"),Lt}const Nt=Ie(At());var Et,Ht={};function Bt(){if(Et)return Ht;Et=1;var e=i();Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.default=void 0;var t=e(nt()),s=o();return Ht.default=(0,t.default)((0,s.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4"}),"Brightness7"),Ht}const Vt=Ie(Bt()),Ut=be.memo(function(){const{mode:e,toggleTheme:t}=function(){const e=be.useContext(Qe);if(void 0===e)throw new Error("useThemeMode must be used within a ThemeProvider");return e}(),r="dark"===e?"Switch to light mode":"Switch to dark mode";return s.jsx(l,{title:r,arrow:!0,children:s.jsx(c,{onClick:t,className:"theme-toggle","aria-label":r,sx:{color:"var(--mui-palette-primary-main)",transition:"transform 0.3s ease, color 0.3s ease","&:hover":{backgroundColor:"rgba(var(--mui-palette-primary-main-rgb), 0.1)"}},children:"dark"===e?s.jsx(Vt,{className:"theme-icon"}):s.jsx(Nt,{className:"theme-icon"})})})});function qt(){const[e,t]=be.useState(!1),[s,r]=be.useState({}),a=be.useRef(null),n=be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/services`,{credentials:"include"});if(!e.ok)return;const t=await e.json();t&&t.services&&r(t.services)}catch(e){}},[]);be.useEffect(()=>{const e=new AbortController;return fetch(`${Ft()}/api/auth/token`,{credentials:"include",signal:e.signal}).then(t=>{if(!e.signal.aborted){if(!t.ok)throw new Error("Authentication required");return t.json()}}).then(s=>{if(e.signal.aborted||!s)return;const i=$e(Ft(),{transports:["websocket","polling"],auth:{token:s.token}});a.current=i,i.on("connect",()=>{t(!0),n()}),i.on("disconnect",()=>{t(!1)}),i.on("service_status",e=>{r(t=>t[e.service_id]?{...t,[e.service_id]:{...t[e.service_id],status:e.status,error:e.message||null}}:t)}),i.on("model_download_progress",e=>{const t=window.__updateModelDownloadProgress;t&&t(e)}),i.on("model_load_progress",e=>{const t=window.__updateModelLoadProgress;t&&t(e)})}).catch(e=>{"AbortError"!==e.name&&(t(!1),n())}),()=>{e.abort(),a.current&&a.current.disconnect()}},[n]);return{connected:e,services:s,startService:be.useCallback(async e=>{r(t=>({...t,[e]:{...t[e],status:"starting",error:null}}));try{const t=await fetch(`${Ft()}/api/services/${e}/start`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();s.success||r(t=>({...t,[e]:{...t[e],status:"error",error:s.error||"Failed to start"}}))}catch(t){r(t=>({...t,[e]:{...t[e],status:"error",error:"Connection error"}}))}},[]),stopService:be.useCallback(async e=>{r(t=>({...t,[e]:{...t[e],status:"stopping",error:null}}));try{const t=await fetch(`${Ft()}/api/services/${e}/stop`,{method:"POST",credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const s=await t.json();s.success?r(t=>({...t,[e]:{...t[e],status:"stopped"}})):r(t=>({...t,[e]:{...t[e],status:"error",error:s.error||"Failed to stop"}}))}catch(t){r(t=>({...t,[e]:{...t[e],status:"error",error:"Connection error"}}))}},[]),refreshStatuses:n}}var Gt,Jt={};function Kt(){if(Gt)return Jt;Gt=1;var e=i();Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.default=void 0;var t=e(nt()),s=o();return Jt.default=(0,t.default)((0,s.jsx)("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"InfoOutlined"),Jt}const Qt=Ie(Kt());var Xt,Yt={};function Zt(){if(Xt)return Yt;Xt=1;var e=i();Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.default=void 0;var t=e(nt()),s=o();return Yt.default=(0,t.default)((0,s.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),Yt}const es=Ie(Zt());var ts,ss={};function rs(){if(ts)return ss;ts=1;var e=i();Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var t=e(nt()),s=o();return ss.default=(0,t.default)((0,s.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),ss}const as=Ie(rs());var ns,is={};function os(){if(ns)return is;ns=1;var e=i();Object.defineProperty(is,"__esModule",{value:!0}),is.default=void 0;var t=e(nt()),s=o();return is.default=(0,t.default)((0,s.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop"),is}const ls=Ie(os());var cs,ds={};function us(){if(cs)return ds;cs=1;var e=i();Object.defineProperty(ds,"__esModule",{value:!0}),ds.default=void 0;var t=e(nt()),s=o();return ds.default=(0,t.default)((0,s.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"OpenInNew"),ds}const xs=Ie(us()),hs=be.memo(function({config:e,state:t,onStart:r,onStop:a,onPause:n,onResume:i}){const o=(null==t?void 0:t.status)||"stopped",y="running"===o,w="paused"===o,S="starting"===o,C="stopping"===o,_="error"===o,k=!e.external&&!1!==(null==t?void 0:t.manageable);return s.jsxs(d,{className:e.cardClass,elevation:2,sx:{position:"relative",transition:"all 0.3s ease",opacity:"stopped"===o?.7:1,borderLeft:y?"3px solid":"none",borderColor:y?"success.main":"transparent","&:hover":{transform:"translateY(-5px)",boxShadow:6}},children:[s.jsxs(u,{children:[s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[s.jsx(h,{className:"card-icon",sx:{width:50,height:50,borderRadius:"12px",fontSize:"1.5rem"},children:e.icon}),s.jsxs(x,{sx:{flex:1},children:[s.jsx(m,{variant:"h6",component:"div",sx:{fontWeight:600,lineHeight:1.2},children:e.name}),s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[s.jsx(p,{size:"small",color:(()=>{switch(o){case"running":return"success";case"paused":case"starting":case"stopping":return"warning";case"error":return"error";default:return"default"}})(),label:(()=>{switch(o){case"running":return"Running";case"paused":return"Paused";case"starting":return"Starting";case"stopping":return"Stopping";case"error":return"Error";default:return"Stopped"}})(),sx:{height:20,fontSize:"0.7rem"}}),s.jsxs(m,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:["Port ",e.port]})]})]})]}),s.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2,lineHeight:1.6},children:e.description}),s.jsx(j,{in:y&&!!e.instructions,children:s.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:1,p:1.5,mb:2,borderRadius:1,bgcolor:"action.hover",border:"1px solid",borderColor:"primary.main"},children:[s.jsx(Qt,{sx:{color:"primary.main",fontSize:"1.1rem",mt:.2}}),s.jsx(m,{variant:"body2",sx:{color:"primary.light",fontSize:"0.85rem"},children:e.instructions})]})}),s.jsx(g,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,sx:{mb:1},children:e.tags.map(e=>s.jsx(p,{label:e,size:"small",variant:"outlined",sx:{fontSize:"0.75rem",height:24,borderColor:"divider",color:"text.secondary"}},e))})]}),s.jsxs(v,{sx:{px:2,pb:2,pt:0,justifyContent:"space-between"},children:[s.jsx(x,{sx:{display:"flex",gap:1},children:k&&s.jsxs(s.Fragment,{children:[!y&&!w&&!C&&s.jsx(f,{variant:"contained",color:"success",size:"small",startIcon:S?s.jsx(b,{size:16,color:"inherit"}):s.jsx(es,{}),onClick:()=>r(e.id),disabled:S,children:S?"Starting...":"Start"}),y&&n&&s.jsx(l,{title:"Pause service",children:s.jsx(c,{size:"small",onClick:()=>n(e.id),sx:{color:"warning.main"},"aria-label":"Pause service",children:s.jsx(as,{})})}),w&&i&&s.jsx(l,{title:"Resume service",children:s.jsx(c,{size:"small",onClick:()=>i(e.id),sx:{color:"success.main"},"aria-label":"Resume service",children:s.jsx(es,{})})}),(y||w||C)&&s.jsx(f,{variant:"contained",color:"error",size:"small",startIcon:C?s.jsx(b,{size:16,color:"inherit"}):s.jsx(ls,{}),onClick:()=>a(e.id),disabled:C,children:C?"Stopping...":"Stop"})]})}),s.jsx(l,{title:y?"Open in new tab":"Service not running",children:s.jsx("span",{children:s.jsx(c,{size:"small",onClick:()=>{y&&window.open(((e,t)=>{const s="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;return t&&!s?`${window.location.origin}/${t}/`:`http://${window.location.hostname}:${e}`})(e.port,e.proxyId),"_blank")},disabled:!y,"aria-label":"Open service in new tab",sx:{color:y?"primary.main":"action.disabled","&:hover":{bgcolor:"action.hover"}},children:s.jsx(xs,{})})})})]}),(S||C||_)&&s.jsxs(x,{"aria-hidden":"true",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"rgba(0, 0, 0, 0.85)",borderRadius:1,zIndex:10},children:[!_&&s.jsx(b,{size:40,sx:{mb:2}}),s.jsxs(m,{variant:"body2",color:"text.primary",children:[S&&"Starting service...",C&&"Stopping service...",_&&((null==t?void 0:t.error)||"Error")]})]})]})});var ms,ps={};function js(){if(ms)return ps;ms=1;var e=i();Object.defineProperty(ps,"__esModule",{value:!0}),ps.default=void 0;var t=e(nt()),s=o();return ps.default=(0,t.default)((0,s.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),ps}const gs=Ie(js());var vs,fs={};function bs(){if(vs)return fs;vs=1;var e=i();Object.defineProperty(fs,"__esModule",{value:!0}),fs.default=void 0;var t=e(nt()),s=o();return fs.default=(0,t.default)((0,s.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),fs}const ys=Ie(bs());function ws(e){return e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`}function Ss(e){return e>80?"error":e>50?"warning":"success"}const Cs=be.memo(function({onUnloadModel:e}){const[t,r]=be.useState(null),[a,n]=be.useState(null),[i,o]=be.useState(!0),[l,d]=be.useState(!1),u=be.useCallback(async()=>{try{const[e,t]=await Promise.all([fetch(`${Ft()}/api/resources/summary`),fetch(`${Ft()}/api/resources/settings`)]);if(!e.ok){const t=await e.text();throw new Error(`Failed to fetch summary (${e.status}): ${t}`)}if(!t.ok){const e=await t.text();throw new Error(`Failed to fetch settings (${t.status}): ${e}`)}const s=await e.json(),a=await t.json();r(s),n(a)}catch(e){}finally{o(!1)}},[]);be.useEffect(()=>{u();const e=setInterval(u,5e3);return()=>clearInterval(e)},[u]);if(i)return s.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",p:3},children:[s.jsx(b,{size:24,sx:{mr:2}}),s.jsx(m,{color:"text.secondary",children:"Loading resource info..."})]});const h=(null==t?void 0:t.gpu)??null,j=h&&h.total_mb>0?h.used_mb/h.total_mb*100:0;return s.jsxs(y,{expanded:l,onChange:(e,t)=>d(t),sx:{bgcolor:"background.paper",borderRadius:"12px !important",border:1,borderColor:"divider","&:before":{display:"none"},mb:3},children:[s.jsx(w,{expandIcon:s.jsx(gs,{}),sx:{"&:hover":{bgcolor:"action.hover"}},children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",pr:2},children:[s.jsx(p,{icon:s.jsx(zt,{}),label:"GPU",size:"small",sx:{background:"linear-gradient(135deg, var(--mui-palette-primary-main), var(--mui-palette-secondary-main))",color:"white",fontWeight:600,"& .MuiChip-icon":{color:"white"}}}),h&&s.jsx(x,{sx:{flexGrow:1,maxWidth:150},children:s.jsx(S,{variant:"determinate",value:j,color:Ss(j),sx:{height:8,borderRadius:4,bgcolor:"action.disabledBackground"}})}),s.jsx(m,{variant:"body2",sx:{fontFamily:"monospace",color:"text.secondary"},children:h?`${ws(h.used_mb)} / ${ws(h.total_mb)}`:"N/A"})]})}),s.jsxs(C,{sx:{pt:0},children:[h&&s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2,mb:2},children:[s.jsxs(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:["GPU: ",h.name]}),s.jsxs(x,{sx:{position:"relative",mb:1.5},children:[s.jsx(S,{variant:"determinate",value:j,color:Ss(j),sx:{height:24,borderRadius:1.5,bgcolor:"action.disabledBackground"}}),s.jsxs(m,{variant:"body2",sx:{position:"absolute",right:10,top:"50%",transform:"translateY(-50%)",fontWeight:600,color:"common.white",textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:[j.toFixed(1),"%"]})]}),s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between"},children:[s.jsxs(m,{variant:"caption",color:"text.secondary",children:["Used: ",ws(h.used_mb)]}),s.jsxs(m,{variant:"caption",color:"text.secondary",children:["Free: ",ws(h.free_mb)]}),s.jsxs(m,{variant:"caption",color:"text.secondary",children:["Util: ",h.utilization,"%"]})]})]}),(null==t?void 0:t.ollama_models)&&t.ollama_models.length>0&&s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2,mb:2},children:[s.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Loaded LLM Models"}),s.jsx(_,{dense:!0,disablePadding:!0,children:t.ollama_models.map(t=>s.jsx(k,{sx:{bgcolor:"action.selected",borderRadius:1.5,mb:1,"&:last-child":{mb:0}},secondaryAction:s.jsx(c,{edge:"end",size:"small",onClick:()=>(async t=>{try{const s=await fetch(`${Ft()}/api/models/ollama/unload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model_name:t})});if(!s.ok)throw await s.text(),new Error(`Failed to unload model: ${s.status} ${s.statusText}`);u(),null==e||e(t)}catch(s){}})(t.name),sx:{bgcolor:"error.dark",color:"error.light","&:hover":{bgcolor:"error.main"}},children:s.jsx(ys,{fontSize:"small"})}),children:s.jsx(z,{primary:t.name,secondary:t.size,primaryTypographyProps:{fontFamily:"monospace",fontSize:"0.9rem"},secondaryTypographyProps:{fontSize:"0.8rem"}})},t.name))})]}),(null==t?void 0:t.gpu_processes)&&t.gpu_processes.length>0&&s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2,mb:2},children:[s.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"GPU Processes"}),s.jsx(_,{dense:!0,disablePadding:!0,children:t.gpu_processes.map(e=>s.jsx(k,{sx:{bgcolor:"action.selected",borderRadius:1.5,mb:1,"&:last-child":{mb:0}},children:s.jsx(z,{primary:e.name.split("\\").pop(),secondary:e.memory,primaryTypographyProps:{fontFamily:"monospace",fontSize:"0.9rem"},secondaryTypographyProps:{fontSize:"0.8rem"}})},e.pid))})]}),(null==t?void 0:t.services)&&t.services.running_services.length>0&&s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2,mb:2},children:[s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[s.jsxs(m,{variant:"subtitle2",color:"text.secondary",children:["Running Services (",t.services.total_running,")"]}),t.services.gpu_intensive_running>0&&s.jsx(p,{label:`${t.services.gpu_intensive_running} GPU`,size:"small",color:"secondary",sx:{height:20,fontSize:"0.7rem"}})]}),s.jsx(_,{dense:!0,disablePadding:!0,children:t.services.running_services.map(e=>{return s.jsx(k,{sx:{bgcolor:"action.selected",borderRadius:1.5,mb:1,borderLeft:e.gpu_intensive?3:0,borderColor:e.gpu_intensive?"secondary.main":"transparent","&:last-child":{mb:0}},children:s.jsx(z,{primary:e.name,secondary:"Idle: "+(t=e.idle_seconds,null==t?"N/A":t<60?`${Math.round(t)}s`:t<3600?`${Math.round(t/60)}m`:`${Math.round(t/3600)}h ${Math.round(t%3600/60)}m`),primaryTypographyProps:{fontFamily:"monospace",fontSize:"0.9rem"},secondaryTypographyProps:{fontSize:"0.8rem"}})},e.id);var t})})]}),a&&s.jsxs(s.Fragment,{children:[s.jsx(M,{sx:{my:2}}),s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2},children:[s.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Auto-Stop Idle Services"}),s.jsx(I,{control:s.jsx(P,{checked:a.auto_stop_enabled,onChange:async()=>{if(a)try{const e=await fetch(`${Ft()}/api/resources/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auto_stop_enabled:!a.auto_stop_enabled})}),t=await e.json();n(t)}catch(e){}},sx:{color:"primary.main"}}),label:"Enable auto-stop for GPU services",sx:{mb:2,"& .MuiFormControlLabel-label":{color:"text.secondary"}}}),s.jsxs($,{size:"small",sx:{minWidth:150},disabled:!a.auto_stop_enabled,children:[s.jsx(O,{children:"Timeout"}),s.jsxs(T,{value:a.idle_timeout_minutes,label:"Timeout",onChange:e=>(async e=>{try{const t=await fetch(`${Ft()}/api/resources/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idle_timeout_minutes:e})}),s=await t.json();n(s)}catch(t){}})(Number(e.target.value)),children:[s.jsx(F,{value:5,children:"5 minutes"}),s.jsx(F,{value:15,children:"15 minutes"}),s.jsx(F,{value:30,children:"30 minutes"}),s.jsx(F,{value:60,children:"1 hour"}),s.jsx(F,{value:120,children:"2 hours"})]})]})]})]})]})]})});var _s,ks={};function zs(){if(_s)return ks;_s=1;var e=i();Object.defineProperty(ks,"__esModule",{value:!0}),ks.default=void 0;var t=e(nt()),s=o();return ks.default=(0,t.default)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),ks}const Ms=Ie(zs());var Is,Ps={};function $s(){if(Is)return Ps;Is=1;var e=i();Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.default=void 0;var t=e(nt()),s=o();return Ps.default=(0,t.default)((0,s.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),Ps}const Os=Ie($s());var Ts,Fs={};function Rs(){if(Ts)return Fs;Ts=1;var e=i();Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.default=void 0;var t=e(nt()),s=o();return Fs.default=(0,t.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Fs}const Ds=Ie(Rs());var Ws,Ls={};function As(){if(Ws)return Ls;Ws=1;var e=i();Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.default=void 0;var t=e(nt()),s=o();return Ls.default=(0,t.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Ls}const Ns=Ie(As());const Es=[{value:"all",label:"All AI Services"},{value:"core",label:"Core Project"},{value:"alltalk",label:"AllTalk TTS"},{value:"audiocraft",label:"AudioCraft"},{value:"comfyui",label:"ComfyUI"},{value:"diffrhythm",label:"DiffRhythm"},{value:"musicgpt",label:"MusicGPT"},{value:"stable_audio",label:"Stable Audio"},{value:"wan2gp",label:"Wan2GP"},{value:"yue",label:"YuE"}],Hs=[{value:"",label:"All sections"},{value:"css",label:"CSS only"},{value:"html",label:"HTML only"},{value:"webapi",label:"Web APIs only"}],Bs=[{key:"documentation",label:"Docs"},{key:"code",label:"Code"},{key:"drupal",label:"Drupal"},{key:"mdn_javascript",label:"MDN JS"},{key:"mdn_webapis",label:"MDN Web"}],Vs=[{value:"documentation",label:"Documentation"},{value:"code_entity",label:"Code Entities"},{value:"drupal_api",label:"Drupal API"},{value:"mdn_javascript",label:"MDN JavaScript"},{value:"mdn_webapis",label:"MDN Web APIs"}],Us=be.memo(function(){var e,t,r,a,n,i,o,l,c,d;const{status:u,progress:h,lastResult:j,error:g,loading:v,startIngestion:_,cancelIngestion:k,pauseIngestion:z,resumeIngestion:B,cleanCollections:V,reindexCollections:U}=function(){const[e,t]=be.useState(null),[s,r]=be.useState(null),[a,n]=be.useState(null),[i,o]=be.useState(null),[l,c]=be.useState(!0),d=be.useRef(null),u=be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/ingestion/status`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=await e.json();t(s),o(null)}catch(e){o("Failed to fetch ingestion status")}finally{c(!1)}},[]);return be.useEffect(()=>{const e=new AbortController;return fetch(`${Ft()}/api/auth/token`,{credentials:"include",signal:e.signal}).then(t=>{if(!e.signal.aborted){if(!t.ok)throw new Error("Authentication required");return t.json()}}).then(s=>{if(e.signal.aborted||!s)return;const a=$e(Ft(),{transports:["websocket","polling"],auth:{token:s.token}});d.current=a,a.on("connect_error",e=>{o("Failed to establish real-time connection. Please check your network and authentication."),c(!1)}),a.on("disconnect",e=>{"io server disconnect"===e||"io client disconnect"===e||o("Real-time connection lost. Updates may be delayed. Attempting to reconnect...")}),a.on("connect",()=>{o(e=>e&&e.includes("real-time connection")?null:e)}),a.on("ingestion_started",e=>{r(null),n(null),o(null),u()}),a.on("ingestion_progress",e=>{r(e)}),a.on("ingestion_phase_complete",e=>{}),a.on("ingestion_complete",e=>{n(e),r(null),u()}),a.on("ingestion_cancelled",e=>{r(null),u()}),a.on("ingestion_error",e=>{o(e.error),r(null),u()}),a.on("ingestion_paused",e=>{t(e=>e?{...e,paused:!0}:e)}),a.on("ingestion_resumed",e=>{t(e=>e?{...e,paused:!1}:e)}),u()}).catch(e=>{"AbortError"!==e.name&&(o("Authentication failed. Please log in again to enable real-time updates."),c(!1),d.current&&(d.current.disconnect(),d.current=null))}),()=>{e.abort(),d.current&&d.current.disconnect()}},[u]),{status:e,progress:s,lastResult:a,error:i,loading:l,startIngestion:be.useCallback(async e=>{o(null),n(null);try{const t=await fetch(`${Ft()}/api/ingestion/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();return!(!t.ok||!s.success)||(o(s.error||s.message||"Failed to start ingestion"),!1)}catch(t){return o("Connection error"),!1}},[]),cancelIngestion:be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/ingestion/cancel`,{method:"POST"}),t=await e.json();return!(!e.ok||!t.success)||(o(t.error||t.message||"Failed to cancel ingestion"),!1)}catch(e){return o("Connection error"),!1}},[]),pauseIngestion:be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/ingestion/pause`,{method:"POST"}),t=await e.json();return!(!e.ok||!t.success)||(o(t.error||t.message||"Failed to pause ingestion"),!1)}catch(e){return o("Connection error"),!1}},[]),resumeIngestion:be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/ingestion/resume`,{method:"POST"}),t=await e.json();return!(!e.ok||!t.success)||(o(t.error||t.message||"Failed to resume ingestion"),!1)}catch(e){return o("Connection error"),!1}},[]),cleanCollections:be.useCallback(async e=>{var t;o(null);try{const s=await fetch(`${Ft()}/api/ingestion/clean`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await s.json();return s.ok&&r.success?(u(),!0):(o((null==(t=r.errors)?void 0:t.join(", "))||r.message||"Failed to clean collections"),!1)}catch(s){return o("Connection error"),!1}},[u]),reindexCollections:be.useCallback(async e=>{o(null),n(null);try{const t=await fetch(`${Ft()}/api/ingestion/reindex`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();return!(!t.ok||!s.success)||(o(s.error||s.message||"Failed to start reindex"),!1)}catch(t){return o("Connection error"),!1}},[]),refreshStatus:u}}(),[q,G]=be.useState(!1),[J,K]=be.useState(new Set(["documentation","code"])),[Q,X]=be.useState("all"),[Y,Z]=be.useState(!1),[ee,te]=be.useState(null),[se,re]=be.useState(100),[ae,ne]=be.useState(""),[ie,oe]=be.useState(!1),[le,ce]=be.useState(!1),[de,ue]=be.useState(new Set),[xe,he]=be.useState(!1),me=be.useCallback(e=>{K(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),pe=be.useCallback(e=>{ue(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),je=be.useCallback(async()=>{if(0===J.size)return;const e=J.has("mdn_javascript")||J.has("mdn_webapis"),t={types:Array.from(J),reindex:Y,code_service:Q,drupal_limit:J.has("drupal")?ee:void 0,mdn_limit:e?se:void 0,mdn_section:J.has("mdn_webapis")&&ae?ae:void 0};await _(t)},[J,Y,Q,ee,se,ae,_]),ge=be.useCallback(async()=>{if(0===de.size)return;he(!0);const e={collections:Array.from(de)},t=await V(e);he(!1),t&&(oe(!1),ue(new Set))},[de,V]),ve=be.useCallback(async()=>{if(0===J.size)return;const e=J.has("mdn_javascript")||J.has("mdn_webapis"),t={types:Array.from(J),reindex:!0,code_service:Q,drupal_limit:J.has("drupal")?ee:void 0,mdn_limit:e?se:void 0,mdn_section:J.has("mdn_webapis")&&ae?ae:void 0};await U(t),ce(!1)},[J,Q,ee,se,ae,U]);if(v)return s.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",p:3},children:[s.jsx(b,{size:24,sx:{mr:2}}),s.jsx(m,{color:"text.secondary",children:"Loading settings..."})]});const fe=(null==u?void 0:u.is_running)??!1,ye=(null==u?void 0:u.paused)??!1,we=(null==(t=null==(e=null==u?void 0:u.collections)?void 0:e.documentation)?void 0:t.object_count)??0,Se=(null==(a=null==(r=null==u?void 0:u.collections)?void 0:r.code_entity)?void 0:a.object_count)??0,Ce=(null==(i=null==(n=null==u?void 0:u.collections)?void 0:n.drupal_api)?void 0:i.object_count)??0,_e=(null==(l=null==(o=null==u?void 0:u.collections)?void 0:o.mdn_javascript)?void 0:l.object_count)??0,ke=(null==(d=null==(c=null==u?void 0:u.collections)?void 0:c.mdn_webapis)?void 0:d.object_count)??0;let ze=0;h&&h.total>0&&(ze=h.current/h.total*100);const Me=()=>h?Bs.findIndex(e=>e.key===h.type):-1;return s.jsxs(s.Fragment,{children:[s.jsxs(y,{expanded:q,onChange:(e,t)=>G(t),sx:{bgcolor:"background.paper",borderRadius:"12px !important",border:1,borderColor:"divider","&:before":{display:"none"},mb:3},children:[s.jsx(w,{expandIcon:s.jsx(gs,{}),children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(p,{icon:s.jsx(St,{}),label:"Settings",size:"small",sx:{background:"linear-gradient(135deg, var(--mui-palette-primary-main), var(--mui-palette-secondary-main))",color:"white",fontWeight:600,"& .MuiChip-icon":{color:"white"}}}),fe?ye?s.jsx(p,{icon:s.jsx(as,{}),label:"Paused",color:"warning",size:"small"}):s.jsx(p,{icon:s.jsx(b,{size:12}),label:"Running",color:"primary",size:"small"}):g?s.jsx(p,{icon:s.jsx(Ns,{}),label:"Failed",color:"error",size:"small"}):j?j.success?s.jsx(p,{icon:s.jsx(Ds,{}),label:"Completed",color:"success",size:"small"}):s.jsx(p,{icon:s.jsx(Ns,{}),label:"Failed",color:"error",size:"small"}):null]})}),s.jsxs(C,{children:[s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2,mb:3},children:[s.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Weaviate Collections"}),s.jsxs(x,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:1},children:[s.jsxs(m,{variant:"body2",children:["Documentation: ",s.jsx("strong",{children:we.toLocaleString()})]}),s.jsxs(m,{variant:"body2",children:["Code: ",s.jsx("strong",{children:Se.toLocaleString()})]}),s.jsxs(m,{variant:"body2",children:["Drupal: ",s.jsx("strong",{children:Ce.toLocaleString()})]}),s.jsxs(m,{variant:"body2",children:["MDN JS: ",s.jsx("strong",{children:_e.toLocaleString()})]}),s.jsxs(m,{variant:"body2",children:["MDN Web: ",s.jsx("strong",{children:ke.toLocaleString()})]})]})]}),s.jsx(M,{sx:{my:2}}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Select Data Sources"}),s.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:1,mb:2},children:["documentation","code","drupal","mdn_javascript","mdn_webapis"].map(e=>s.jsx(I,{control:s.jsx(P,{checked:J.has(e),onChange:()=>me(e),disabled:fe,size:"small"}),label:"documentation"===e?"Documentation (Markdown)":"code"===e?"Code Entities":"drupal"===e?"Drupal API (Web Scrape)":"mdn_javascript"===e?"MDN JavaScript":"MDN Web APIs (CSS/HTML/WebAPI)",sx:{"& .MuiFormControlLabel-label":{fontSize:"0.875rem"}}},e))}),J.has("code")&&s.jsxs($,{size:"small",sx:{minWidth:200,mb:2},disabled:fe,children:[s.jsx(O,{children:"Code scope"}),s.jsx(T,{value:Q,label:"Code scope",onChange:e=>X(e.target.value),children:Es.map(({value:e,label:t})=>s.jsx(F,{value:e,children:t},e))})]}),J.has("drupal")&&s.jsxs($,{size:"small",sx:{minWidth:200,mb:2},disabled:fe,children:[s.jsx(O,{children:"Drupal limit"}),s.jsxs(T,{value:ee??"unlimited",label:"Drupal limit",onChange:e=>te("unlimited"===e.target.value?null:parseInt(e.target.value)),children:[s.jsx(F,{value:"unlimited",children:"Unlimited"}),s.jsx(F,{value:"100",children:"100 entities"}),s.jsx(F,{value:"500",children:"500 entities"}),s.jsx(F,{value:"1000",children:"1,000 entities"})]})]}),(J.has("mdn_javascript")||J.has("mdn_webapis"))&&s.jsxs($,{size:"small",sx:{minWidth:200,mb:2},disabled:fe,children:[s.jsx(O,{children:"MDN limit"}),s.jsxs(T,{value:se??"unlimited",label:"MDN limit",onChange:e=>re("unlimited"===e.target.value?null:parseInt(e.target.value)),children:[s.jsx(F,{value:"50",children:"50 docs"}),s.jsx(F,{value:"100",children:"100 docs"}),s.jsx(F,{value:"250",children:"250 docs"}),s.jsx(F,{value:"unlimited",children:"Unlimited"})]})]}),J.has("mdn_webapis")&&s.jsxs($,{size:"small",sx:{minWidth:200,mb:2,ml:2},disabled:fe,children:[s.jsx(O,{children:"Section"}),s.jsx(T,{value:ae,label:"Section",onChange:e=>ne(e.target.value),children:Hs.map(({value:e,label:t})=>s.jsx(F,{value:e,children:t},e))})]}),s.jsx(I,{control:s.jsx(P,{checked:Y,onChange:e=>Z(e.target.checked),disabled:fe,size:"small",color:"warning"}),label:"Delete existing data before indexing",sx:{mb:2,"& .MuiFormControlLabel-label":{fontSize:"0.875rem",color:"warning.main"}}}),s.jsx(x,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:fe?s.jsxs(s.Fragment,{children:[ye?s.jsx(f,{variant:"contained",color:"success",startIcon:s.jsx(es,{}),onClick:B,children:"Resume"}):s.jsx(f,{variant:"contained",color:"warning",startIcon:s.jsx(as,{}),onClick:z,children:"Pause"}),s.jsx(f,{variant:"contained",color:"error",startIcon:s.jsx(ls,{}),onClick:k,children:"Cancel"})]}):s.jsxs(s.Fragment,{children:[s.jsx(f,{variant:"contained",color:"success",startIcon:s.jsx(es,{}),onClick:je,disabled:0===J.size,children:"Start"}),s.jsx(f,{variant:"outlined",startIcon:s.jsx(Ms,{}),onClick:()=>oe(!0),children:"Clean"}),s.jsx(f,{variant:"outlined",startIcon:s.jsx(Os,{}),onClick:()=>ce(!0),disabled:0===J.size,children:"Reindex"})]})}),fe&&s.jsxs(x,{sx:{bgcolor:"action.hover",borderRadius:2,p:2,mb:2},children:[s.jsx(R,{activeStep:Me(),alternativeLabel:!0,children:Bs.map((e,t)=>s.jsx(D,{completed:t<Me(),children:s.jsx(W,{StepIconProps:{icon:t<Me()?s.jsx(Ds,{color:"success"}):t!==Me()||ye?t===Me()&&ye?s.jsx(as,{color:"warning"}):void 0:s.jsx(b,{size:20})},children:e.label})},e.key))}),h&&s.jsxs(x,{sx:{mt:2},children:[s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsxs(m,{variant:"body2",color:"text.secondary",children:[h.phase,": ",h.message]}),s.jsxs(m,{variant:"body2",color:"text.secondary",children:[h.current," / ",h.total]})]}),s.jsx(S,{variant:"determinate",value:ze,color:ye?"warning":"primary",sx:{height:8,borderRadius:4}})]})]}),g&&s.jsx(L,{severity:"error",icon:s.jsx(Ns,{}),sx:{mb:2},children:g}),j&&!fe&&s.jsxs(L,{severity:j.success?"success":"error",icon:j.success?s.jsx(Ds,{}):s.jsx(Ns,{}),children:[s.jsx(m,{variant:"subtitle2",children:j.success?"Indexing Complete":"Indexing Failed"}),s.jsxs(m,{variant:"body2",children:["Duration: ",j.duration_seconds.toFixed(1),"s",j.stats.documentation&&` | Docs: ${j.stats.documentation.chunks} chunks`,j.stats.code&&` | Code: ${j.stats.code.entities} entities`,j.stats.drupal&&` | Drupal: ${j.stats.drupal.entities_inserted} entities`,j.stats.mdn_javascript&&` | MDN JS: ${j.stats.mdn_javascript.entities_inserted} entities`,j.stats.mdn_webapis&&` | MDN Web APIs: ${j.stats.mdn_webapis.entities_inserted} entities`]})]})]})]}),s.jsxs(A,{open:ie,onClose:()=>oe(!1),children:[s.jsx(N,{children:"Clean Collections"}),s.jsxs(E,{children:[s.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select collections to delete. This action cannot be undone."}),Vs.map(({value:e,label:t})=>s.jsx(I,{control:s.jsx(P,{checked:de.has(e),onChange:()=>pe(e)}),label:t,sx:{display:"block"}},e))]}),s.jsxs(H,{children:[s.jsx(f,{onClick:()=>oe(!1),children:"Cancel"}),s.jsx(f,{onClick:ge,color:"error",variant:"contained",disabled:0===de.size||xe,startIcon:xe?s.jsx(b,{size:16}):s.jsx(Ms,{}),children:"Delete"})]})]}),s.jsxs(A,{open:le,onClose:()=>ce(!1),children:[s.jsx(N,{children:"Force Reindex"}),s.jsxs(E,{children:[s.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["This will delete existing data and re-index the selected sources. Selected types: ",Array.from(J).join(", ")]}),s.jsx(L,{severity:"warning",sx:{mt:1},children:"All existing data in the selected collections will be deleted."})]}),s.jsxs(H,{children:[s.jsx(f,{onClick:()=>ce(!1),children:"Cancel"}),s.jsx(f,{onClick:ve,color:"warning",variant:"contained",startIcon:s.jsx(Os,{}),children:"Start Reindex"})]})]})]})}),qs=be.memo(function(){const{services:e,startService:t,stopService:r}=qt(),a=Tt.filter(e=>"main"===e.section),n=Tt.filter(e=>"image"===e.section),i=Tt.filter(e=>"music"===e.section),o=be.useCallback(async e=>{try{(await fetch(`${Ft()}/api/services/${e}/pause`,{method:"POST"})).ok}catch(t){}},[]),l=be.useCallback(async e=>{try{(await fetch(`${Ft()}/api/services/${e}/resume`,{method:"POST"})).ok}catch(t){}},[]);return s.jsxs(B,{maxWidth:"lg",sx:{py:4},children:[s.jsx(Cs,{}),s.jsx(x,{id:"settings",children:s.jsx(Us,{})}),s.jsxs(x,{id:"main",sx:{mb:4,scrollMarginTop:"80px"},children:[s.jsx(m,{variant:"h5",color:"text.secondary",sx:{mb:3},children:"Main Services"}),s.jsx(V,{container:!0,spacing:3,children:a.map(a=>s.jsx(V,{item:!0,xs:12,sm:6,lg:4,children:s.jsx(hs,{config:a,state:e[a.id],onStart:t,onStop:r,onPause:o,onResume:l})},a.id))})]}),s.jsxs(x,{id:"image",sx:{mb:4,scrollMarginTop:"80px"},children:[s.jsx(m,{variant:"h5",color:"text.secondary",sx:{mb:3},children:"Image Generation"}),s.jsx(V,{container:!0,spacing:3,children:n.map(a=>s.jsx(V,{item:!0,xs:12,sm:6,lg:4,children:s.jsx(hs,{config:a,state:e[a.id],onStart:t,onStop:r,onPause:o,onResume:l})},a.id))})]}),s.jsxs(x,{id:"music",sx:{mb:4,scrollMarginTop:"80px"},children:[s.jsx(m,{variant:"h5",color:"text.secondary",sx:{mb:3},children:"Music Generation"}),s.jsx(V,{container:!0,spacing:3,children:i.map(a=>s.jsx(V,{item:!0,xs:12,sm:6,lg:4,children:s.jsx(hs,{config:a,state:e[a.id],onStart:t,onStop:r,onPause:o,onResume:l})},a.id))})]}),s.jsx(x,{sx:{textAlign:"center",mt:6},children:s.jsx(m,{variant:"body2",color:"text.secondary",children:"RTX 3090 (24GB) - Ryzen 9 5900X - 64GB RAM"})})]})});var Gs,Js={};function Ks(){if(Gs)return Js;Gs=1;var e=i();Object.defineProperty(Js,"__esModule",{value:!0}),Js.default=void 0;var t=e(nt()),s=o();return Js.default=(0,t.default)((0,s.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Js}const Qs=Ie(Ks());var Xs,Ys={};function Zs(){if(Xs)return Ys;Xs=1;var e=i();Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.default=void 0;var t=e(nt()),s=o();return Ys.default=(0,t.default)((0,s.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),Ys}const er=Ie(Zs());var tr,sr={};function rr(){if(tr)return sr;tr=1;var e=i();Object.defineProperty(sr,"__esModule",{value:!0}),sr.default=void 0;var t=e(nt()),s=o();return sr.default=(0,t.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),sr}const ar=Ie(rr());var nr,ir={};function or(){if(nr)return ir;nr=1;var e=i();Object.defineProperty(ir,"__esModule",{value:!0}),ir.default=void 0;var t=e(nt()),s=o();return ir.default=(0,t.default)((0,s.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),ir}const lr=Ie(or());var cr,dr={};function ur(){if(cr)return dr;cr=1;var e=i();Object.defineProperty(dr,"__esModule",{value:!0}),dr.default=void 0;var t=e(nt()),s=o();return dr.default=(0,t.default)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),dr}const xr=Ie(ur());const hr=be.memo(function(){const{models:e,loadedModels:t,downloadingModels:r,loadingModels:a,gpuInfo:n,loading:i,error:o,totalCount:h,loadedCount:g,refresh:b,loadModel:y,unloadModel:w,downloadModel:C,removeModel:_}=function(e={}){const{pollingInterval:t=1e4,autoFetch:s=!0}=e,[r,a]=be.useState([]),[n,i]=be.useState({}),[o,l]=be.useState({}),[c,d]=be.useState(null),[u,x]=be.useState(!1),[h,m]=be.useState(null),p=be.useRef(!0),j=be.useCallback(()=>{const e=localStorage.getItem("auth_username")||"",t=localStorage.getItem("auth_password")||"";return{Authorization:`Basic ${btoa(`${e}:${t}`)}`,"Content-Type":"application/json"}},[]),g=be.useCallback(async()=>{if(p.current){x(!0),m(null);try{const e=await fetch(`${Ft()}/api/models/ollama/detailed`,{headers:j()});if(!e.ok)throw new Error(`Failed to fetch models: ${e.statusText}`);const t=await e.json();p.current&&a(t.models)}catch(e){p.current&&m(e instanceof Error?e.message:"Failed to fetch models")}finally{p.current&&x(!1)}}},[j]),v=be.useCallback(async()=>{if(p.current)try{const e=await fetch(`${Ft()}/api/vram/status`,{headers:j()});if(e.ok){const t=await e.json();p.current&&t.gpu&&d(t.gpu)}}catch(e){}},[j]),f=be.useCallback(async()=>{await Promise.all([g(),v()])},[g,v]),b=be.useCallback(async(e,t)=>{try{const s=await fetch(`${Ft()}/api/models/ollama/load`,{method:"POST",headers:j(),body:JSON.stringify({model_name:e,expected_vram_mb:t})}),r=await s.json();return r.success&&l(t=>({...t,[e]:{model_name:e,progress:0,status:"loading",action:"load"}})),r}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to load model",model_name:e}}},[j]),y=be.useCallback(async(e,t)=>{try{const s=await fetch(`${Ft()}/api/models/ollama/unload`,{method:"POST",headers:j(),body:JSON.stringify({model_name:e,expected_vram_mb:t})}),r=await s.json();return r.success&&l(t=>({...t,[e]:{model_name:e,progress:0,status:"unloading",action:"unload"}})),r}catch(s){return{success:!1,message:s instanceof Error?s.message:"Failed to unload model",model_name:e}}},[j]),w=be.useCallback(async e=>{try{const t=await fetch(`${Ft()}/api/models/ollama/download`,{method:"POST",headers:j(),body:JSON.stringify({model_name:e})}),s=await t.json();return s.success&&i(t=>({...t,[e]:{model_name:e,progress:"starting",status:"downloading"}})),s}catch(t){return{success:!1,message:t instanceof Error?t.message:"Failed to start download",model_name:e}}},[j]),S=be.useCallback(async e=>{try{const t=await fetch(`${Ft()}/api/models/ollama/remove`,{method:"POST",headers:j(),body:JSON.stringify({model_name:e,confirm:!0})}),s=await t.json();return s.success&&await f(),s}catch(t){return{success:!1,message:t instanceof Error?t.message:"Failed to remove model",model_name:e}}},[j,f]),C=be.useCallback(async e=>{try{const t=await fetch(`${Ft()}/api/models/ollama/info/${encodeURIComponent(e)}`,{headers:j()});return t.ok?await t.json():null}catch{return null}},[j]),_=be.useCallback(e=>{i(t=>{if("complete"===e.status||"error"===e.status){const{[e.model_name]:s,...r}=t;return"complete"===e.status&&setTimeout(()=>{p.current&&f()},1e3),r}return{...t,[e.model_name]:e}})},[f]),k=be.useCallback(e=>{l(t=>{if("complete"===e.status||"error"===e.status){const{[e.model_name]:s,...r}=t;return"complete"===e.status&&setTimeout(()=>{p.current&&f()},500),r}return{...t,[e.model_name]:e}})},[f]);be.useEffect(()=>(p.current=!0,s&&f(),()=>{p.current=!1}),[s,f]),be.useEffect(()=>{if(!s||t<=0)return;const e=setInterval(()=>{p.current&&f()},t);return()=>clearInterval(e)},[s,t,f]),be.useEffect(()=>(window.__updateModelDownloadProgress=_,()=>{delete window.__updateModelDownloadProgress}),[_]),be.useEffect(()=>(window.__updateModelLoadProgress=k,()=>{delete window.__updateModelLoadProgress}),[k]);const z=r.filter(e=>e.is_loaded),M=r.filter(e=>!e.is_loaded);return{models:r,loadedModels:z,availableModels:M,downloadingModels:n,loadingModels:o,gpuInfo:c,loading:u,error:h,totalCount:r.length,loadedCount:z.length,refresh:f,loadModel:b,unloadModel:y,downloadModel:w,removeModel:S,getModelInfo:C}}({pollingInterval:1e4}),[k,z]=be.useState(""),[M,I]=be.useState("all"),[P,R]=be.useState("name"),[D,W]=be.useState(new Set),[Y,Z]=be.useState(!1),[ee,te]=be.useState(""),[se,re]=be.useState(!1),[ae,ne]=be.useState(null),[ie,oe]=be.useState(!1),[le,ce]=be.useState(null),[de,ue]=be.useState(!1),[xe,he]=be.useState({}),[me,pe]=be.useState({open:!1,message:"",severity:"info"}),je=be.useMemo(()=>{let t=[...e];if(k){const e=k.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.family.toLowerCase().includes(e)||t.capability_description.toLowerCase().includes(e))}switch(M){case"loaded":t=t.filter(e=>e.is_loaded);break;case"available":t=t.filter(e=>!e.is_loaded);break;case"downloading":t=t.filter(e=>r[e.name])}return t.sort((e,t)=>{switch(P){case"size":return t.size_gb-e.size_gb;case"parameters":{const s=e=>{const t=e.match(/^(\d+(?:\.\d+)?)/);return t?parseFloat(t[1]):0};return s(t.parameters||"")-s(e.parameters||"")}case"vram":return t.estimated_vram_mb-e.estimated_vram_mb;default:return e.name.localeCompare(t.name)}}),t},[e,k,M,P,r]),ge=be.useMemo(()=>{if(!n)return null;const e=t.reduce((e,t)=>e+t.estimated_vram_mb,0),s=n.used_mb/n.total_mb*100;return{total:n.total_mb,used:n.used_mb,free:n.free_mb,loadedEstimate:e,percent:s,status:s<50?"success":s<80?"warning":"error"}},[n,t]),ve=async()=>{if(!ee.trim())return;const e=ee.trim();Z(!1);const t=await C(e);te(""),pe({open:!0,message:t.success?`Download started for "${e}"`:t.message,severity:t.success?"info":"error"})},fe=e=>{const t=a[e.name];return t?"load"===t.action?"info":"warning":r[e.name]?"warning":e.is_loaded?"success":"default"},ye=e=>{const t=a[e.name];if(t){return`${"load"===t.action?"Loading":"Unloading"} ${t.progress}%`}return r[e.name]?"Downloading":e.is_loaded?"Loaded":"Available"},we=e=>e>=1024?`${(e/1024).toFixed(1)} GB`:`${e} MB`;return s.jsxs(B,{maxWidth:"lg",sx:{py:4},children:[s.jsxs(x,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:2},children:[s.jsxs(x,{children:[s.jsxs(m,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(zt,{})," Ollama Models"]}),s.jsxs(m,{variant:"body2",color:"text.secondary",children:[h," models available, ",g," loaded"]})]}),s.jsxs(x,{sx:{display:"flex",gap:1},children:[s.jsx(l,{title:"Download new model",children:s.jsx(f,{variant:"outlined",startIcon:s.jsx(er,{}),onClick:()=>Z(!0),children:"Download"})}),s.jsx(l,{title:"Refresh models",children:s.jsx(c,{onClick:b,disabled:i,children:s.jsx(Os,{})})}),s.jsx(l,{title:"Help",children:s.jsx(c,{onClick:()=>ue(!0),children:s.jsx(xr,{})})})]})]}),ge&&s.jsx(d,{sx:{mb:3},children:s.jsxs(u,{children:[s.jsx(m,{variant:"h6",gutterBottom:!0,children:"GPU VRAM Usage"}),s.jsxs(x,{sx:{mb:2},children:[s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsxs(m,{variant:"body2",children:[we(ge.used)," / ",we(ge.total)]}),s.jsxs(m,{variant:"body2",color:`${ge.status}.main`,children:[ge.percent.toFixed(1),"%"]})]}),s.jsx(S,{variant:"determinate",value:ge.percent,color:ge.status,sx:{height:10,borderRadius:1}})]}),s.jsxs(m,{variant:"body2",color:"text.secondary",children:["Estimated loaded models VRAM: ~",we(ge.loadedEstimate)]})]})}),o&&s.jsx(L,{severity:"error",sx:{mb:3},children:o}),s.jsxs(x,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[s.jsx(U,{placeholder:"Search models...",size:"small",value:k,onChange:e=>z(e.target.value),sx:{minWidth:250},InputProps:{startAdornment:s.jsx(q,{position:"start",children:s.jsx(Qs,{})})}}),s.jsxs(G,{value:M,exclusive:!0,onChange:(e,t)=>t&&I(t),size:"small",children:[s.jsx(J,{value:"all",children:"All"}),s.jsx(J,{value:"loaded",children:"Loaded"}),s.jsx(J,{value:"available",children:"Available"})]}),s.jsxs($,{size:"small",sx:{minWidth:120},children:[s.jsx(O,{children:"Sort by"}),s.jsxs(T,{value:P,label:"Sort by",onChange:e=>R(e.target.value),children:[s.jsx(F,{value:"name",children:"Name"}),s.jsx(F,{value:"size",children:"Size"}),s.jsx(F,{value:"parameters",children:"Parameters"}),s.jsx(F,{value:"vram",children:"VRAM Est."})]})]})]}),i&&0===e.length?s.jsx(V,{container:!0,spacing:3,children:[1,2,3,4,5,6].map(e=>s.jsx(V,{item:!0,xs:12,sm:6,md:4,children:s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(K,{variant:"text",width:"60%",height:32}),s.jsx(K,{variant:"text",width:"40%"}),s.jsx(K,{variant:"rectangular",height:60,sx:{mt:2}})]})})},e))}):s.jsx(V,{container:!0,spacing:3,children:je.map(e=>s.jsx(V,{item:!0,xs:12,sm:6,md:4,children:s.jsxs(d,{sx:{height:"100%",display:"flex",flexDirection:"column",borderLeft:4,borderColor:a[e.name]?"load"===a[e.name].action?"info.main":"warning.main":e.is_loaded?"success.main":r[e.name]?"warning.main":"grey.300",opacity:xe[e.name]?.7:1,transition:"opacity 0.2s"},children:[s.jsxs(u,{sx:{flexGrow:1},children:[s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[s.jsx(m,{variant:"h6",component:"div",sx:{wordBreak:"break-word",pr:1},children:e.name}),s.jsx(p,{label:ye(e),size:"small",color:fe(e)})]}),s.jsx(p,{label:e.family,size:"small",variant:"outlined",sx:{mb:1}}),s.jsxs(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.parameters&&`${e.parameters} â€¢ `,e.quantization&&`${e.quantization} â€¢ `,e.size]}),e.estimated_vram_mb>0&&s.jsxs(x,{sx:{mt:1},children:[s.jsxs(m,{variant:"body2",color:"text.secondary",children:["Est. VRAM: ~",we(e.estimated_vram_mb)]}),s.jsx(S,{variant:"determinate",value:ge?Math.min(e.estimated_vram_mb/ge.total*100,100):0,sx:{height:4,borderRadius:1,mt:.5}})]}),r[e.name]&&s.jsxs(x,{sx:{mt:2},children:[s.jsx(m,{variant:"body2",color:"warning.main",children:r[e.name].progress}),s.jsx(S,{color:"warning",sx:{mt:.5}})]}),a[e.name]&&s.jsxs(x,{sx:{mt:2},children:[s.jsxs(m,{variant:"body2",color:"load"===a[e.name].action?"info.main":"warning.main",children:["load"===a[e.name].action?"Loading":"Unloading"," ","model..."]}),s.jsx(S,{variant:"determinate",value:a[e.name].progress,color:"load"===a[e.name].action?"info":"warning",sx:{mt:.5,height:6,borderRadius:1}}),s.jsxs(m,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[a[e.name].progress,"% complete"]})]}),s.jsxs(x,{sx:{mt:1},children:[s.jsx(f,{size:"small",onClick:()=>{return t=e.name,void W(e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s});var t},endIcon:D.has(e.name)?s.jsx(lr,{}):s.jsx(gs,{}),sx:{textTransform:"none",p:0},children:D.has(e.name)?"Less":"More"}),s.jsx(j,{in:D.has(e.name),children:s.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:1},children:e.capability_description||"No description available."})})]})]}),s.jsxs(v,{sx:{justifyContent:"flex-end",px:2,pb:2},children:[s.jsx(l,{title:"Model info",children:s.jsx(c,{size:"small",onClick:()=>(e=>{ce(e),oe(!0)})(e),children:s.jsx(ar,{fontSize:"small"})})}),e.is_loaded?s.jsx(l,{title:"Unload model",children:s.jsx(c,{size:"small",color:"warning",onClick:()=>(async(e,t)=>{const s=await w(e,t);s.success||pe({open:!0,message:s.message,severity:"error"})})(e.name,e.estimated_vram_mb),disabled:xe[e.name]||!!a[e.name],children:s.jsx(ls,{fontSize:"small"})})}):s.jsx(l,{title:"Load model",children:s.jsx(c,{size:"small",color:"success",onClick:()=>(async(e,t)=>{const s=await y(e,t);s.success||pe({open:!0,message:s.message,severity:"error"})})(e.name,e.estimated_vram_mb),disabled:xe[e.name]||!!r[e.name]||!!a[e.name],children:s.jsx(es,{fontSize:"small"})})}),s.jsx(l,{title:"Remove model",children:s.jsx(c,{size:"small",color:"error",onClick:()=>{ne(e.name),re(!0)},disabled:xe[e.name]||e.is_loaded||!!a[e.name],children:s.jsx(Ms,{fontSize:"small"})})})]})]})},e.name))}),!i&&0===je.length&&s.jsxs(x,{sx:{textAlign:"center",py:8},children:[s.jsx(zt,{sx:{fontSize:64,color:"text.secondary",mb:2}}),s.jsx(m,{variant:"h6",color:"text.secondary",children:k||"all"!==M?"No models match your filters":"No models found"}),s.jsx(f,{variant:"outlined",startIcon:s.jsx(er,{}),onClick:()=>Z(!0),sx:{mt:2},children:"Download a Model"})]}),s.jsxs(A,{open:Y,onClose:()=>Z(!1),children:[s.jsx(N,{children:"Download Model"}),s.jsxs(E,{children:[s.jsx(Q,{sx:{mb:2},children:"Enter the model name to download from Ollama. Examples: llama3.2, qwen2.5:32b, mistral:7b-instruct"}),s.jsx(U,{autoFocus:!0,fullWidth:!0,label:"Model name",placeholder:"e.g., llama3.2:latest",value:ee,onChange:e=>te(e.target.value),onKeyDown:e=>"Enter"===e.key&&ve()})]}),s.jsxs(H,{children:[s.jsx(f,{onClick:()=>Z(!1),children:"Cancel"}),s.jsx(f,{onClick:ve,variant:"contained",disabled:!ee.trim(),children:"Download"})]})]}),s.jsxs(A,{open:se,onClose:()=>re(!1),children:[s.jsx(N,{children:"Remove Model"}),s.jsx(E,{children:s.jsxs(Q,{children:['Are you sure you want to remove "',ae,'"? This will delete the model from disk and cannot be undone.']})}),s.jsxs(H,{children:[s.jsx(f,{onClick:()=>re(!1),children:"Cancel"}),s.jsx(f,{onClick:async()=>{if(!ae)return;const e=ae;re(!1),he(t=>({...t,[e]:!0}));const t=await _(e);he(t=>({...t,[e]:!1})),ne(null),pe({open:!0,message:t.success?`Model "${e}" removed successfully`:t.message,severity:t.success?"success":"error"})},color:"error",variant:"contained",children:"Remove"})]})]}),s.jsxs(A,{open:ie,onClose:()=>oe(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(N,{children:(null==le?void 0:le.name)??"Model Info"}),s.jsx(E,{children:le&&s.jsxs(x,{children:[s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Family"}),s.jsx(m,{gutterBottom:!0,children:le.family}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Parameters"}),s.jsx(m,{gutterBottom:!0,children:le.parameters||"N/A"}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Quantization"}),s.jsx(m,{gutterBottom:!0,children:le.quantization||"N/A"}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Size"}),s.jsxs(m,{gutterBottom:!0,children:[le.size," (",le.size_gb.toFixed(2)," GB)"]}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Format"}),s.jsx(m,{gutterBottom:!0,children:le.format||"N/A"}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Estimated VRAM"}),s.jsxs(m,{gutterBottom:!0,children:["~",we(le.estimated_vram_mb)]}),s.jsx(m,{variant:"subtitle2",color:"text.secondary",children:"Description"}),s.jsx(m,{children:le.capability_description||"No description available."})]})}),s.jsx(H,{children:s.jsx(f,{onClick:()=>oe(!1),children:"Close"})})]}),s.jsxs(A,{open:de,onClose:()=>ue(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(N,{children:"Model Management Help"}),s.jsxs(E,{children:[s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Loading/Unloading Models"}),s.jsx(m,{variant:"body2",paragraph:!0,children:"Loading a model puts it into GPU VRAM for fast inference. Unloading removes it from VRAM but keeps it on disk. Only loaded models can be used for generation."}),s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"VRAM Management"}),s.jsx(m,{variant:"body2",paragraph:!0,children:"Each model requires VRAM when loaded. Monitor the VRAM usage bar at the top. If you run out of VRAM, unload models you're not using."}),s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Model Names"}),s.jsx(m,{variant:"body2",paragraph:!0,children:'Models use the format "name:tag" (e.g., "llama3.2:latest"). Common tags include version numbers, sizes (7b, 13b, 70b), and variants (instruct, chat).'}),s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Quantization"}),s.jsx(m,{variant:"body2",paragraph:!0,children:"Quantization reduces model size and VRAM usage. Q4 is smallest/fastest, Q8 is larger/more accurate, FP16 is full precision. Most models use Q4_K_M for good balance."})]}),s.jsx(H,{children:s.jsx(f,{onClick:()=>ue(!1),children:"Close"})})]}),s.jsx(X,{open:me.open,autoHideDuration:5e3,onClose:()=>pe(e=>({...e,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:s.jsx(L,{severity:me.severity,onClose:()=>pe(e=>({...e,open:!1})),children:me.message})})]})});var mr,pr={};function jr(){if(mr)return pr;mr=1;var e=i();Object.defineProperty(pr,"__esModule",{value:!0}),pr.default=void 0;var t=e(nt()),s=o();return pr.default=(0,t.default)((0,s.jsx)("path",{d:"M4 10h3v7H4zm6.5 0h3v7h-3zM2 19h20v3H2zm15-9h3v7h-3zm-5-9L2 6v2h20V6z"}),"AccountBalance"),pr}const gr=Ie(jr());const vr=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY","DC"];function fr({members:e,onFilterChange:t,initialFilters:r}){const[a,n]=be.useState(r||{});be.useEffect(()=>{n(r||{})},[r]),be.useEffect(()=>{t(a)},[a,t]);const i=be.useMemo(()=>Array.from(new Set(e)).sort(),[e]);return s.jsxs(y,{children:[s.jsx(w,{expandIcon:s.jsx(gs,{}),children:s.jsx(m,{variant:"subtitle1",children:"Filters"})}),s.jsx(C,{children:s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[s.jsx(Y,{options:i,value:a.member_name||null,onChange:(e,t)=>n(e=>({...e,member_name:t||void 0})),renderInput:e=>s.jsx(U,{...e,label:"Member",placeholder:"Search member by name",size:"small"})}),s.jsxs(x,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[s.jsxs($,{sx:{minWidth:160},size:"small",children:[s.jsx(O,{id:"party-label",children:"Party"}),s.jsxs(T,{labelId:"party-label",label:"Party",value:a.party||"",onChange:e=>n(t=>({...t,party:e.target.value||void 0})),children:[s.jsx(F,{value:"",children:"All"}),s.jsx(F,{value:"Democrat",children:"Democrat"}),s.jsx(F,{value:"Republican",children:"Republican"}),s.jsx(F,{value:"Independent",children:"Independent"})]})]}),s.jsxs($,{sx:{minWidth:120},size:"small",children:[s.jsx(O,{id:"state-label",children:"State"}),s.jsxs(T,{labelId:"state-label",label:"State",value:a.state||"",onChange:e=>n(t=>({...t,state:e.target.value||void 0})),children:[s.jsx(F,{value:"",children:"All"}),vr.map(e=>s.jsx(F,{value:e,children:e},e))]})]}),s.jsxs($,{sx:{minWidth:160},size:"small",children:[s.jsx(O,{id:"topic-label",children:"Topic"}),s.jsxs(T,{labelId:"topic-label",label:"Topic",value:a.topic||"",onChange:e=>n(t=>({...t,topic:e.target.value||void 0})),children:[s.jsx(F,{value:"",children:"All"}),s.jsx(F,{value:"votes",children:"Roll Call Votes"}),s.jsx(F,{value:"news",children:"News"}),s.jsx(F,{value:"press",children:"Press Releases"}),s.jsx(F,{value:"issues",children:"Issues"}),s.jsx(F,{value:"services",children:"Services"})]})]})]}),s.jsxs(x,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[s.jsx(U,{label:"From",type:"date",size:"small",InputLabelProps:{shrink:!0},value:a.date_from||"",onChange:e=>n(t=>({...t,date_from:e.target.value||void 0}))}),s.jsx(U,{label:"To",type:"date",size:"small",InputLabelProps:{shrink:!0},value:a.date_to||"",onChange:e=>n(t=>({...t,date_to:e.target.value||void 0}))})]}),s.jsx(x,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:s.jsx(f,{variant:"outlined",size:"small",onClick:()=>{n({})},children:"Clear Filters"})})]})})]})}var br,yr={};function wr(){if(br)return yr;br=1;var e=i();Object.defineProperty(yr,"__esModule",{value:!0}),yr.default=void 0;var t=e(nt()),s=o();return yr.default=(0,t.default)((0,s.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),yr}const Sr=Ie(wr());function Cr(e){return e.toLowerCase().startsWith("dem")?"primary":e.toLowerCase().startsWith("rep")?"secondary":"default"}function _r({result:e,onMemberClick:t}){const r=e.content_text.length>200?`${e.content_text.slice(0,200)}â€¦`:e.content_text;return s.jsxs(d,{variant:"outlined",sx:{borderLeft:4,borderLeftColor:"primary"===Cr(e.party)?"primary.main":"secondary"===Cr(e.party)?"secondary.main":"divider","&:hover":{boxShadow:3}},children:[s.jsxs(u,{children:[s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,flexWrap:"wrap",gap:1},children:[s.jsx(p,{label:e.member_name,size:"small",onClick:t?()=>t(e.member_name):void 0,sx:{cursor:t?"pointer":"default"}}),s.jsxs(x,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s.jsx(p,{label:e.party||"Unknown",size:"small",color:Cr(e.party)}),s.jsx(p,{label:`${e.state}${e.district?`-${e.district}`:""}`,size:"small",variant:"outlined"}),s.jsx(p,{label:e.chamber,size:"small",variant:"outlined"})]})]}),s.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:e.title||"Untitled"}),s.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:1.5,whiteSpace:"pre-line"},children:r}),s.jsxs(m,{variant:"caption",color:"text.secondary",children:["Scraped at: ",e.scraped_at]})]}),s.jsxs(v,{sx:{justifyContent:"space-between"},children:[s.jsx(f,{size:"small",href:e.url,target:"_blank",rel:"noopener noreferrer",startIcon:s.jsx(xs,{}),children:"Open"}),s.jsx(l,{title:"Copy URL",children:s.jsx(f,{size:"small",onClick:()=>{navigator.clipboard&&navigator.clipboard.writeText(e.url).catch(()=>{})},startIcon:s.jsx(Sr,{}),children:"Copy URL"})})]})]})}const kr={Democrat:"#1976d2",Republican:"#d32f2f",Independent:"#616161"};function zr({stats:e,queryResults:t}){const r=Object.entries(e.member_counts||{}).map(([t,s])=>{var r,a;return{name:t,count:s,party:(null==(a=null==(r=e.member_meta)?void 0:r[t])?void 0:a.party)||"Unknown"}}).sort((e,t)=>t.count-e.count).slice(0,10),a=Object.entries(e.party_counts||{}).map(([e,t])=>({name:e,value:t})),n=Object.entries(e.chamber_counts||{}).map(([e,t])=>({name:e,value:t})),i=t&&t.length?Object.values(t.reduce((e,t)=>{const s=t.scraped_at.split("T")[0];return e[s]||(e[s]={date:s,count:0}),e[s].count+=1,e},{})).sort((e,t)=>e.date<t.date?-1:1):[];return s.jsxs(V,{container:!0,spacing:3,children:[s.jsx(V,{item:!0,xs:12,md:6,children:s.jsxs(d,{children:[s.jsx(Z,{title:"Member Activity (Top 10)"}),s.jsx(u,{sx:{height:300},children:0===r.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No member activity data available."}):s.jsx(Oe,{width:"100%",height:"100%",children:s.jsxs(Te,{data:r,children:[s.jsx(Fe,{dataKey:"name",hide:!0}),s.jsx(Re,{}),s.jsx(De,{}),s.jsx(We,{dataKey:"count",children:r.map((e,t)=>s.jsx(Le,{fill:kr[e.party]||"#9e9e9e"},t))})]})})})]})}),s.jsx(V,{item:!0,xs:12,md:6,children:s.jsxs(d,{children:[s.jsx(Z,{title:"Party Distribution"}),s.jsx(u,{sx:{height:300},children:0===a.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No party distribution data available."}):s.jsx(Oe,{width:"100%",height:"100%",children:s.jsxs(Ae,{children:[s.jsx(Ne,{data:a,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:a.map((e,t)=>s.jsx(Le,{fill:kr[e.name]||["#1976d2","#d32f2f","#616161","#9e9e9e"][t%4]},t))}),s.jsx(Ee,{}),s.jsx(De,{})]})})})]})}),s.jsx(V,{item:!0,xs:12,md:6,children:s.jsxs(d,{children:[s.jsx(Z,{title:"Chamber Breakdown"}),s.jsx(u,{sx:{height:300},children:0===n.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No chamber breakdown data available."}):s.jsx(Oe,{width:"100%",height:"100%",children:s.jsxs(Te,{data:n,layout:"vertical",children:[s.jsx(Fe,{type:"number"}),s.jsx(Re,{type:"category",dataKey:"name"}),s.jsx(De,{}),s.jsx(We,{dataKey:"value",fill:"#9c27b0"})]})})})]})}),s.jsx(V,{item:!0,xs:12,md:6,children:s.jsxs(d,{children:[s.jsx(Z,{title:"Timeline (Query Results)"}),s.jsx(u,{sx:{height:300},children:0===i.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No timeline data available for current query."}):s.jsx(Oe,{width:"100%",height:"100%",children:s.jsxs(He,{data:i,children:[s.jsx(Fe,{dataKey:"date"}),s.jsx(Re,{}),s.jsx(De,{}),s.jsx(Be,{type:"monotone",dataKey:"count",stroke:"#0288d1"})]})})})]})})]})}function Mr({open:e,onClose:t,onStart:r}){const[a,n]=be.useState(""),[i,o]=be.useState("5"),[l,c]=be.useState(!1),[d,u]=be.useState(null);be.useEffect(()=>{e||(n(""),o("5"),c(!1),u(null))},[e]);return s.jsxs(A,{open:e,onClose:t,maxWidth:"sm",fullWidth:!0,children:[s.jsx(N,{children:"Start Congressional Scraping"}),s.jsxs(E,{sx:{pt:1},children:[s.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Configure how many members and pages to scrape. Use dry run to preview without writing to the database."}),s.jsx(U,{label:"Max members",type:"number",fullWidth:!0,margin:"normal",value:a,onChange:e=>n(e.target.value),helperText:"Optional. Limit the number of members to scrape."}),s.jsx(U,{label:"Max pages per member",type:"number",fullWidth:!0,margin:"normal",value:i,onChange:e=>o(e.target.value),helperText:"Number of pages to scrape per member (default 5)."}),s.jsx(I,{control:s.jsx(P,{checked:l,onChange:e=>c(e.target.checked)}),label:"Dry run (do not persist data)"}),d&&s.jsx(m,{variant:"body2",color:"error",sx:{mt:1},children:d})]}),s.jsxs(H,{children:[s.jsx(f,{onClick:t,children:"Cancel"}),s.jsx(f,{onClick:async()=>{if(!(a&&Number.isNaN(Number(a))?(u("Max members must be a number"),0):i&&(Number.isNaN(Number(i))||Number(i)<=0)?(u("Max pages per member must be a positive number"),0):(u(null),1)))return;const e={};a&&(e.max_members=Number(a)),i&&(e.max_pages_per_member=Number(i)),e.dry_run=l;await r(e)?t():u("Failed to start scraping. Please try again.")},variant:"contained",children:"Start Scraping"})]})]})}var Ir,Pr={};function $r(){if(Ir)return Pr;Ir=1;var e=i();Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.default=void 0;var t=e(nt()),s=o();return Pr.default=(0,t.default)((0,s.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),Pr}const Or=Ie($r());var Tr,Fr={};function Rr(){if(Tr)return Fr;Tr=1;var e=i();Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.default=void 0;var t=e(nt()),s=o();return Fr.default=(0,t.default)((0,s.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),Fr}const Dr=Ie(Rr());var Wr,Lr={};function Ar(){if(Wr)return Lr;Wr=1;var e=i();Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.default=void 0;var t=e(nt()),s=o();return Lr.default=(0,t.default)((0,s.jsx)("path",{d:"M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3M7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5M16 17H8v-2h8zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13"}),"SmartToy"),Lr}const Nr=Ie(Ar());function Er({askQuestion:e,memberFilter:t,error:r}){const[a,n]=be.useState([]),[i,o]=be.useState(""),[d,u]=be.useState(!1),[,h]=be.useState(null),j=be.useRef(null),g=be.useRef(null);be.useEffect(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[a]),be.useEffect(()=>{var e;null==(e=g.current)||e.focus()},[]);const v=async s=>{if(null==s||s.preventDefault(),!i.trim()||d)return;const r={id:`user-${Date.now()}`,role:"user",content:i.trim(),timestamp:new Date};n(e=>[...e,r]),o(""),u(!0);try{const s=await e({message:r.content,member_filter:t});if(s){const e={id:`assistant-${Date.now()}`,role:"assistant",content:s.answer,sources:s.sources,timestamp:new Date};n(t=>[...t,e]),h(s.conversation_id)}else{const e={id:`error-${Date.now()}`,role:"assistant",content:"Sorry, I encountered an error processing your question. Please try again.",timestamp:new Date};n(t=>[...t,e])}}catch(a){const e={id:`error-${Date.now()}`,role:"assistant",content:"An unexpected error occurred. Please try again.",timestamp:new Date};n(t=>[...t,e])}finally{u(!1)}};return s.jsxs(x,{sx:{display:"flex",flexDirection:"column",height:"100%",minHeight:500},children:[s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[s.jsx(m,{variant:"h6",children:"Ask Questions About Congressional Data"}),a.length>0&&s.jsx(f,{size:"small",onClick:()=>{n([]),h(null)},color:"secondary",children:"Clear Chat"})]}),t&&s.jsxs(L,{severity:"info",sx:{mb:2},children:["Focusing on: ",s.jsx("strong",{children:t})]}),r&&s.jsx(L,{severity:"error",sx:{mb:2},children:r}),s.jsx(ee,{variant:"outlined",sx:{flex:1,overflow:"auto",p:2,mb:2,bgcolor:"background.default",minHeight:300},children:0===a.length?s.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"text.secondary"},children:[s.jsx(Nr,{sx:{fontSize:48,mb:2,opacity:.5}}),s.jsx(m,{variant:"body1",sx:{mb:1},children:"Ask me anything about Greene and Omar"}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"Examples:"}),s.jsxs(x,{sx:{mt:1,textAlign:"center"},children:[s.jsx(p,{label:"What are their positions on immigration?",size:"small",onClick:()=>o("What are Greene's and Omar's positions on immigration?"),sx:{m:.5,cursor:"pointer"}}),s.jsx(p,{label:"How do they differ on healthcare?",size:"small",onClick:()=>o("How do Greene and Omar differ on healthcare policy?"),sx:{m:.5,cursor:"pointer"}}),s.jsx(p,{label:"Compare their voting records",size:"small",onClick:()=>o("Compare the voting records of Greene and Omar on recent bills."),sx:{m:.5,cursor:"pointer"}})]})]}):s.jsxs(s.Fragment,{children:[a.map(e=>s.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"user"===e.role?"flex-end":"flex-start",mb:2},children:[s.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:1,maxWidth:"85%",flexDirection:"user"===e.role?"row-reverse":"row"},children:[s.jsx(x,{sx:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"user"===e.role?"primary.main":"secondary.main",color:"white",flexShrink:0},children:"user"===e.role?s.jsx(Dr,{fontSize:"small"}):s.jsx(Nr,{fontSize:"small"})}),s.jsxs(ee,{elevation:1,sx:{p:2,bgcolor:"user"===e.role?"primary.dark":"background.paper",color:"user"===e.role?"white":"text.primary",borderRadius:2},children:[s.jsx(m,{variant:"body1",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:e.content}),"assistant"===e.role&&s.jsx(x,{sx:{mt:1,display:"flex",justifyContent:"flex-end"},children:s.jsx(l,{title:"Copy to clipboard",children:s.jsx(c,{size:"small",onClick:()=>{return t=e.content,void navigator.clipboard.writeText(t);var t},children:s.jsx(Sr,{fontSize:"small"})})})})]})]}),"assistant"===e.role&&e.sources&&e.sources.length>0&&s.jsx(x,{sx:{maxWidth:"85%",mt:1,ml:5},children:s.jsxs(y,{sx:{bgcolor:"background.paper"},children:[s.jsx(w,{expandIcon:s.jsx(gs,{}),children:s.jsxs(m,{variant:"body2",color:"text.secondary",children:["Sources (",e.sources.length,")"]})}),s.jsx(C,{children:e.sources.map((t,r)=>s.jsxs(x,{sx:{mb:1,pb:1,borderBottom:r<e.sources.length-1?1:0,borderColor:"divider"},children:[s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[s.jsx(p,{label:t.party,size:"small",color:"R"===t.party?"error":"primary"}),s.jsx(m,{variant:"subtitle2",children:t.member_name})]}),s.jsx(m,{variant:"body2",sx:{fontWeight:500},children:t.title}),s.jsx(m,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:t.content_preview}),t.url&&s.jsxs(te,{href:t.url,target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[s.jsx(xs,{fontSize:"small"}),s.jsx(m,{variant:"caption",children:"View source"})]})]},r))})]})})]},e.id)),d&&s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,ml:5},children:[s.jsx(b,{size:20}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"Searching and generating response..."})]}),s.jsx("div",{ref:j})]})}),s.jsxs(x,{component:"form",onSubmit:v,sx:{display:"flex",gap:1},children:[s.jsx(U,{inputRef:g,fullWidth:!0,multiline:!0,maxRows:4,value:i,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())},placeholder:"Ask a question about Greene and Omar...",disabled:d,sx:{bgcolor:"background.paper"}}),s.jsx(f,{type:"submit",variant:"contained",disabled:!i.trim()||d,sx:{minWidth:100},children:d?s.jsx(b,{size:24}):s.jsx(Or,{})})]}),s.jsx(m,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Press Enter to send, Shift+Enter for new line"})]})}function Hr(e){switch(e){case"running":return"warning";case"completed":return"success";case"failed":return"error";default:return"default"}}function Br(){const{status:e,progress:t,loading:r,error:a,startScrape:n,cancelScrape:i,pauseScrape:o,resumeScrape:l,queryData:c,askQuestion:h}=function(){const[e,t]=be.useState(null),[s,r]=be.useState(null),[a,n]=be.useState(!0),[i,o]=be.useState(null),l=be.useRef(null),c=be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/congressional/status`,{credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=await e.json();t(s),o(null)}catch(e){o("Failed to fetch congressional status")}finally{n(!1)}},[]);return be.useEffect(()=>{const e=new AbortController;return fetch(`${Ft()}/api/auth/token`,{credentials:"include",signal:e.signal}).then(t=>{if(e.signal.aborted)return null;if(!t.ok)throw new Error("Authentication required");return t.json()}).then(t=>{if(!t||e.signal.aborted)return;const s=$e(Ft(),{transports:["websocket","polling"],auth:{token:t.token}});l.current=s,s.on("connect_error",e=>{o("Failed to establish real-time connection for congressional data. Please check your network and authentication."),n(!1)}),s.on("disconnect",e=>{"io server disconnect"!==e&&"io client disconnect"!==e&&o("Real-time connection for congressional data lost. Updates may be delayed.")}),s.on("connect",()=>{o(e=>e&&e.includes("Real-time connection for congressional")?null:e)}),s.on("congressional_started",()=>{r(null),o(null),c()}),s.on("congressional_progress",e=>{r(e)}),s.on("congressional_complete",()=>{c()}),s.on("congressional_error",e=>{o(e.error||"Congressional scraping failed"),c()}),s.on("congressional_cancelled",()=>{c()}),s.on("congressional_paused",()=>{c()}),s.on("congressional_resumed",()=>{c()}),c()}).catch(e=>{"AbortError"!==e.name&&(o("Authentication failed for congressional data. Please log in again."),n(!1),l.current&&(l.current.disconnect(),l.current=null))}),()=>{e.abort(),l.current&&(l.current.disconnect(),l.current=null)}},[c]),{status:e,progress:s,loading:a,error:i,startScrape:be.useCallback(async e=>{o(null);try{const t=await fetch(`${Ft()}/api/congressional/scrape/start`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),s=await t.json();return!(!t.ok||!s.success)||(o(s.error||s.message||"Failed to start congressional scraping"),!1)}catch(t){return o("Connection error while starting congressional scraping"),!1}},[]),cancelScrape:be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/congressional/scrape/cancel`,{method:"POST",credentials:"include"}),t=await e.json();return!(!e.ok||!t.success)||(o(t.error||t.message||"Failed to cancel congressional scraping"),!1)}catch(e){return o("Connection error while cancelling congressional scraping"),!1}},[]),pauseScrape:be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/congressional/scrape/pause`,{method:"POST",credentials:"include"}),t=await e.json();return!(!e.ok||!t.success)||(o(t.error||t.message||"Failed to pause congressional scraping"),!1)}catch(e){return o("Connection error while pausing congressional scraping"),!1}},[]),resumeScrape:be.useCallback(async()=>{try{const e=await fetch(`${Ft()}/api/congressional/scrape/resume`,{method:"POST",credentials:"include"}),t=await e.json();return!(!e.ok||!t.success)||(o(t.error||t.message||"Failed to resume congressional scraping"),!1)}catch(e){return o("Connection error while resuming congressional scraping"),!1}},[]),queryData:be.useCallback(async e=>{o(null);try{const t=await fetch(`${Ft()}/api/congressional/query`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),s=await t.json();if(!t.ok||!s.success){const e=(null==s?void 0:s.error)||(null==s?void 0:s.message)||`Query failed (HTTP ${t.status})`;return o(e),null}return s}catch(t){return o("Connection error while querying congressional data"),null}},[]),askQuestion:be.useCallback(async e=>{o(null);try{const t=await fetch(`${Ft()}/api/congressional/chat`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),s=await t.json();if(!t.ok||!s.success){const e=(null==s?void 0:s.error)||`Chat request failed (HTTP ${t.status})`;return o(e),null}return s}catch(t){return o("Connection error while processing your question"),null}},[]),refreshStatus:c}}(),[j,g]=be.useState(""),[y,w]=be.useState({}),[C,_]=be.useState([]),[k,z]=be.useState(!1),[M,I]=be.useState(0),[P,$]=be.useState(1),[O]=be.useState(10),[T,F]=be.useState(0),[R,D]=be.useState([]),[W,A]=be.useState({open:!1,message:"",severity:"info"}),[N,E]=be.useState(!1),[H,q]=be.useState(!1),[G,J]=be.useState(!1),[K,Q]=be.useState(!1),Y=e?e.collections.congressional_data:null,ee=be.useMemo(()=>Object.keys((null==Y?void 0:Y.member_counts)||{}).sort(),[Y]),te=be.useMemo(()=>{const e=(P-1)*O,t=e+O;return C.slice(e,t)},[C,P,O]),ne=e=>{w(t=>({...t,member_name:e}))},ie=t&&t.total>0?t.current/t.total*100:0;return s.jsxs(B,{maxWidth:"lg",sx:{py:4},children:[s.jsxs(x,{sx:{mb:4},children:[s.jsxs(m,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(gr,{})," Congressional Data"]}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"Scrape, search, and analyze content from congressional member websites."})]}),s.jsxs(V,{container:!0,spacing:3,children:[s.jsx(V,{item:!0,xs:12,md:4,children:s.jsxs(d,{children:[s.jsx(Z,{title:"Scraping Controls"}),s.jsx(u,{children:r&&!e?s.jsx(x,{sx:{display:"flex",justifyContent:"center",py:2},children:s.jsx(b,{size:24})}):s.jsxs(s.Fragment,{children:[s.jsxs(x,{sx:{mb:2},children:[s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Status"}),s.jsx(p,{label:(null==e?void 0:e.status)??"unknown",size:"small",color:Hr((null==e?void 0:e.status)??"")}),(null==e?void 0:e.paused)&&s.jsx(p,{label:"paused",size:"small",sx:{ml:1}})]}),t&&t.total>0&&s.jsxs(x,{sx:{mb:2},children:[s.jsxs(m,{variant:"caption",color:"text.secondary",children:[t.phase,": ",t.current," / ",t.total]}),s.jsx(S,{variant:"determinate",value:ie,sx:{mt:.5}})]}),s.jsxs(x,{sx:{mb:2},children:[s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Documents"}),s.jsxs(m,{variant:"body2",children:[(null==Y?void 0:Y.object_count)??0," indexed documents"]})]}),s.jsxs(x,{sx:{mb:2},children:[s.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Members"}),s.jsxs(m,{variant:"body2",children:[(null==Y?void 0:Y.member_counts)?Object.keys(Y.member_counts).length:0," ","members"]})]})]})}),s.jsxs(v,{children:[s.jsx(f,{variant:"contained",size:"small",onClick:()=>E(!0),disabled:"running"===(null==e?void 0:e.status)||H,children:H?s.jsx(b,{size:16}):"Start"}),s.jsx(f,{size:"small",onClick:async()=>{if(e){J(!0);try{if(e.paused){const e=await l();A({open:!0,message:e?"Scraping resumed":"Failed to resume scraping",severity:e?"success":"error"})}else{const e=await o();A({open:!0,message:e?"Scraping paused":"Failed to pause scraping",severity:e?"success":"error"})}}finally{J(!1)}}},disabled:!e||"running"!==e.status||G,children:G?s.jsx(b,{size:16}):(null==e?void 0:e.paused)?"Resume":"Pause"}),s.jsx(f,{size:"small",color:"error",onClick:async()=>{Q(!0);try{const e=await i();A({open:!0,message:e?"Cancellation requested":"Failed to cancel scraping",severity:e?"success":"error"})}finally{Q(!1)}},disabled:!e||"running"!==e.status||K,children:K?s.jsx(b,{size:16}):"Cancel"})]})]})}),s.jsxs(V,{item:!0,xs:12,md:8,children:[s.jsxs(d,{children:[s.jsx(Z,{title:"Query"}),s.jsxs(u,{children:[s.jsxs(x,{sx:{display:"flex",gap:1,mb:2},children:[s.jsx(U,{fullWidth:!0,size:"small",placeholder:"Ask a question or search congressional content...",value:j,onChange:e=>g(e.target.value),InputProps:{startAdornment:s.jsx(Qs,{fontSize:"small",sx:{mr:1}})},disabled:k}),s.jsx(f,{variant:"contained",onClick:async()=>{if(!j.trim())return void A({open:!0,message:"Please enter a query",severity:"info"});z(!0);const e={id:`user-${Date.now()}`,role:"user",content:j.trim(),meta:y};D(t=>[...t,e]);const t={query:j,member_name:y.member_name,party:y.party,state:y.state,topic:y.topic,date_from:y.date_from,date_to:y.date_to,limit:50,messages:R.map(e=>({role:e.role,content:e.content})).concat({role:"user",content:j.trim()})},s=await c(t);if(s&&s.success){_(s.results),F(s.total_results),$(1),I(0);const e=s.results.slice(0,3).map(e=>`â€¢ ${e.title||e.url}`),t=[`Found ${s.total_results} document(s) matching your query.`,...e.length?["Top results:",...e]:[]],r={id:`assistant-${Date.now()}`,role:"assistant",content:t.join("\n")};D(e=>[...e,r])}else if(!s){const e=a||"Query failed",t={id:`assistant-error-${Date.now()}`,role:"assistant",content:e};D(e=>[...e,t]),A({open:!0,message:e,severity:"error"})}z(!1)},disabled:k,startIcon:k?s.jsx(b,{size:16}):s.jsx(Qs,{}),children:"Search"})]}),s.jsx(fr,{members:ee,onFilterChange:w,initialFilters:y})]})]}),s.jsxs(x,{sx:{mt:3},children:[s.jsxs(se,{value:M,onChange:(e,t)=>I(t),sx:{borderBottom:1,borderColor:"divider",mb:2},children:[s.jsx(re,{label:"Chat"}),s.jsx(re,{label:"Results"}),s.jsx(re,{label:"Analytics"})]}),0===M&&s.jsx(Er,{askQuestion:h,memberFilter:y.member_name,error:a}),1===M&&s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[R.length>0&&s.jsx(x,{sx:{mb:2},children:R.map(e=>s.jsx(x,{sx:{mb:1,display:"flex",justifyContent:"user"===e.role?"flex-end":"flex-start"},children:s.jsx(x,{sx:{maxWidth:"80%",px:1.5,py:1,borderRadius:2,bgcolor:"user"===e.role?"primary.main":"assistant"===e.role?"grey.100":"grey.200",color:"user"===e.role?"primary.contrastText":"text.primary",whiteSpace:"pre-line"},children:e.content})},e.id))}),0===C.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No results yet. Run a search to see documents."}):s.jsxs(s.Fragment,{children:[te.map(e=>s.jsx(_r,{result:e,onMemberClick:ne},`${e.member_name}-${e.url}-${e.scraped_at}`)),s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2},children:[s.jsxs(m,{variant:"caption",color:"text.secondary",children:["Showing"," ",0===C.length?0:(P-1)*O+1," ","â€“",Math.min(P*O,T||C.length)," ","of ",T||C.length]}),s.jsx(ae,{count:Math.max(1,Math.ceil((T||C.length)/O)),page:P,onChange:(e,t)=>$(t),size:"small"})]})]})]}),2===M&&Y&&s.jsx(zr,{stats:Y,queryResults:C})]})]})]}),a&&s.jsx(x,{sx:{mt:2},children:s.jsx(L,{severity:"error",children:a})}),s.jsx(Mr,{open:N,onClose:()=>E(!1),onStart:async e=>{q(!0);try{const t=await n(e);return A({open:!0,message:t?"Scraping started":"Failed to start scraping",severity:t?"success":"error"}),t}finally{q(!1)}}}),s.jsx(X,{open:W.open,autoHideDuration:4e3,onClose:()=>A(e=>({...e,open:!1})),children:s.jsx(L,{onClose:()=>A(e=>({...e,open:!1})),severity:W.severity,sx:{width:"100%"},children:W.message})})]})}var Vr,Ur={};function qr(){if(Vr)return Ur;Vr=1;var e=i();Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.default=void 0;var t=e(nt()),s=o();return Ur.default=(0,t.default)((0,s.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),Ur}const Gr=Ie(qr());var Jr,Kr={};function Qr(){if(Jr)return Kr;Jr=1;var e=i();Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.default=void 0;var t=e(nt()),s=o();return Kr.default=(0,t.default)((0,s.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),Kr}const Xr=Ie(Qr());var Yr,Zr={};function ea(){if(Yr)return Zr;Yr=1;var e=i();Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.default=void 0;var t=e(nt()),s=o();return Zr.default=(0,t.default)((0,s.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn"),Zr}const ta=Ie(ea()),sa=[{id:"amazon_fresh",name:"Amazon Fresh",color:"#FF9900"},{id:"instacart",name:"Instacart",color:"#43B02A"},{id:"doordash",name:"DoorDash",color:"#FF3008"},{id:"safeway",name:"Safeway",color:"#E31837"}];function ra(e){const t=sa.find(t=>t.id===e||t.name.toLowerCase()===e.toLowerCase());return(null==t?void 0:t.color)??"#9E9E9E"}function aa(e){const t=sa.find(t=>t.id===e||t.name.toLowerCase()===e.toLowerCase());return(null==t?void 0:t.name)??e}const na=be.memo(function({onSearch:e,loading:t=!1,disabled:r=!1}){const[a,n]=be.useState(""),[i,o]=be.useState("20024"),[l,c]=be.useState(sa.map(e=>e.id)),d=()=>{a.trim()&&e(a.trim(),i,l)};return s.jsxs(x,{sx:{width:"100%"},children:[s.jsxs(x,{sx:{display:"flex",gap:2,mb:2,flexWrap:{xs:"wrap",md:"nowrap"}},children:[s.jsx(U,{fullWidth:!0,size:"small",placeholder:"Search for a product (e.g., milk, bread, eggs)...",value:a,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"!==e.key||!a.trim()||t||r||d()},disabled:r||t,InputProps:{startAdornment:s.jsx(q,{position:"start",children:s.jsx(Qs,{fontSize:"small",color:"action"})})},sx:{minWidth:200}}),s.jsx(U,{size:"small",placeholder:"ZIP Code",value:i,onChange:e=>o(e.target.value),disabled:r||t,InputProps:{startAdornment:s.jsx(q,{position:"start",children:s.jsx(ta,{fontSize:"small",color:"action"})})},sx:{width:{xs:"100%",sm:140}}}),s.jsxs($,{size:"small",sx:{minWidth:180},children:[s.jsx(O,{id:"service-select-label",children:"Services"}),s.jsx(T,{labelId:"service-select-label",multiple:!0,value:l,onChange:e=>{const t=e.target.value;c("string"==typeof t?t.split(","):t)},input:s.jsx(ne,{label:"Services"}),disabled:r||t,renderValue:e=>`${e.length} selected`,children:sa.map(e=>s.jsx(F,{value:e.id,children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(x,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:e.color}}),e.name]})},e.id))})]}),s.jsx(f,{variant:"contained",onClick:d,disabled:r||t||!a.trim(),startIcon:t?s.jsx(b,{size:16,color:"inherit"}):s.jsx(Qs,{}),sx:{minWidth:100,whiteSpace:"nowrap"},children:t?"Searching...":"Search"})]}),l.length>0&&s.jsx(g,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:l.map(e=>{const t=sa.find(t=>t.id===e);return t?s.jsx(p,{label:t.name,size:"small",onDelete:l.length>1?()=>(e=>{c(t=>t.filter(t=>t!==e))})(e):void 0,sx:{borderLeft:`3px solid ${t.color}`,bgcolor:"action.hover"}},e):null})})]})});var ia,oa={};function la(){if(ia)return oa;ia=1;var e=i();Object.defineProperty(oa,"__esModule",{value:!0}),oa.default=void 0;var t=e(nt()),s=o();return oa.default=(0,t.default)((0,s.jsx)("path",{d:"M3 18h6v-2H3zM3 6v2h18V6zm0 7h12v-2H3z"}),"Sort"),oa}const ca=Ie(la());var da,ua={};function xa(){if(da)return ua;da=1;var e=i();Object.defineProperty(ua,"__esModule",{value:!0}),ua.default=void 0;var t=e(nt()),s=o();return ua.default=(0,t.default)((0,s.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),ua}const ha=Ie(xa());var ma,pa={};function ja(){if(ma)return pa;ma=1;var e=i();Object.defineProperty(pa,"__esModule",{value:!0}),pa.default=void 0;var t=e(nt()),s=o();return pa.default=(0,t.default)((0,s.jsx)("path",{d:"M11 9h2V6h3V4h-3V1h-2v3H8v2h3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2m10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2m-9.83-3.25.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25"}),"AddShoppingCart"),pa}const ga=Ie(ja());var va,fa={};function ba(){if(va)return fa;va=1;var e=i();Object.defineProperty(fa,"__esModule",{value:!0}),fa.default=void 0;var t=e(nt()),s=o();return fa.default=(0,t.default)((0,s.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),fa}const ya=Ie(ba());var wa,Sa={};function Ca(){if(wa)return Sa;wa=1;var e=i();Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.default=void 0;var t=e(nt()),s=o();return Sa.default=(0,t.default)((0,s.jsx)("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer"),Sa}const _a=Ie(Ca());var ka,za={};function Ma(){if(ka)return za;ka=1;var e=i();Object.defineProperty(za,"__esModule",{value:!0}),za.default=void 0;var t=e(nt()),s=o();return za.default=(0,t.default)([(0,s.jsx)("path",{d:"M8.55 12c-1.07-.71-2.25-1.27-3.53-1.61 1.28.34 2.46.9 3.53 1.61m10.43-1.61c-1.29.34-2.49.91-3.57 1.64 1.08-.73 2.28-1.3 3.57-1.64"},"0"),(0,s.jsx)("path",{d:"M15.49 9.63c-.18-2.79-1.31-5.51-3.43-7.63-2.14 2.14-3.32 4.86-3.55 7.63 1.28.68 2.46 1.56 3.49 2.63 1.03-1.06 2.21-1.94 3.49-2.63m-6.5 2.65c-.14-.1-.3-.19-.45-.29.15.11.31.19.45.29m6.42-.25c-.13.09-.27.16-.4.26.13-.1.27-.17.4-.26M12 15.45C9.85 12.17 6.18 10 2 10c0 5.32 3.36 9.82 8.03 11.49.63.23 1.29.4 1.97.51.68-.12 1.33-.29 1.97-.51C18.64 19.82 22 15.32 22 10c-4.18 0-7.85 2.17-10 5.45"},"1")],"Spa"),za}const Ia=Ie(Ma());function Pa(e){return`$${e.toFixed(2)}`}const $a=be.memo(function({product:e,onSave:t,highlighted:r=!1}){var a,n;const i=ra(e.service),o=aa(e.service),c=Math.round(100*e.similarity_score);return s.jsxs(d,{elevation:r?4:2,sx:{position:"relative",height:"100%",display:"flex",flexDirection:"column",borderLeft:`4px solid ${i}`,transition:"all 0.3s ease",...r&&{border:"2px solid",borderColor:"success.main",borderLeftWidth:4,borderLeftColor:i},"&:hover":{transform:"translateY(-5px)",boxShadow:6}},children:[r&&s.jsx(p,{icon:s.jsx(_a,{}),label:"Best Price",color:"success",size:"small",sx:{position:"absolute",top:8,right:8,zIndex:1,fontWeight:600}}),e.image_url?s.jsx(ie,{component:"img",height:"140",image:e.image_url,alt:e.name,sx:{objectFit:"contain",bgcolor:"background.default",p:1}}):s.jsx(x,{sx:{height:140,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"action.hover"},children:s.jsx(m,{variant:"caption",color:"text.secondary",children:"No image"})}),s.jsxs(u,{sx:{flexGrow:1,pb:1},children:[s.jsx(p,{label:o,size:"small",sx:{mb:1,bgcolor:i,color:"white",fontWeight:600,fontSize:"0.7rem"}}),s.jsx(m,{variant:"subtitle1",component:"h3",sx:{fontWeight:600,lineHeight:1.3,mb:1,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.name}),s.jsx(m,{variant:"h5",color:"primary",sx:{fontWeight:700,mb:1},children:Pa(e.price)}),s.jsxs(g,{direction:"row",spacing:.5,flexWrap:"wrap",useFlexGap:!0,sx:{mb:1},children:[e.size&&s.jsx(p,{label:e.size,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:22}}),e.brand&&s.jsx(p,{label:e.brand,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:22}}),(null==(a=e.attributes)?void 0:a.is_organic)&&s.jsx(l,{title:"Organic Product",children:s.jsx(p,{icon:s.jsx(Ia,{sx:{fontSize:"0.9rem"}}),label:"Organic",size:"small",color:"success",variant:"outlined",sx:{fontSize:"0.7rem",height:22}})})]}),(null==(n=e.attributes)?void 0:n.unit_price)&&s.jsxs(m,{variant:"caption",color:"text.secondary",display:"block",children:[Pa(e.attributes.unit_price),"/oz"]}),s.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:1},children:[s.jsx(l,{title:e.availability?"In Stock":"Out of Stock",children:s.jsx(p,{icon:e.availability?s.jsx(Ds,{sx:{fontSize:"0.9rem"}}):s.jsx(ya,{sx:{fontSize:"0.9rem"}}),label:e.availability?"Available":"Unavailable",size:"small",color:e.availability?"success":"error",variant:"outlined",sx:{fontSize:"0.65rem",height:20}})}),s.jsx(l,{title:`${c}% match to your search`,children:s.jsx(p,{label:`${c}%`,size:"small",color:(h=c,h>=80?"success":h>=60?"warning":"error"),sx:{fontSize:"0.7rem",height:20,fontWeight:600}})})]})]}),s.jsxs(v,{sx:{px:2,pb:2,pt:0,justifyContent:"space-between"},children:[s.jsx(f,{size:"small",variant:"outlined",startIcon:s.jsx(xs,{}),onClick:()=>{e.url&&window.open(e.url,"_blank","noopener,noreferrer")},disabled:!e.url,children:"View"}),t&&s.jsx(f,{size:"small",variant:"contained",startIcon:s.jsx(ga,{}),onClick:()=>{t&&t(e.id)},children:"Save"})]})]});var h});const Oa=be.memo(function({groups:e,onSaveProduct:t,loading:r=!1,servicesScraped:a=[],totalProducts:n=0}){const[i,o]=be.useState("price_asc"),[l,c]=be.useState({availableOnly:!1,organicOnly:!1,services:[]}),[d,u]=be.useState(new Set(e.map(e=>e.representative_name)));be.useEffect(()=>{u(new Set(e.map(e=>e.representative_name)))},[e]);const h=e=>{c(t=>({...t,[e]:!t[e]}))},j=be.useMemo(()=>e.map(e=>{const t=function(e,t){return e.filter(e=>{var s;return!(t.availableOnly&&!e.availability||t.organicOnly&&!(null==(s=e.attributes)?void 0:s.is_organic)||t.services.length>0&&!t.services.includes(e.service))})}(e.products,l),s=function(e,t){const s=[...e];switch(t){case"price_asc":return s.sort((e,t)=>e.price-t.price);case"price_desc":return s.sort((e,t)=>t.price-e.price);case"service":return s.sort((e,t)=>e.service.localeCompare(t.service));case"similarity":return s.sort((e,t)=>t.similarity_score-e.similarity_score);default:return s}}(t,i),r=function(e){if(0===e.length)return null;const t=e.filter(e=>e.availability);return 0===t.length?null:t.reduce((e,t)=>t.price<e.price?t:e).id}(s);return{...e,products:s,lowestPriceId:r}}),[e,l,i]);return r?s.jsxs(x,{children:[s.jsxs(x,{sx:{display:"flex",gap:2,mb:3},children:[s.jsx(K,{variant:"rectangular",width:150,height:40}),s.jsx(K,{variant:"rectangular",width:100,height:40}),s.jsx(K,{variant:"rectangular",width:100,height:40})]}),[1,2].map(e=>s.jsxs(x,{sx:{mb:3},children:[s.jsx(K,{variant:"rectangular",width:"100%",height:60,sx:{mb:2}}),s.jsx(V,{container:!0,spacing:2,children:[1,2,3].map(e=>s.jsx(V,{item:!0,xs:12,sm:6,md:4,children:s.jsx(K,{variant:"rectangular",height:280})},e))})]},e))]}):0===e.length?s.jsxs(x,{sx:{textAlign:"center",py:6,px:2,bgcolor:"action.hover",borderRadius:2},children:[s.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No products found"}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"Try searching for a different product or adjusting your filters."})]}):s.jsxs(x,{children:[s.jsxs(x,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",gap:2,mb:3},children:[s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsxs(m,{variant:"body2",color:"text.secondary",children:[n," products in ",e.length," group(s)"]}),a.length>0&&s.jsx(g,{direction:"row",spacing:.5,children:a.map(e=>s.jsx(p,{label:e.replace("_"," "),size:"small",sx:{fontSize:"0.65rem",height:20,textTransform:"capitalize"}},e))})]}),s.jsxs(x,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s.jsxs($,{size:"small",sx:{minWidth:140},children:[s.jsxs(O,{id:"sort-select-label",children:[s.jsx(ca,{sx:{fontSize:16,mr:.5,verticalAlign:"middle"}}),"Sort"]}),s.jsxs(T,{labelId:"sort-select-label",value:i,onChange:e=>{o(e.target.value)},label:"Sort",children:[s.jsx(F,{value:"price_asc",children:"Price: Low to High"}),s.jsx(F,{value:"price_desc",children:"Price: High to Low"}),s.jsx(F,{value:"service",children:"By Service"}),s.jsx(F,{value:"similarity",children:"By Match Score"})]})]}),s.jsxs(g,{direction:"row",spacing:.5,alignItems:"center",children:[s.jsx(ha,{fontSize:"small",color:"action"}),s.jsx(p,{label:"Available",size:"small",variant:l.availableOnly?"filled":"outlined",color:l.availableOnly?"primary":"default",onClick:()=>h("availableOnly"),sx:{cursor:"pointer"}}),s.jsx(p,{label:"Organic",size:"small",variant:l.organicOnly?"filled":"outlined",color:l.organicOnly?"success":"default",onClick:()=>h("organicOnly"),sx:{cursor:"pointer"}})]})]})]}),s.jsx(x,{sx:{mb:3},children:s.jsx(g,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:sa.map(e=>{const t=0===l.services.length||l.services.includes(e.id);return s.jsx(p,{label:e.name,size:"small",variant:t?"filled":"outlined",onClick:()=>{return t=e.id,void c(e=>({...e,services:e.services.includes(t)?e.services.filter(e=>e!==t):[...e.services,t]}));var t},sx:{cursor:"pointer",bgcolor:t?e.color:"transparent",color:t?"white":"text.primary",borderColor:e.color,"&:hover":{bgcolor:t?e.color:`${e.color}22`}}},e.id)})})}),j.map(e=>s.jsxs(y,{expanded:d.has(e.representative_name),onChange:()=>{return t=e.representative_name,void u(e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s});var t},sx:{mb:2,"&:before":{display:"none"},borderRadius:1,overflow:"hidden"},children:[s.jsx(w,{expandIcon:s.jsx(gs,{}),sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[s.jsx(m,{variant:"subtitle1",sx:{fontWeight:600},children:e.representative_name}),s.jsx(p,{label:`${e.products.length} product${1!==e.products.length?"s":""}`,size:"small",sx:{fontSize:"0.7rem"}}),e.lowestPriceId&&s.jsx(p,{label:"Best price available",size:"small",color:"success",sx:{fontSize:"0.65rem"}})]})}),s.jsxs(C,{sx:{p:2,bgcolor:"background.paper"},children:[e.reasoning&&s.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:2,fontStyle:"italic"},children:e.reasoning}),0===e.products.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No products match the current filters."}):s.jsx(V,{container:!0,spacing:2,children:e.products.map(r=>s.jsx(V,{item:!0,xs:12,sm:6,md:4,children:s.jsx($a,{product:r,onSave:t,highlighted:r.id===e.lowestPriceId})},r.id))})]})]},e.representative_name))]})});var Ta,Fa={};function Ra(){if(Ta)return Fa;Ta=1;var e=i();Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.default=void 0;var t=e(nt()),s=o();return Fa.default=(0,t.default)((0,s.jsx)("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"}),"HourglassEmpty"),Fa}const Da=Ie(Ra());var Wa,La={};function Aa(){if(Wa)return La;Wa=1;var e=i();Object.defineProperty(La,"__esModule",{value:!0}),La.default=void 0;var t=e(nt()),s=o();return La.default=(0,t.default)((0,s.jsx)("path",{d:"m16 18 2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"}),"TrendingDown"),La}const Na=Ie(Aa());function Ea(e,t){const s=e.split(/\r?\n/).filter(e=>e.trim()),r=[];for(const a of s){const e=a.trim();if(e&&!e.startsWith("#"))if(t.endsWith(".csv")||e.includes(",")){const t=e.split(",").map(e=>e.trim()),s=t[0],a=t[1]?parseInt(t[1],10):1;s&&r.push({query:s,quantity:isNaN(a)||a<1?1:a})}else r.push({query:e,quantity:1})}return r}const Ha=be.memo(function({open:e,onClose:t,onComplete:r,sessionToken:a}){const[n,i]=be.useState("Shopping List"),[o,d]=be.useState(""),[u,h]=be.useState([]),[j,g]=be.useState(null),[v,y]=be.useState(!1),[w,C]=be.useState(!1),[M,I]=be.useState(null),[P,$]=be.useState(null),[O,T]=be.useState(null),[F,R]=be.useState([]),[D,W]=be.useState(null),[B,V]=be.useState(!1),q=be.useRef(null),G=be.useRef(null);be.useEffect(()=>()=>{q.current&&(q.current.close(),q.current=null)},[]),be.useEffect(()=>{e&&(i("Shopping List"),d(""),h([]),g(null),y(!1),C(!1),I(null),$(null),T(null),R([]),W(null),V(!1))},[e]);const J=be.useCallback(e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;I(null),g(s.name);const r=new FileReader;r.onload=e=>{var t;const r=null==(t=e.target)?void 0:t.result;try{const e=Ea(r,s.name);0===e.length?(I("No valid items found in file"),h([])):e.length>100?(I("Maximum 100 items allowed"),h([])):(h(e),d(""))}catch(a){I(`Failed to parse file: ${a}`),h([])}},r.onerror=()=>{I("Failed to read file")},r.readAsText(s)},[]),K=be.useCallback(e=>{const t=e.target.value;if(d(t),g(null),t.trim()){const e=Ea(t,"manual.txt");h(e)}else h([])},[]),Q=be.useCallback(e=>{h(t=>t.filter((t,s)=>s!==e))},[]),X=be.useCallback(e=>{const t=Ft(),s=t.startsWith("https")?"wss":"ws",r=t.replace(/^https?:\/\//,""),a=new WebSocket(`${s}://${r}/api/jobs/ws/jobs/${e}`);q.current=a,a.onopen=()=>{},a.onmessage=e=>{try{const t=JSON.parse(e.data),s=t.result||t;s.progress&&T(s.progress),s.list_id&&$(s.list_id),s.items&&R(e=>{const t=[...e];for(const r of s.items){const e=t.findIndex(e=>e.query===r.query);e>=0?t[e]=r:t.push(r)}return t}),s.total_stats&&W(s.total_stats),"completed"===s.status?(C(!1),V(!0),a.close()):"error"!==s.status&&"failed"!==s.status||(C(!1),I(s.error||"Processing failed"),a.close())}catch(t){}},a.onerror=e=>{I("WebSocket connection error"),C(!1)},a.onclose=()=>{q.current=null}},[]),Y=be.useCallback(async()=>{if(0!==u.length){y(!0),I(null);try{const e=await fetch(`${Ft()}/api/price-comparison/bulk-upload`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({items:u.map(e=>({query:e.query,quantity:e.quantity})),session_token:a,name:n})}),t=await e.json(),s=t.data||t;if(!e.ok||"error"===s.status)return I(s.message||"Upload failed"),void y(!1);y(!1),C(!0),R(u.map(e=>({query:e.query,quantity:e.quantity,status:"pending"}))),X(s.job_id)}catch(e){I(`Upload failed: ${e}`),y(!1)}}else I("No items to upload")},[u,a,n,X]),Z=be.useCallback(()=>{q.current&&(q.current.close(),q.current=null),t()},[t]),te=be.useCallback(()=>{P&&r(P),Z()},[P,r,Z]),se=e=>{switch(e){case"completed":return s.jsx(Ds,{color:"success",fontSize:"small"});case"error":return s.jsx(Ns,{color:"error",fontSize:"small"});case"processing":return s.jsx(b,{size:16});default:return s.jsx(Da,{color:"disabled",fontSize:"small"})}},re=v||w,ae=u.length>0&&!re&&!B;return s.jsxs(A,{open:e,onClose:re?void 0:Z,maxWidth:"md",fullWidth:!0,disableEscapeKeyDown:re,children:[s.jsxs(N,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(Xr,{}),"Upload Shopping List",!re&&s.jsx(c,{onClick:Z,sx:{position:"absolute",right:8,top:8},children:s.jsx(ys,{})})]}),s.jsxs(E,{dividers:!0,children:[M&&s.jsx(L,{severity:"error",sx:{mb:2},onClose:()=>I(null),children:M}),!w&&!B&&s.jsxs(s.Fragment,{children:[s.jsx(U,{fullWidth:!0,label:"List Name",value:n,onChange:e=>i(e.target.value),size:"small",sx:{mb:2},disabled:re}),s.jsxs(x,{sx:{border:"2px dashed",borderColor:"divider",borderRadius:2,p:3,textAlign:"center",mb:2,cursor:re?"default":"pointer","&:hover":{borderColor:re?"divider":"primary.main",bgcolor:re?"transparent":"action.hover"}},onClick:()=>{var e;return!re&&(null==(e=G.current)?void 0:e.click())},children:[s.jsx("input",{type:"file",ref:G,accept:".csv,.txt",onChange:J,style:{display:"none"},disabled:re}),s.jsx(Xr,{sx:{fontSize:40,color:"text.secondary",mb:1}}),s.jsx(m,{variant:"body1",gutterBottom:!0,children:j||"Drop a CSV or TXT file here, or click to browse"}),s.jsx(m,{variant:"caption",color:"text.secondary",children:'Format: One product per line, optionally with quantity (e.g., "milk, 2")'})]}),s.jsx(m,{variant:"subtitle2",sx:{mb:1},children:"Or enter items manually:"}),s.jsx(U,{fullWidth:!0,multiline:!0,rows:4,placeholder:"Enter items, one per line:\nmilk, 2\nbread\neggs, 12",value:o,onChange:K,size:"small",sx:{mb:2},disabled:re}),u.length>0&&s.jsxs(x,{sx:{mb:2},children:[s.jsxs(m,{variant:"subtitle2",sx:{mb:1},children:["Preview (",u.length," items):"]}),s.jsx(x,{sx:{maxHeight:200,overflow:"auto",border:1,borderColor:"divider",borderRadius:1,p:1},children:u.map((e,t)=>s.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",py:.5,px:1,"&:hover":{bgcolor:"action.hover"}},children:[s.jsxs(m,{variant:"body2",children:[e.query," ",s.jsx(p,{label:`x${e.quantity}`,size:"small",sx:{ml:1}})]}),s.jsx(l,{title:"Remove",children:s.jsx(c,{size:"small",onClick:()=>Q(t),children:s.jsx(Ms,{fontSize:"small"})})})]},t))})]})]}),(w||B)&&s.jsxs(x,{children:[O&&s.jsxs(x,{sx:{mb:3},children:[s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsxs(m,{variant:"body2",children:["Processing: ",O.current_item]}),s.jsxs(m,{variant:"body2",color:"text.secondary",children:[O.items_completed," / ",O.total_items]})]}),s.jsx(S,{variant:"determinate",value:O.percentage,sx:{height:8,borderRadius:1}})]}),B&&D&&s.jsx(L,{severity:"success",sx:{mb:2},icon:s.jsx(Ds,{}),children:s.jsxs(m,{variant:"subtitle2",children:["Processing complete! ",D.items_processed," items processed",D.items_failed>0&&`, ${D.items_failed} failed`]})}),D&&Object.keys(D.service_totals).length>0&&s.jsxs(x,{sx:{mb:3},children:[s.jsx(m,{variant:"subtitle2",sx:{mb:1},children:"Price by Service:"}),s.jsx(oe,{component:ee,variant:"outlined",children:s.jsxs(le,{size:"small",children:[s.jsx(ce,{children:s.jsxs(de,{children:[s.jsx(ue,{children:"Service"}),s.jsx(ue,{align:"right",children:"Total"})]})}),s.jsx(xe,{children:Object.entries(D.service_totals).sort(([,e],[,t])=>e-t).map(([e,t],r)=>s.jsxs(de,{sx:{bgcolor:e===D.cheapest_service?"success.dark":"transparent"},children:[s.jsx(ue,{children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(x,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:ra(e)}}),aa(e),0===r&&s.jsx(p,{label:"Cheapest",size:"small",color:"success",sx:{ml:1,fontSize:"0.6rem"}})]})}),s.jsx(ue,{align:"right",children:s.jsxs(m,{sx:{fontWeight:0===r?700:400},children:["$",t.toFixed(2)]})})]},e))})]})}),D.potential_savings>0&&s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:2,p:1.5,bgcolor:"success.dark",borderRadius:1},children:[s.jsx(Na,{}),s.jsxs(m,{variant:"body2",children:["Potential savings by choosing"," ",aa(D.cheapest_service||""),":",s.jsxs("strong",{children:[" ","$",D.potential_savings.toFixed(2)]})]})]})]}),s.jsxs(x,{children:[s.jsx(m,{variant:"subtitle2",sx:{mb:1},children:"Items:"}),s.jsx(_,{dense:!0,sx:{maxHeight:200,overflow:"auto",border:1,borderColor:"divider",borderRadius:1},children:F.map((e,t)=>s.jsxs(k,{children:[s.jsx(he,{sx:{minWidth:32},children:se(e.status)}),s.jsx(z,{primary:e.query,secondary:e.error?e.error:"completed"===e.status?"Completed":"processing"===e.status?"Processing...":"Pending",secondaryTypographyProps:{color:e.error?"error":"text.secondary",fontSize:"0.75rem"}}),s.jsx(p,{label:`x${e.quantity}`,size:"small"})]},t))})]})]})]}),s.jsx(H,{children:B?s.jsxs(s.Fragment,{children:[s.jsx(f,{onClick:Z,children:"Close"}),P&&s.jsx(f,{variant:"contained",onClick:te,children:"View Results"})]}):s.jsxs(s.Fragment,{children:[s.jsx(f,{onClick:Z,disabled:re,children:"Cancel"}),s.jsx(f,{variant:"contained",onClick:Y,disabled:!ae,startIcon:re?s.jsx(b,{size:16,color:"inherit"}):s.jsx(Xr,{}),children:v?"Uploading...":w?"Processing...":"Upload & Compare"})]})})]})}),Ba=be.memo(function({listId:e,onBack:t}){const[r,a]=be.useState(!0),[n,i]=be.useState(null),[o,l]=be.useState(null),c=be.useCallback(async()=>{a(!0),i(null);try{const t=await fetch(`${Ft()}/api/price-comparison/shopping-list/${e}`,{credentials:"include"}),s=await t.json(),r=s.data||s;t.ok&&"error"!==r.status?l(r):(i(r.message||"Failed to load shopping list"),l(null))}catch(t){i(`Failed to fetch shopping list: ${t}`),l(null)}finally{a(!1)}},[e]);be.useEffect(()=>{c()},[c]);const h=be.useCallback(()=>{if(!o)return;const e=[];e.push("Shopping List Export"),e.push(`Name: ${o.name}`),e.push(`Date: ${new Date(o.created_at).toLocaleString()}`),e.push(""),e.push("Item,Quantity,Status");const t=e=>/^[=+\-@\t\r]/.test(e)?`'${e}`:e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e;for(const i of o.items)e.push(`${t(i.query)},${i.quantity},${i.status}`);e.push(""),e.push("Service Totals:"),e.push("Service,Total");for(const[i,l]of Object.entries(o.total_stats.service_totals))e.push(`${aa(i)},$${l.toFixed(2)}`);e.push(""),e.push(`Cheapest Service: ${aa(o.total_stats.cheapest_service||"")}`),e.push(`Potential Savings: $${o.total_stats.potential_savings.toFixed(2)}`);const s=e.join("\n"),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download=`${o.name.replace(/\s+/g,"_")}_${(new Date).toISOString().split("T")[0]}.csv`,n.click(),URL.revokeObjectURL(a)},[o]),j=e=>{switch(e){case"completed":return s.jsx(Ds,{color:"success",fontSize:"small"});case"error":return s.jsx(Ns,{color:"error",fontSize:"small"});default:return s.jsx(b,{size:16})}};if(r)return s.jsxs(x,{children:[s.jsx(K,{variant:"rectangular",height:100,sx:{mb:2}}),s.jsx(K,{variant:"rectangular",height:200,sx:{mb:2}}),s.jsx(K,{variant:"rectangular",height:300})]});if(n||!o)return s.jsx(L,{severity:"error",action:s.jsxs(x,{sx:{display:"flex",gap:1},children:[s.jsx(f,{size:"small",onClick:c,startIcon:s.jsx(Os,{}),children:"Retry"}),t&&s.jsx(f,{size:"small",onClick:t,children:"Back"})]}),children:n||"Shopping list not found"});const{items:g,total_stats:v,name:S,created_at:_}=o,k=Object.entries(v.service_totals).sort(([,e],[,t])=>e-t);return s.jsxs(x,{children:[s.jsx(d,{sx:{mb:3},children:s.jsx(u,{children:s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[s.jsxs(x,{children:[s.jsx(m,{variant:"h5",gutterBottom:!0,children:S}),s.jsxs(m,{variant:"body2",color:"text.secondary",children:["Created: ",new Date(_).toLocaleString()]}),s.jsxs(x,{sx:{display:"flex",gap:1,mt:1},children:[s.jsx(p,{label:`${v.items_processed} items`,size:"small"}),v.items_failed>0&&s.jsx(p,{label:`${v.items_failed} failed`,size:"small",color:"error"})]})]}),s.jsxs(x,{sx:{display:"flex",gap:1},children:[s.jsx(f,{size:"small",startIcon:s.jsx(er,{}),onClick:h,children:"Export CSV"}),t&&s.jsx(f,{size:"small",onClick:t,children:"New Search"})]})]})})}),k.length>0&&s.jsx(d,{sx:{mb:3},children:s.jsxs(u,{children:[s.jsx(m,{variant:"h6",gutterBottom:!0,children:"Price Comparison by Service"}),s.jsx(oe,{component:ee,variant:"outlined",sx:{mb:2},children:s.jsxs(le,{size:"small",children:[s.jsx(ce,{children:s.jsxs(de,{children:[s.jsx(ue,{children:"Service"}),s.jsx(ue,{align:"right",children:"Total Cost"}),s.jsx(ue,{align:"right",children:"Difference"})]})}),s.jsx(xe,{children:k.map(([e,t],r)=>{const a=t-k[0][1],n=0===r;return s.jsxs(de,{sx:{bgcolor:n?"success.dark":"transparent"},children:[s.jsx(ue,{children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(x,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:ra(e)}}),s.jsx(m,{sx:{fontWeight:n?700:400},children:aa(e)}),n&&s.jsx(p,{label:"Best Price",size:"small",color:"success",sx:{ml:1}})]})}),s.jsx(ue,{align:"right",children:s.jsxs(m,{variant:"h6",sx:{fontWeight:n?700:400},children:["$",t.toFixed(2)]})}),s.jsx(ue,{align:"right",children:!n&&s.jsxs(m,{color:"error.main",children:["+$",a.toFixed(2)]})})]},e)})})]})}),v.potential_savings>0&&s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"success.dark",borderRadius:1},children:[s.jsx(Na,{sx:{fontSize:40}}),s.jsxs(x,{children:[s.jsxs(m,{variant:"h5",sx:{fontWeight:700},children:["Save $",v.potential_savings.toFixed(2)]}),s.jsxs(m,{variant:"body2",children:["by shopping at"," ",aa(v.cheapest_service||"")," instead of"," ",aa(v.most_expensive_service||"")]})]})]})]})}),s.jsx(d,{children:s.jsxs(u,{children:[s.jsxs(m,{variant:"h6",gutterBottom:!0,children:["Items (",g.length,")"]}),g.map((e,t)=>s.jsxs(y,{defaultExpanded:"error"===e.status,children:[s.jsx(w,{expandIcon:s.jsx(gs,{}),children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",pr:2},children:[j(e.status),s.jsx(m,{sx:{flexGrow:1,fontWeight:500},children:e.query}),s.jsx(p,{label:`x${e.quantity}`,size:"small"}),e.services_found&&e.services_found.length>0&&s.jsx(p,{label:`${e.services_found.length} services`,size:"small",variant:"outlined"})]})}),s.jsx(C,{children:e.error?s.jsx(L,{severity:"error",sx:{mb:1},children:e.error}):s.jsxs(x,{children:[e.services_found&&e.services_found.length>0&&s.jsxs(x,{sx:{mb:2},children:[s.jsx(m,{variant:"caption",color:"text.secondary",children:"Found at:"}),s.jsx(x,{sx:{display:"flex",gap:.5,mt:.5,flexWrap:"wrap"},children:e.services_found.map(e=>s.jsx(p,{label:aa(e),size:"small",sx:{bgcolor:ra(e),color:"white"}},e))})]}),e.comparison_id&&s.jsx(f,{size:"small",startIcon:s.jsx(xs,{}),onClick:()=>{},children:"View Full Comparison"})]})})]},e.comparison_id||`${e.query}-${t}`))]})})]})});var Va,Ua={};function qa(){if(Va)return Ua;Va=1;var e=i();Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.default=void 0;var t=e(nt()),s=o();return Ua.default=(0,t.default)((0,s.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),Ua}const Ga=Ie(qa()),Ja=be.memo(function({selections:e,aggregation:t,onDelete:r,loading:a=!1}){const n=be.useMemo(()=>e.reduce((e,t)=>{var s;return e+((null==(s=t.product)?void 0:s.price)??0)*t.quantity},0),[e]),i=be.useCallback(()=>{if(0===e.length)return;const t=[];t.push("Product Name,Service,Price,Quantity,Subtotal");for(const n of e){const e=n.product;if(!e)continue;const s=e.price*n.quantity;t.push(`"${e.name}",${aa(e.service)},$${e.price.toFixed(2)},${n.quantity},$${s.toFixed(2)}`)}t.push(""),t.push(`Total,,,${e.length},$${n.toFixed(2)}`);const s=t.join("\n"),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=`saved_selections_${(new Date).toISOString().split("T")[0]}.csv`,i.click(),URL.revokeObjectURL(a)},[e,n]),o=be.useCallback(()=>{if(0===e.length)return;const t={exported_at:(new Date).toISOString(),total_items:e.length,total_value:n,selections:e.map(e=>{var t,s,r,a,n;return{product_name:null==(t=e.product)?void 0:t.name,service:null==(s=e.product)?void 0:s.service,price:null==(r=e.product)?void 0:r.price,quantity:e.quantity,subtotal:((null==(a=e.product)?void 0:a.price)??0)*e.quantity,notes:e.notes,url:null==(n=e.product)?void 0:n.url}})},s=JSON.stringify(t,null,2),r=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=`saved_selections_${(new Date).toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(a)},[e,n]);return a?s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(K,{variant:"rectangular",height:60,sx:{mb:2}}),s.jsx(K,{variant:"rectangular",height:60,sx:{mb:2}}),s.jsx(K,{variant:"rectangular",height:60})]})}):0===e.length?s.jsx(d,{children:s.jsx(u,{children:s.jsxs(x,{sx:{textAlign:"center",py:6},children:[s.jsx(Gr,{sx:{fontSize:48,color:"text.secondary",mb:2}}),s.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No saved selections yet"}),s.jsx(m,{variant:"body2",color:"text.secondary",children:'Click "Save" on a product to add it to your list.'})]})})}):s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t&&t.cheapest_service&&s.jsx(d,{sx:{bgcolor:"success.dark"},children:s.jsx(u,{children:s.jsxs(V,{container:!0,spacing:2,children:[s.jsx(V,{item:!0,xs:12,md:4,children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[s.jsx(Ga,{sx:{fontSize:36}}),s.jsxs(x,{children:[s.jsx(m,{variant:"caption",color:"text.secondary",children:"Best Overall Price"}),s.jsx(m,{variant:"h6",sx:{fontWeight:700},children:aa(t.cheapest_service)}),t.cheapest_total&&s.jsxs(m,{variant:"body2",color:"text.secondary",children:["$",t.cheapest_total.toFixed(2)," total"]})]})]})}),t.potential_savings>0&&s.jsx(V,{item:!0,xs:12,md:4,children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[s.jsx(Na,{sx:{fontSize:36}}),s.jsxs(x,{children:[s.jsx(m,{variant:"caption",color:"text.secondary",children:"Potential Savings"}),s.jsxs(m,{variant:"h6",sx:{fontWeight:700},children:["$",t.potential_savings.toFixed(2)]}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"by switching to cheapest options"})]})]})}),s.jsxs(V,{item:!0,xs:12,md:4,children:[s.jsx(m,{variant:"caption",color:"text.secondary",children:"Price by Service"}),s.jsx(x,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:Object.entries(t.service_totals).sort((e,t)=>e[1]-t[1]).map(([e,r])=>s.jsx(p,{label:`${aa(e)}: $${r.toFixed(2)}`,size:"small",sx:{bgcolor:ra(e),color:"white",fontWeight:e===t.cheapest_service?700:400}},e))})]})]})})}),s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(_,{children:e.map(e=>{var t;return s.jsxs(k,{divider:!0,sx:{"&:hover":{bgcolor:"action.hover"}},children:[s.jsx(z,{primary:s.jsx(m,{variant:"body1",sx:{fontWeight:500},children:(null==(t=e.product)?void 0:t.name)??"Unknown Product"}),secondary:s.jsx(x,{component:"span",sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:e.product&&s.jsxs(s.Fragment,{children:[s.jsx(p,{label:aa(e.product.service),size:"small",sx:{bgcolor:ra(e.product.service),color:"white",fontSize:"0.65rem"}}),s.jsxs(m,{variant:"body2",component:"span",color:"primary",sx:{fontWeight:600},children:["$",e.product.price.toFixed(2)]}),s.jsxs(m,{variant:"caption",component:"span",color:"text.secondary",children:["x",e.quantity]}),s.jsxs(m,{variant:"body2",component:"span",color:"text.secondary",sx:{ml:1},children:["= $",(e.product.price*e.quantity).toFixed(2)]})]})})}),s.jsx(me,{children:s.jsx(c,{edge:"end",onClick:()=>r(e.selection_id),size:"small",color:"error",title:"Remove from list",children:s.jsx(Ms,{})})})]},e.selection_id)})}),s.jsx(M,{sx:{my:2}}),s.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[s.jsxs(x,{children:[s.jsxs(m,{variant:"subtitle1",sx:{fontWeight:500},children:["Total (",e.length," items)"]}),s.jsxs(m,{variant:"h5",color:"primary",sx:{fontWeight:700},children:["$",n.toFixed(2)]})]}),s.jsxs(x,{sx:{display:"flex",gap:1},children:[s.jsx(f,{size:"small",variant:"outlined",startIcon:s.jsx(er,{}),onClick:i,children:"Export CSV"}),s.jsx(f,{size:"small",variant:"outlined",startIcon:s.jsx(er,{}),onClick:o,children:"Export JSON"})]})]})]})})]})});var Ka,Qa={};function Xa(){if(Ka)return Qa;Ka=1;var e=i();Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.default=void 0;var t=e(nt()),s=o();return Qa.default=(0,t.default)((0,s.jsx)("path",{d:"M4 9h4v11H4zm12 4h4v7h-4zm-6-9h4v16h-4z"}),"BarChart"),Qa}const Ya=Ie(Xa()),Za={amazon_fresh:"#FF9900",instacart:"#43B02A",doordash:"#FF3008",safeway:"#E31837"},en=be.memo(function({comparisonResult:e,loading:t=!1}){const r=be.useMemo(()=>{if(!e||0===e.groups.length)return{serviceStats:[],bestDeals:[],potentialSavings:0};const t=e.groups.flatMap(e=>e.products).reduce((e,t)=>(e[t.service]||(e[t.service]={products:[],total:0}),e[t.service].products.push(t),e[t.service].total+=t.price,e),{}),s=Object.entries(t).map(([e,t])=>({service:e,totalPrice:t.total,productCount:t.products.length,avgPrice:t.total/t.products.length}));s.sort((e,t)=>e.totalPrice-t.totalPrice);const r=[];e.groups.forEach(e=>{if(e.products.length<2)return;const t=[...e.products].sort((e,t)=>e.price-t.price),s=t[0],a=t[1];if(s&&a){const e=a.price-s.price;e>.5&&r.push({product:s,savings:e,comparedTo:a.service})}}),r.sort((e,t)=>t.savings-e.savings);const a=r.reduce((e,t)=>e+t.savings,0);return{serviceStats:s,bestDeals:r.slice(0,5),potentialSavings:a}},[e]),a=be.useMemo(()=>r.serviceStats.map(e=>({name:aa(e.service),service:e.service,total:e.totalPrice,count:e.productCount,avg:e.avgPrice})),[r.serviceStats]),n=be.useMemo(()=>{const e=r.serviceStats.reduce((e,t)=>e+t.totalPrice,0);return r.serviceStats.map(t=>({name:aa(t.service),service:t.service,value:t.totalPrice,percentage:e>0?(t.totalPrice/e*100).toFixed(1):0}))},[r.serviceStats]);return t?s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[s.jsx(K,{variant:"rectangular",height:100}),s.jsxs(V,{container:!0,spacing:3,children:[s.jsx(V,{item:!0,xs:12,md:6,children:s.jsx(K,{variant:"rectangular",height:300})}),s.jsx(V,{item:!0,xs:12,md:6,children:s.jsx(K,{variant:"rectangular",height:300})})]})]}):e?s.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[r.potentialSavings>0&&s.jsx(d,{sx:{bgcolor:"success.dark"},children:s.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(Na,{sx:{fontSize:40}}),s.jsxs(x,{children:[s.jsxs(m,{variant:"h5",sx:{fontWeight:700},children:["$",r.potentialSavings.toFixed(2)]}),s.jsx(m,{variant:"body2",children:"Potential savings by choosing the lowest price for each item"})]})]})}),s.jsxs(V,{container:!0,spacing:3,children:[s.jsx(V,{item:!0,xs:12,md:6,children:s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(m,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Service Price Comparison"}),0===a.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No price data available"}):s.jsx(x,{sx:{height:300},children:s.jsx(Oe,{width:"100%",height:"100%",children:s.jsxs(Te,{data:a,layout:"vertical",children:[s.jsx(Fe,{type:"number",tickFormatter:e=>`$${e.toFixed(0)}`}),s.jsx(Re,{type:"category",dataKey:"name",width:100}),s.jsx(De,{formatter:e=>[`$${e.toFixed(2)}`,"Total"],labelStyle:{color:"#000"}}),s.jsx(We,{dataKey:"total",name:"Total Price",children:a.map((e,t)=>s.jsx(Le,{fill:Za[e.service]||ra(e.service),opacity:0===t?1:.7},`cell-${t}`))})]})})})]})})}),s.jsx(V,{item:!0,xs:12,md:6,children:s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(m,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Price Distribution"}),0===n.length?s.jsx(m,{variant:"body2",color:"text.secondary",children:"No distribution data available"}):s.jsx(x,{sx:{height:300},children:s.jsx(Oe,{width:"100%",height:"100%",children:s.jsxs(Ae,{children:[s.jsx(Ne,{data:n,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:80,label:({name:e,percentage:t})=>`${e}: ${t}%`,labelLine:!0,children:n.map((e,t)=>s.jsx(Le,{fill:Za[e.service]||ra(e.service)},`cell-${t}`))}),s.jsx(Ee,{}),s.jsx(De,{formatter:e=>`$${e.toFixed(2)}`})]})})})]})})})]}),r.bestDeals.length>0&&s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(m,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Top 5 Best Deals"}),s.jsx(_,{disablePadding:!0,children:r.bestDeals.map((e,t)=>s.jsxs(k,{divider:t<r.bestDeals.length-1,sx:{px:0},children:[s.jsx(z,{primary:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{label:aa(e.product.service),size:"small",sx:{bgcolor:ra(e.product.service),color:"white",fontSize:"0.65rem"}}),s.jsx(m,{variant:"body2",sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:300},children:e.product.name})]}),secondary:`$${e.product.price.toFixed(2)} vs ${aa(e.comparedTo)}`}),s.jsx(p,{icon:s.jsx(Na,{}),label:`Save $${e.savings.toFixed(2)}`,color:"success",size:"small"})]},e.product.id))})]})}),s.jsx(d,{children:s.jsxs(u,{children:[s.jsx(m,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Detailed Service Comparison"}),s.jsx(oe,{component:ee,variant:"outlined",children:s.jsxs(le,{size:"small",children:[s.jsx(ce,{children:s.jsxs(de,{children:[s.jsx(ue,{children:"Service"}),s.jsx(ue,{align:"right",children:"Products"}),s.jsx(ue,{align:"right",children:"Avg Price"}),s.jsx(ue,{align:"right",children:"Total"})]})}),s.jsx(xe,{children:r.serviceStats.map((e,t)=>s.jsxs(de,{sx:{bgcolor:0===t?"success.dark":"transparent"},children:[s.jsx(ue,{children:s.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(x,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:ra(e.service)}}),aa(e.service),0===t&&s.jsx(p,{label:"Lowest",size:"small",color:"success",sx:{ml:1,fontSize:"0.6rem"}})]})}),s.jsx(ue,{align:"right",children:e.productCount}),s.jsxs(ue,{align:"right",children:["$",e.avgPrice.toFixed(2)]}),s.jsx(ue,{align:"right",children:s.jsxs(m,{sx:{fontWeight:0===t?700:400},children:["$",e.totalPrice.toFixed(2)]})})]},e.service))})]})})]})})]}):s.jsxs(x,{sx:{textAlign:"center",py:6,bgcolor:"action.hover",borderRadius:2},children:[s.jsx(Ya,{sx:{fontSize:48,color:"text.secondary",mb:2}}),s.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No statistics available"}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"Run a search to see price comparison statistics"})]})});function tn(){const{comparisonResult:e,loading:t,error:r,progress:a,savedSelections:n,savedAggregation:i,searchProducts:o,saveSelection:l,deleteSelection:c,getSavedSelections:h,clearResults:j}=function(){const[e,t]=be.useState(null),[s,r]=be.useState(!1),[a,n]=be.useState(null),[i,o]=be.useState(null),[l,c]=be.useState([]),[d,u]=be.useState(null),x=be.useRef(null);be.useEffect(()=>{const e=new AbortController;return fetch(`${Ft()}/api/auth/token`,{credentials:"include",signal:e.signal}).then(t=>{if(e.signal.aborted)return null;if(!t.ok)throw new Error("Authentication required");return t.json()}).then(t=>{if(!t||e.signal.aborted)return;const s=$e(Ft(),{transports:["websocket","polling"],auth:{token:t.token}});x.current=s,s.on("connect_error",e=>{}),s.on("disconnect",e=>{}),s.on("connect",()=>{}),s.on("price_comparison_progress",e=>{o(e)}),s.on("price_comparison_complete",e=>{o(null),e.comparison_id}),s.on("price_comparison_error",e=>{o(null)})}).catch(e=>{e.name}),()=>{e.abort(),x.current&&(x.current.disconnect(),x.current=null)}},[]);const h=be.useCallback(async(e,s="20024",a)=>{var i;n(null),r(!0),o(null);try{const o={query:e,location:s,services:a},l=await fetch(`${Ft()}/api/price-comparison/search`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(o)}),c=await l.json();if(!l.ok){const e=c.error||c.message||`Search failed (HTTP ${l.status})`;return n(e),r(!1),null}const d=c.data||c;return"error"===d.status?(n((null==(i=d.errors)?void 0:i[0])||"Search failed"),r(!1),null):(t(d),r(!1),d)}catch(l){return n("Connection error while searching products"),r(!1),null}},[]),m=be.useCallback(async e=>{n(null),r(!0);try{const s=await fetch(`${Ft()}/api/price-comparison/comparison/${e}`,{method:"GET",credentials:"include"}),a=await s.json();if(!s.ok){const e=a.error||a.message||`Failed to fetch comparison (HTTP ${s.status})`;return n(e),r(!1),null}const i=a.data||a;return t(i),r(!1),i}catch(s){return n("Connection error while fetching comparison"),r(!1),null}},[]),p=be.useCallback(async e=>{try{const t=await fetch(`${Ft()}/api/price-comparison/saved?session_token=${encodeURIComponent(e)}`,{method:"GET",credentials:"include"}),s=await t.json();if(t.ok){const e=s.data||s,t=e.selections||[];c(t),e.aggregation?u(e.aggregation):u(null)}}catch(t){}},[]),j=be.useCallback(async(e,t,s=1)=>{var r;try{const a=new URLSearchParams({session_token:e,product_id:t,quantity:s.toString()}),i=await fetch(`${Ft()}/api/price-comparison/save?${a.toString()}`,{method:"POST",credentials:"include"}),o=await i.json();return i.ok&&(null==(r=o.data)?void 0:r.saved)?(await p(e),!0):(n(o.error||o.message||"Failed to save selection"),!1)}catch(a){return n("Connection error while saving selection"),!1}},[p]),g=be.useCallback(async(e,t)=>{var s;try{const r=await fetch(`${Ft()}/api/price-comparison/saved/${e}?session_token=${encodeURIComponent(t)}`,{method:"DELETE",credentials:"include"}),a=await r.json();return r.ok&&(null==(s=a.data)?void 0:s.deleted)?(await p(t),!0):(n(a.error||a.message||"Failed to delete selection"),!1)}catch(r){return n("Connection error while deleting selection"),!1}},[p]),v=be.useCallback(()=>{t(null),n(null),o(null)},[]);return{comparisonResult:e,loading:s,error:a,progress:i,savedSelections:l,savedAggregation:d,searchProducts:h,getComparison:m,saveSelection:j,deleteSelection:g,getSavedSelections:p,clearResults:v}}(),[g,v]=be.useState(0),[b,y]=be.useState({open:!1,message:"",severity:"info"}),[w,C]=be.useState(!1),[_,k]=be.useState(null),[z,M]=be.useState(null),[I,P]=be.useState(!0);be.useEffect(()=>{(async()=>{try{const e=await fetch("/api/auth/token");if(e.ok){const t=await e.json();t.token&&(M(t.token),localStorage.setItem("price_comparison_session_token",t.token))}else{const e=localStorage.getItem("price_comparison_session_token");e&&M(e)}}catch{const e=localStorage.getItem("price_comparison_session_token");e&&M(e)}finally{P(!1)}})()},[]),be.useEffect(()=>{z&&!I&&h(z)},[z,I,h]);const $=be.useCallback(async(e,t,s)=>{j();const a=await o(e,t,s);y(a?{open:!0,message:`Found ${a.groups.reduce((e,t)=>e+t.products.length,0)} products in ${a.groups.length} groups`,severity:"success"}:{open:!0,message:r||"Search failed",severity:"error"})},[o,j,r]),O=be.useCallback(async e=>{if(!z)return void y({open:!0,message:"Please log in to save products",severity:"error"});const t=await l(z,e);y({open:!0,message:t?"Product saved!":"Failed to save product",severity:t?"success":"error"})},[l,z]),T=be.useCallback(async e=>{if(!z)return void y({open:!0,message:"Please log in to manage selections",severity:"error"});const t=await c(e,z);y({open:!0,message:t?"Selection removed":"Failed to remove selection",severity:t?"success":"error"})},[c,z]),F=be.useCallback(e=>{C(!1),k(e),v(3),y({open:!0,message:"Shopping list processed successfully!",severity:"success"})},[]),R=be.useCallback(()=>{k(null),v(0)},[]),D=be.useMemo(()=>e?e.groups.reduce((e,t)=>e+t.products.length,0):0,[e]);return s.jsxs(B,{maxWidth:"xl",sx:{py:4},children:[s.jsxs(x,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[s.jsxs(x,{children:[s.jsxs(m,{variant:"h4",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(Gr,{})," Price Comparison"]}),s.jsx(m,{variant:"body2",color:"text.secondary",children:"Compare grocery prices across Amazon Fresh, Instacart, DoorDash, and Safeway."})]}),s.jsx(f,{variant:"outlined",startIcon:s.jsx(Xr,{}),onClick:()=>C(!0),children:"Upload List"})]}),s.jsx(d,{sx:{mb:3},children:s.jsx(u,{children:s.jsx(na,{onSearch:$,loading:t})})}),(t||a)&&s.jsxs(x,{sx:{mb:3},children:[s.jsx(S,{variant:a?"determinate":"indeterminate",value:a&&a.total>0?a.current/a.total*100:void 0}),a&&s.jsx(m,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:a.message||`Scraping ${a.service}...`})]}),r&&!t&&s.jsx(L,{severity:"error",sx:{mb:3},children:r}),s.jsxs(x,{sx:{mb:3},children:[s.jsxs(se,{value:g,onChange:(e,t)=>v(t),sx:{borderBottom:1,borderColor:"divider",mb:2},children:[s.jsx(re,{label:"Search Results"}),s.jsx(re,{label:"Saved Selections"}),s.jsx(re,{label:"Statistics"}),s.jsx(re,{label:"Shopping List",disabled:!_})]}),0===g&&s.jsx(s.Fragment,{children:e||t?s.jsxs(s.Fragment,{children:[(null==e?void 0:e.llm_analysis)&&s.jsx(d,{sx:{mb:3,bgcolor:"primary.dark"},children:s.jsxs(u,{children:[s.jsx(m,{variant:"subtitle2",sx:{mb:1,fontWeight:600},children:"AI Analysis"}),s.jsx(m,{variant:"body2",children:e.llm_analysis}),e.model_used&&s.jsx(p,{label:`Model: ${e.model_used}`,size:"small",sx:{mt:1}})]})}),s.jsx(Oa,{groups:(null==e?void 0:e.groups)||[],onSaveProduct:O,loading:t,servicesScraped:null==e?void 0:e.services_scraped,totalProducts:D})]}):s.jsxs(x,{sx:{textAlign:"center",py:8,px:2,bgcolor:"action.hover",borderRadius:2},children:[s.jsx(Gr,{sx:{fontSize:48,color:"text.secondary",mb:2}}),s.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Start by searching for a product"}),s.jsx(m,{variant:"body2",color:"text.secondary",children:'Enter a product name like "milk", "bread", or "eggs" to compare prices across grocery services.'})]})}),1===g&&s.jsx(Ja,{selections:n,aggregation:i,onDelete:T,loading:t}),2===g&&s.jsx(en,{comparisonResult:e,loading:t}),3===g&&_&&s.jsx(Ba,{listId:_,onBack:R})]}),s.jsx(Ha,{open:w,onClose:()=>C(!1),onComplete:F,sessionToken:z||""}),s.jsx(X,{open:b.open,autoHideDuration:4e3,onClose:()=>y(e=>({...e,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(L,{onClose:()=>y(e=>({...e,open:!1})),severity:b.severity,sx:{width:"100%"},children:b.message})})]})}const sn=240,rn=[{id:"dashboard",label:"Dashboard",icon:s.jsx(ut,{}),path:"/"},{id:"models",label:"Models",icon:s.jsx(zt,{}),path:"/models"},{id:"congressional",label:"Congressional Data",icon:s.jsx(gr,{}),path:"/congressional"},{id:"price-comparison",label:"Price Comparison",icon:s.jsx(Gr,{}),path:"/price-comparison"},{id:"main",label:"Main Services",icon:s.jsx(ut,{}),path:"/",isSection:!0},{id:"image",label:"Image Generation",icon:s.jsx(pt,{}),path:"/",isSection:!0},{id:"music",label:"Music Generation",icon:s.jsx(ft,{}),path:"/",isSection:!0},{id:"settings",label:"Settings",icon:s.jsx(St,{}),path:"/",isSection:!0}];function an(){const{connected:e}=qt(),r=pe(),a=t(r.breakpoints.down("md")),[n,i]=be.useState(!1),o=ye(),l=we(),d=window.location.hostname||"localhost",u=()=>{i(!n)},h=e=>!e.isSection&&l.pathname===e.path,p=s.jsxs(x,{sx:{overflow:"auto"},children:[s.jsxs(x,{sx:{p:2,display:"flex",alignItems:"center",gap:1},children:[s.jsx($t,{color:"primary"}),s.jsx(m,{variant:"body2",sx:{fontFamily:"monospace"},children:d})]}),s.jsx(_,{children:rn.map(e=>s.jsx(k,{disablePadding:!0,children:s.jsxs(je,{onClick:()=>(e=>{if(e.isSection)if("/"!==l.pathname)o("/"),setTimeout(()=>{const t=document.getElementById(e.id);t&&t.scrollIntoView({behavior:"smooth"})},100);else{const t=document.getElementById(e.id);t&&t.scrollIntoView({behavior:"smooth"})}else o(e.path);a&&i(!1)})(e),selected:h(e),sx:{pl:e.isSection?4:2,"&.Mui-selected":{bgcolor:"action.selected","&:hover":{bgcolor:"action.selected"}}},children:[s.jsx(he,{sx:{color:h(e)?"primary.main":"text.secondary",minWidth:40},children:e.icon}),s.jsx(z,{primary:e.label,primaryTypographyProps:{fontSize:e.isSection?"0.875rem":"1rem",color:e.isSection?"text.secondary":"text.primary"}})]})},e.id))})]});return s.jsxs(x,{sx:{display:"flex"},children:[s.jsx(ge,{position:"fixed",sx:{width:{md:"calc(100% - 240px)"},ml:{md:"240px"},bgcolor:"background.paper",borderBottom:1,borderColor:"divider"},elevation:0,children:s.jsxs(ve,{children:[s.jsx(c,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:u,sx:{mr:2,display:{md:"none"}},children:s.jsx(ot,{})}),s.jsx(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,background:"linear-gradient(90deg, var(--mui-palette-primary-main), var(--mui-palette-secondary-main))",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:600},children:"AI Services Dashboard"}),s.jsx(Dt,{}),s.jsx(x,{sx:{ml:1},children:s.jsx(Ut,{})})]})}),s.jsxs(x,{component:"nav",sx:{width:{md:sn},flexShrink:{md:0}},children:[s.jsx(fe,{variant:"temporary",open:n,onClose:u,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:sn,bgcolor:"background.paper"}},children:p}),s.jsx(fe,{variant:"permanent",sx:{display:{xs:"none",md:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:sn,bgcolor:"background.paper",borderRight:1,borderColor:"divider"}},open:!0,children:p})]}),s.jsxs(x,{component:"main",sx:{flexGrow:1,width:{md:"calc(100% - 240px)"},mt:"64px",minHeight:"calc(100vh - 64px)"},children:[s.jsxs(Se,{children:[s.jsx(Ce,{path:"/",element:s.jsx(qs,{})}),s.jsx(Ce,{path:"/models",element:s.jsx(hr,{})}),s.jsx(Ce,{path:"/congressional",element:s.jsx(Br,{})}),s.jsx(Ce,{path:"/price-comparison",element:s.jsx(tn,{})}),s.jsx(Ce,{path:"*",element:s.jsx(_e,{to:"/",replace:!0})})]}),s.jsx(Ot,{connected:e})]})]})}qe.createRoot(document.getElementById("root")).render(s.jsx(ke.StrictMode,{children:s.jsx(Ze,{children:s.jsx(ze,{children:s.jsx(an,{})})})}));
