version: "3.8"

services:
  weaviate:
    image: semitechnologies/weaviate:1.27.0
    container_name: weaviate
    restart: unless-stopped
    ports:
      # SECURITY WARNING: Only bind to localhost for local development
      # For production, use proper authentication and firewall rules
      - "127.0.0.1:8080:8080"
      - "127.0.0.1:50051:50051"
    environment:
      QUERY_DEFAULTS_LIMIT: 25
      # SECURITY WARNING: Anonymous access enabled for local development only
      # Set to 'false' and configure AUTHENTICATION_APIKEY_* for production
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: "${WEAVIATE_ANONYMOUS_ACCESS:-true}"
      AUTHENTICATION_APIKEY_ENABLED: "${WEAVIATE_APIKEY_ENABLED:-false}"
      AUTHENTICATION_APIKEY_ALLOWED_KEYS: "${WEAVIATE_API_KEYS:-}"
      AUTHENTICATION_APIKEY_USERS: "${WEAVIATE_API_USERS:-}"
      PERSISTENCE_DATA_PATH: "/var/lib/weaviate"
      DEFAULT_VECTORIZER_MODULE: "text2vec-ollama"
      ENABLE_MODULES: "text2vec-ollama"
      OLLAMA_API_ENDPOINT: "${OLLAMA_API_ENDPOINT:-http://host.docker.internal:11434}"
      CLUSTER_HOSTNAME: "node1"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - weaviate_data:/var/lib/weaviate
    networks:
      - weaviate_network

  weaviate-console:
    image: semitechnologies/weaviate-console:latest
    container_name: weaviate-console
    restart: unless-stopped
    ports:
      - "127.0.0.1:8081:80"
    depends_on:
      - weaviate
    networks:
      - weaviate_network

volumes:
  weaviate_data:

networks:
  weaviate_network:
    driver: bridge
